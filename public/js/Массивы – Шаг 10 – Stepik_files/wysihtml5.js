if("undefined"==typeof FastBoot){Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var ee=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return ee.get.call(this)},set:function(te){return ee.set.call(this,te)}})}(),Array.isArray||(Array.isArray=function(ee){return"[object Array]"===Object.prototype.toString.call(ee)});var wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\uFEFF",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};!function(ee,te){"function"==typeof define&&define.amd?(window.rangy=ee(),define("rangy",ee)):te.rangy=ee()}(function(){function ee(ke,Pe){var Me=typeof ke[Pe];return Me==ye||Me==be&&ke[Pe]||"unknown"==Me}function te(ke,Pe){return typeof ke[Pe]==be&&ke[Pe]}function ne(ke,Pe){return typeof ke[Pe]!=Ce}function oe(ke){return function(Pe,Me){for(var Be=Me.length;Be--;)if(!ke(Pe,Me[Be]))return!1;return!0}}function ae(ke){return ke&&Se(ke,we)&&Re(ke,Ee)}function re(ke){return te(ke,"body")?ke.body:ke.getElementsByTagName("body")[0]}function se(ke){te(window,"console")&&ee(window.console,"log")&&window.console.log(ke)}function le(ke,Pe){Pe?window.alert(ke):se(ke)}function ie(ke){ve.initialized=!0,ve.supported=!1,le("Rangy is not supported on this page in your browser. Reason: "+ke,ve.config.alertOnFail)}function ce(ke){return ke.message||ke.description||ke+""}function me(){if(!ve.initialized){var ke,Pe=!1,Me=!1;ee(document,"createRange")&&(ke=document.createRange(),Se(ke,xe)&&Re(ke,Ne)&&(Pe=!0));var Be=re(document);if(!Be||"body"!=Be.nodeName.toLowerCase())return void ie("No body element found");if(Be&&ee(Be,"createTextRange")&&(ke=Be.createTextRange(),ae(ke)&&(Me=!0)),!Pe&&!Me)return void ie("Neither Range nor TextRange are available");ve.initialized=!0,ve.features={implementsDomRange:Pe,implementsTextRange:Me};var He,qe;for(var je in Ae)(He=Ae[je])instanceof pe&&He.init(He,ve);for(var We=0,Ve=Oe.length;Ve>We;++We)try{Oe[We](ve)}catch(Ue){qe="Rangy init listener threw an exception. Continuing. Detail: "+ce(Ue),se(qe)}}}function pe(ke,Pe,Me){this.name=ke,this.dependencies=Pe,this.initialized=!1,this.supported=!1,this.initializer=Me}function ue(ke,Pe,Me,Be){var He=new pe(Pe,Me,function(qe){if(!qe.initialized){qe.initialized=!0;try{Be(ve,qe),qe.supported=!0}catch(We){var je="Module '"+Pe+"' failed to load: "+ce(We);se(je)}}});Ae[Pe]=He}function fe(){}var be="object",ye="function",Ce="undefined",Ne=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],xe=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],Ee=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],we=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],Se=oe(ee),Te=oe(te),Re=oe(ne),Ae={},ve={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:ee,isHostObject:te,isHostProperty:ne,areHostMethods:Se,areHostObjects:Te,areHostProperties:Re,isTextRange:ae,getBody:re},features:{},modules:Ae,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:!(typeof rangyAutoInitialize!=Ce)||rangyAutoInitialize}};ve.fail=ie,ve.warn=function(ke){le("Rangy warning: "+ke,ve.config.alertOnWarn)},{}.hasOwnProperty?ve.util.extend=function(ke,Pe,Me){var Be,He;for(var qe in Pe)Pe.hasOwnProperty(qe)&&(Be=ke[qe],He=Pe[qe],Me&&null!==Be&&"object"==typeof Be&&null!==He&&"object"==typeof He&&ve.util.extend(Be,He,!0),ke[qe]=He);return Pe.hasOwnProperty("toString")&&(ke.toString=Pe.toString),ke}:ie("hasOwnProperty not supported"),function(){var ke=document.createElement("div");ke.appendChild(document.createElement("span"));var Pe,Me=[].slice;try{1==Me.call(ke.childNodes,0)[0].nodeType&&(Pe=function(Be){return Me.call(Be,0)})}catch(Be){}Pe||(Pe=function(Be){for(var He=[],qe=0,je=Be.length;je>qe;++qe)He[qe]=Be[qe];return He}),ve.util.toArray=Pe}();var _e;ee(document,"addEventListener")?_e=function(ke,Pe,Me){ke.addEventListener(Pe,Me,!1)}:ee(document,"attachEvent")?_e=function(ke,Pe,Me){ke.attachEvent("on"+Pe,Me)}:ie("Document does not have required addEventListener or attachEvent method"),ve.util.addListener=_e;var Oe=[];ve.init=me,ve.addInitListener=function(ke){ve.initialized?ke(ve):Oe.push(ke)};var Le=[];ve.addShimListener=function(ke){Le.push(ke)},ve.shim=ve.createMissingNativeApi=function(ke){ke=ke||window,me();for(var Pe=0,Me=Le.length;Me>Pe;++Pe)Le[Pe](ke)},pe.prototype={init:function(){for(var ke,Pe,Me=this.dependencies||[],Be=0,He=Me.length;He>Be;++Be){if(Pe=Me[Be],ke=Ae[Pe],!(ke&&ke instanceof pe))throw new Error("required module '"+Pe+"' not found");if(ke.init(),!ke.supported)throw new Error("required module '"+Pe+"' not supported")}this.initializer(this)},fail:function(ke){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+ke)},warn:function(ke){ve.warn("Module "+this.name+": "+ke)},deprecationNotice:function(ke,Pe){ve.warn("DEPRECATED: "+ke+" in module "+this.name+"is deprecated. Please use "+Pe+" instead")},createError:function(ke){return new Error("Error in Rangy "+this.name+" module: "+ke)}},ve.createModule=function(ke){var Pe,Me;2==arguments.length?(Pe=arguments[1],Me=[]):(Pe=arguments[2],Me=arguments[1]);var Be=ue(!1,ke,Me,Pe);ve.initialized&&Be.init()},ve.createCoreModule=function(ke,Pe,Me){ue(!0,ke,Pe,Me)},ve.RangePrototype=fe,ve.rangePrototype=new fe,ve.selectionPrototype=new function(){};var De=!1,Ie=function(){De||(De=!0,!ve.initialized&&ve.config.autoInitialize&&me())};return typeof window==Ce?void ie("No window found"):typeof document==Ce?void ie("No document found"):(ee(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",Ie,!1),_e(window,"load",Ie),ve.createCoreModule("DomUtil",[],function(ke,Pe){function He(ht){for(var bt=0;ht=ht.previousSibling;)++bt;return bt}function je(ht,bt){var yt,Ct=[];for(yt=ht;yt;yt=yt.parentNode)Ct.push(yt);for(yt=bt;yt;yt=yt.parentNode)if(pt(Ct,yt))return yt;return null}function We(ht,bt,yt){for(var Ct=yt?bt:bt.parentNode;Ct;){if(Ct===ht)return!0;Ct=Ct.parentNode}return!1}function Ue(ht,bt,yt){for(var Ct,Nt=yt?ht:ht.parentNode;Nt;){if(Ct=Nt.parentNode,Ct===bt)return Nt;Nt=Ct}return null}function ze(ht){var bt=ht.nodeType;return 3==bt||4==bt||8==bt}function Ke(ht,bt){var yt=bt.nextSibling,Ct=bt.parentNode;return yt?Ct.insertBefore(ht,yt):Ct.appendChild(ht),ht}function Xe(ht){if(9==ht.nodeType)return ht;if(typeof ht.ownerDocument!=dt)return ht.ownerDocument;if(typeof ht.document!=dt)return ht.document;if(ht.parentNode)return Xe(ht.parentNode);throw Pe.createError("getDocument: no document found for node")}function Ye(ht){var bt=Xe(ht);if(typeof bt.defaultView!=dt)return bt.defaultView;if(typeof bt.parentWindow!=dt)return bt.parentWindow;throw Pe.createError("Cannot get a window object for node")}function $e(ht){if(typeof ht.contentDocument!=dt)return ht.contentDocument;if(typeof ht.contentWindow!=dt)return ht.contentWindow.document;throw Pe.createError("getIframeDocument: No Document object found for iframe element")}function Ze(ht){return ht&&ct.isHostMethod(ht,"setTimeout")&&ct.isHostObject(ht,"document")}function nt(ht){var bt;try{return bt=ht.parentNode,!1}catch(yt){return!0}}function ot(ht){if(!ht)return"[No node]";if(ut&&nt(ht))return"[Broken node]";if(ze(ht))return"\""+ht.data+"\"";if(1==ht.nodeType){var bt=ht.id?" id=\""+ht.id+"\"":"";return"<"+ht.nodeName+bt+">[index:"+He(ht)+",length:"+ht.childNodes.length+"]["+(ht.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return ht.nodeName}function rt(ht){this.root=ht,this._next=ht}function lt(ht,bt){this.node=ht,this.offset=bt}function it(ht){this.code=this[ht],this.codeName=ht,this.message="DOMException: "+this.codeName}var dt="undefined",ct=ke.util;ct.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||Pe.fail("document missing a Node creation method"),ct.isHostMethod(document,"getElementsByTagName")||Pe.fail("document missing getElementsByTagName method");var mt=document.createElement("div");ct.areHostMethods(mt,["insertBefore","appendChild","cloneNode"])||Pe.fail("Incomplete Element implementation"),ct.isHostProperty(mt,"innerHTML")||Pe.fail("Element is missing innerHTML property");var gt=document.createTextNode("test");ct.areHostMethods(gt,["splitText","deleteData","insertData","appendData","cloneNode"])||Pe.fail("Incomplete Text Node implementation");var pt=function(ht,bt){for(var yt=ht.length;yt--;)if(ht[yt]===bt)return!0;return!1},ut=!1;!function(){var ht=document.createElement("b");ht.innerHTML="1";var bt=ht.firstChild;ht.innerHTML="<br>",ut=nt(bt),ke.features.crashyTextNodes=ut}();var ft;typeof window.getComputedStyle==dt?typeof document.documentElement.currentStyle==dt?Pe.fail("No means of obtaining computed style properties found"):ft=function(ht,bt){return ht.currentStyle[bt]}:ft=function(ht,bt){return Ye(ht).getComputedStyle(ht,null)[bt]},rt.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var ht,bt,yt=this._current=this._next;if(this._current)if(ht=yt.firstChild)this._next=ht;else{for(bt=null;yt!==this.root&&!(bt=yt.nextSibling);)yt=yt.parentNode;this._next=bt}return this._current},detach:function(){this._current=this._next=this.root=null}},lt.prototype={equals:function(ht){return!!ht&&this.node===ht.node&&this.offset==ht.offset},inspect:function(){return"[DomPosition("+ot(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},it.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},it.prototype.toString=function(){return this.message},ke.dom={arrayContains:pt,isHtmlNamespace:function(ht){var bt;return typeof ht.namespaceURI==dt||null===(bt=ht.namespaceURI)||"http://www.w3.org/1999/xhtml"==bt},parentElement:function(ht){var bt=ht.parentNode;return 1==bt.nodeType?bt:null},getNodeIndex:He,getNodeLength:function(ht){switch(ht.nodeType){case 7:case 10:return 0;case 3:case 8:return ht.length;default:return ht.childNodes.length;}},getCommonAncestor:je,isAncestorOf:We,isOrIsAncestorOf:function(ht,bt){return We(ht,bt,!0)},getClosestAncestorIn:Ue,isCharacterDataNode:ze,isTextOrCommentNode:function(ht){if(!ht)return!1;var bt=ht.nodeType;return 3==bt||8==bt},insertAfter:Ke,splitDataNode:function(ht,bt,yt){var Ct=ht.cloneNode(!1);if(Ct.deleteData(0,bt),ht.deleteData(bt,ht.length-bt),Ke(Ct,ht),yt)for(var Nt,xt=0;Nt=yt[xt++];)Nt.node==ht&&Nt.offset>bt?(Nt.node=Ct,Nt.offset-=bt):Nt.node==ht.parentNode&&Nt.offset>He(ht)&&++Nt.offset;return Ct},getDocument:Xe,getWindow:Ye,getIframeWindow:function(ht){if(typeof ht.contentWindow!=dt)return ht.contentWindow;if(typeof ht.contentDocument!=dt)return ht.contentDocument.defaultView;throw Pe.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:$e,getBody:ct.getBody,isWindow:Ze,getContentDocument:function(ht,bt,yt){var Ct;if(ht?ct.isHostProperty(ht,"nodeType")?Ct=1==ht.nodeType&&"iframe"==ht.tagName.toLowerCase()?$e(ht):Xe(ht):Ze(ht)&&(Ct=ht.document):Ct=document,!Ct)throw bt.createError(yt+"(): Parameter must be a Window object or DOM node");return Ct},getRootContainer:function(ht){for(var bt;bt=ht.parentNode;)ht=bt;return ht},comparePoints:function(ht,bt,yt,Ct){var Nt,xt,Et,wt,St;if(ht==yt)return bt===Ct?0:Ct>bt?-1:1;if(Nt=Ue(yt,ht,!0))return bt<=He(Nt)?-1:1;if(Nt=Ue(ht,yt,!0))return He(Nt)<Ct?-1:1;if(xt=je(ht,yt),!xt)throw new Error("comparePoints error: nodes have no common ancestor");if(Et=ht===xt?xt:Ue(ht,xt,!0),wt=yt===xt?xt:Ue(yt,xt,!0),Et===wt)throw Pe.createError("comparePoints got to case 4 and childA and childB are the same!");for(St=xt.firstChild;St;){if(St===Et)return-1;if(St===wt)return 1;St=St.nextSibling}},isBrokenNode:nt,inspectNode:ot,getComputedStyleProperty:ft,fragmentFromNodeChildren:function(ht){for(var bt,yt=Xe(ht).createDocumentFragment();bt=ht.firstChild;)yt.appendChild(bt);return yt},createIterator:function(ht){return new rt(ht)},DomPosition:lt},ke.DOMException=it}),ve.createCoreModule("DomRange",["DomUtil"],function(ke){function Pe(Yt,$t){return 3!=Yt.nodeType&&(Nt(Yt,$t.startContainer)||Nt(Yt,$t.endContainer))}function Me(Yt){return Yt.document||xt(Yt.startContainer)}function Be(Yt){return new ht(Yt.parentNode,Ct(Yt))}function He(Yt){return new ht(Yt.parentNode,Ct(Yt)+1)}function qe(Yt,$t,Qt){var Zt=11==Yt.nodeType?Yt.firstChild:Yt;return yt($t)?Qt==$t.length?ut.insertAfter(Yt,$t):$t.parentNode.insertBefore(Yt,0==Qt?$t:wt($t,Qt)):Qt>=$t.childNodes.length?$t.appendChild(Yt):$t.insertBefore(Yt,$t.childNodes[Qt]),Zt}function je(Yt,$t,Qt){if(at(Yt),at($t),Me($t)!=Me(Yt))throw new bt("WRONG_DOCUMENT_ERR");var Zt=Et(Yt.startContainer,Yt.startOffset,$t.endContainer,$t.endOffset),Jt=Et(Yt.endContainer,Yt.endOffset,$t.startContainer,$t.startOffset);return Qt?0>=Zt&&0<=Jt:0>Zt&&0<Jt}function We(Yt){for(var $t,Qt,Zt,Jt=Me(Yt.range).createDocumentFragment();Qt=Yt.next();){if($t=Yt.isPartiallySelectedSubtree(),Qt=Qt.cloneNode(!$t),$t&&(Zt=Yt.getSubtreeIterator(),Qt.appendChild(We(Zt)),Zt.detach()),10==Qt.nodeType)throw new bt("HIERARCHY_REQUEST_ERR");Jt.appendChild(Qt)}return Jt}function Ve(Yt,$t,Qt){var Zt,Jt;Qt=Qt||{stop:!1};for(var en,tn;en=Yt.next();)if(Yt.isPartiallySelectedSubtree()){if(!1===$t(en))return void(Qt.stop=!0);if(tn=Yt.getSubtreeIterator(),Ve(tn,$t,Qt),tn.detach(),Qt.stop)return}else for(Zt=ut.createIterator(en);Jt=Zt.next();)if(!1===$t(Jt))return void(Qt.stop=!0)}function Ue(Yt){for(var $t;Yt.next();)Yt.isPartiallySelectedSubtree()?($t=Yt.getSubtreeIterator(),Ue($t),$t.detach()):Yt.remove()}function ze(Yt){for(var $t,Qt,Zt=Me(Yt.range).createDocumentFragment();$t=Yt.next();){if(Yt.isPartiallySelectedSubtree()?($t=$t.cloneNode(!1),Qt=Yt.getSubtreeIterator(),$t.appendChild(ze(Qt)),Qt.detach()):Yt.remove(),10==$t.nodeType)throw new bt("HIERARCHY_REQUEST_ERR");Zt.appendChild($t)}return Zt}function Fe(Yt,$t,Qt){var Zt,Jt=$t&&$t.length;Jt&&(Zt=new RegExp("^("+$t.join("|")+")$"));var tn=[];return Ve(new Ge(Yt,!1),function(nn){if((!Jt||Zt.test(nn.nodeType))&&(!!!Qt||Qt(nn))){var on=Yt.startContainer;if(nn!=on||!yt(on)||Yt.startOffset!=on.length){var an=Yt.endContainer;nn==an&&yt(an)&&0==Yt.endOffset||tn.push(nn)}}}),tn}function Ke(Yt){var $t="undefined"==typeof Yt.getName?"Range":Yt.getName();return"["+$t+"("+ut.inspectNode(Yt.startContainer)+":"+Yt.startOffset+", "+ut.inspectNode(Yt.endContainer)+":"+Yt.endOffset+")]"}function Ge(Yt,$t){if(this.range=Yt,this.clonePartiallySelectedTextNodes=$t,!Yt.collapsed){this.sc=Yt.startContainer,this.so=Yt.startOffset,this.ec=Yt.endContainer,this.eo=Yt.endOffset;var Qt=Yt.commonAncestorContainer;this.sc===this.ec&&yt(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==Qt||yt(this.sc)?St(this.sc,Qt,!0):this.sc.childNodes[this.so],this._last=this.ec!==Qt||yt(this.ec)?St(this.ec,Qt,!0):this.ec.childNodes[this.eo-1])}}function Xe(Yt){return function($t,Qt){for(var Zt,Jt=Qt?$t:$t.parentNode;Jt;){if(Zt=Jt.nodeType,Rt(Yt,Zt))return Jt;Jt=Jt.parentNode}return null}}function Ye(Yt,$t){if(Mt(Yt,$t))throw new bt("INVALID_NODE_TYPE_ERR")}function $e(Yt,$t){if(!Rt($t,Yt.nodeType))throw new bt("INVALID_NODE_TYPE_ERR")}function Qe(Yt,$t){if(0>$t||$t>(yt(Yt)?Yt.length:Yt.childNodes.length))throw new bt("INDEX_SIZE_ERR")}function Ze(Yt,$t){if(kt(Yt,!0)!==kt($t,!0))throw new bt("WRONG_DOCUMENT_ERR")}function Je(Yt){if(Pt(Yt,!0))throw new bt("NO_MODIFICATION_ALLOWED_ERR")}function et(Yt,$t){if(!Yt)throw new bt($t)}function tt(Yt){return vt&&ut.isBrokenNode(Yt)||!Rt(Ot,Yt.nodeType)&&!kt(Yt,!0)}function nt(Yt,$t){return $t<=(yt(Yt)?Yt.length:Yt.childNodes.length)}function ot(Yt){return!!Yt.startContainer&&!!Yt.endContainer&&!tt(Yt.startContainer)&&!tt(Yt.endContainer)&&nt(Yt.startContainer,Yt.startOffset)&&nt(Yt.endContainer,Yt.endOffset)}function at(Yt){if(!ot(Yt))throw new Error("Range error: Range is no longer valid after DOM mutation ("+Yt.inspect()+")")}function rt(Yt,$t){at(Yt);var Qt=Yt.startContainer,Zt=Yt.startOffset,Jt=Yt.endContainer,en=Yt.endOffset,tn=Qt===Jt;yt(Jt)&&0<en&&en<Jt.length&&wt(Jt,en,$t),yt(Qt)&&0<Zt&&Zt<Qt.length&&(Qt=wt(Qt,Zt,$t),tn?(en-=Zt,Jt=Qt):Jt==Qt.parentNode&&en>=Ct(Qt)&&en++,Zt=0),Yt.setStartAndEnd(Qt,Zt,Jt,en)}function st(Yt){at(Yt);var $t=Yt.commonAncestorContainer.parentNode.cloneNode(!1);return $t.appendChild(Yt.cloneContents()),$t.innerHTML}function lt(Yt){Yt.START_TO_START=Wt,Yt.START_TO_END=Vt,Yt.END_TO_END=Ut,Yt.END_TO_START=zt,Yt.NODE_BEFORE=Ft,Yt.NODE_AFTER=Kt,Yt.NODE_BEFORE_AND_AFTER=Gt,Yt.NODE_INSIDE=Xt}function it(Yt){lt(Yt),lt(Yt.prototype)}function dt(Yt,$t){return function(){at(this);var Qt,Zt,Jt=this.startContainer,en=this.startOffset,tn=this.commonAncestorContainer,nn=new Ge(this,!0);Jt!==tn&&(Qt=St(Jt,tn,!0),Zt=He(Qt),Jt=Zt.node,en=Zt.offset),Ve(nn,Je),nn.reset();var on=Yt(nn);return nn.detach(),$t(this,Jt,en,Jt,en),on}}function ct(Yt,$t){function Qt(tn,nn){return function(on){$e(on,_t),$e(At(on),Ot);var an=(tn?Be:He)(on);(nn?Zt:Jt)(this,an.node,an.offset)}}function Zt(tn,nn,on){var an=tn.endContainer,rn=tn.endOffset;(nn!==tn.startContainer||on!==tn.startOffset)&&((At(nn)!=At(an)||1==Et(nn,on,an,rn))&&(an=nn,rn=on),$t(tn,nn,on,an,rn))}function Jt(tn,nn,on){var an=tn.startContainer,rn=tn.startOffset;(nn!==tn.endContainer||on!==tn.endOffset)&&((At(nn)!=At(an)||-1==Et(nn,on,an,rn))&&(an=nn,rn=on),$t(tn,an,rn,nn,on))}var en=function(){};en.prototype=ke.rangePrototype,Yt.prototype=new en,ft.extend(Yt.prototype,{setStart:function(tn,nn){Ye(tn,!0),Qe(tn,nn),Zt(this,tn,nn)},setEnd:function(tn,nn){Ye(tn,!0),Qe(tn,nn),Jt(this,tn,nn)},setStartAndEnd:function(){var tn=arguments,nn=tn[0],on=tn[1],an=nn,rn=on;switch(tn.length){case 3:rn=tn[2];break;case 4:an=tn[2],rn=tn[3];}$t(this,nn,on,an,rn)},setBoundary:function(tn,nn,on){this["set"+(on?"Start":"End")](tn,nn)},setStartBefore:Qt(!0,!0),setStartAfter:Qt(!1,!0),setEndBefore:Qt(!0,!1),setEndAfter:Qt(!1,!1),collapse:function(tn){at(this),tn?$t(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):$t(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(tn){Ye(tn,!0),$t(this,tn,0,tn,Tt(tn))},selectNode:function(tn){Ye(tn,!1),$e(tn,_t);var nn=Be(tn),on=He(tn);$t(this,nn.node,nn.offset,on.node,on.offset)},extractContents:dt(ze,$t),deleteContents:dt(Ue,$t),canSurroundContents:function(){at(this),Je(this.startContainer),Je(this.endContainer);var tn=new Ge(this,!0),nn=tn._first&&Pe(tn._first,this)||tn._last&&Pe(tn._last,this);return tn.detach(),!nn},splitBoundaries:function(){rt(this)},splitBoundariesPreservingPositions:function(tn){rt(this,tn)},normalizeBoundaries:function(){at(this);var tn=this.startContainer,nn=this.startOffset,on=this.endContainer,an=this.endOffset,rn=function(mn){var gn=mn.nextSibling;gn&&gn.nodeType==mn.nodeType&&(on=mn,an=mn.length,mn.appendData(gn.data),gn.parentNode.removeChild(gn))},sn=function(mn){var gn=mn.previousSibling;if(gn&&gn.nodeType==mn.nodeType){tn=mn;var pn=mn.length;if(nn=gn.length,mn.insertData(0,gn.data),gn.parentNode.removeChild(gn),tn==on)an+=nn,on=tn;else if(on==mn.parentNode){var un=Ct(mn);an==un?(on=mn,an=pn):an>un&&an--}}},ln=!0;if(yt(on))on.length==an&&rn(on);else{if(0<an){var dn=on.childNodes[an-1];dn&&yt(dn)&&rn(dn)}ln=!this.collapsed}if(!ln)tn=on,nn=an;else if(yt(tn))0==nn&&sn(tn);else if(nn<tn.childNodes.length){var cn=tn.childNodes[nn];cn&&yt(cn)&&sn(cn)}$t(this,tn,nn,on,an)},collapseToPoint:function(tn,nn){Ye(tn,!0),Qe(tn,nn),this.setStartAndEnd(tn,nn)}}),it(Yt)}function mt(Yt){Yt.collapsed=Yt.startContainer===Yt.endContainer&&Yt.startOffset===Yt.endOffset,Yt.commonAncestorContainer=Yt.collapsed?Yt.startContainer:ut.getCommonAncestor(Yt.startContainer,Yt.endContainer)}function gt(Yt,$t,Qt,Zt,Jt){Yt.startContainer=$t,Yt.startOffset=Qt,Yt.endContainer=Zt,Yt.endOffset=Jt,Yt.document=ut.getDocument($t),mt(Yt)}function pt(Yt){this.startContainer=Yt,this.startOffset=0,this.endContainer=Yt,this.endOffset=0,this.document=Yt,mt(this)}var ut=ke.dom,ft=ke.util,ht=ut.DomPosition,bt=ke.DOMException,yt=ut.isCharacterDataNode,Ct=ut.getNodeIndex,Nt=ut.isOrIsAncestorOf,xt=ut.getDocument,Et=ut.comparePoints,wt=ut.splitDataNode,St=ut.getClosestAncestorIn,Tt=ut.getNodeLength,Rt=ut.arrayContains,At=ut.getRootContainer,vt=ke.features.crashyTextNodes;Ge.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var Yt=this._current=this._next;return Yt&&(this._next=Yt===this._last?null:Yt.nextSibling,yt(Yt)&&this.clonePartiallySelectedTextNodes&&(Yt===this.ec&&(Yt=Yt.cloneNode(!0)).deleteData(this.eo,Yt.length-this.eo),this._current===this.sc&&(Yt=Yt.cloneNode(!0)).deleteData(0,this.so))),Yt},remove:function(){var Yt,$t,Qt=this._current;yt(Qt)&&(Qt===this.sc||Qt===this.ec)?(Yt=Qt===this.sc?this.so:0,$t=Qt===this.ec?this.eo:Qt.length,Yt!=$t&&Qt.deleteData(Yt,$t-Yt)):Qt.parentNode&&Qt.parentNode.removeChild(Qt)},isPartiallySelectedSubtree:function(){var Yt=this._current;return Pe(Yt,this.range)},getSubtreeIterator:function(){var Yt;if(this.isSingleCharacterDataNode)Yt=this.range.cloneRange(),Yt.collapse(!1);else{Yt=new pt(Me(this.range));var $t=this._current,Qt=$t,Zt=0,Jt=$t,en=Tt($t);Nt($t,this.sc)&&(Qt=this.sc,Zt=this.so),Nt($t,this.ec)&&(Jt=this.ec,en=this.eo),gt(Yt,Qt,Zt,Jt,en)}return new Ge(Yt,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var _t=[1,3,4,5,7,8,10],Ot=[2,9,11],Dt=[1,3,4,5,7,8,10,11],It=[1,3,4,5,7,8],kt=Xe([9,11]),Pt=Xe([5,6,10,12]),Mt=Xe([6,10,12]),Bt=document.createElement("style"),Ht=!1;try{Bt.innerHTML="<b>x</b>",Ht=3==Bt.firstChild.nodeType}catch(Yt){}ke.features.htmlParsingConforms=Ht;var qt=Ht?function(Yt){var $t=this.startContainer,Qt=xt($t);if(!$t)throw new bt("INVALID_STATE_ERR");var Zt=null;return 1==$t.nodeType?Zt=$t:yt($t)&&(Zt=ut.parentElement($t)),Zt=null===Zt||"HTML"==Zt.nodeName&&ut.isHtmlNamespace(xt(Zt).documentElement)&&ut.isHtmlNamespace(Zt)?Qt.createElement("body"):Zt.cloneNode(!1),Zt.innerHTML=Yt,ut.fragmentFromNodeChildren(Zt)}:function(Yt){var $t=Me(this),Qt=$t.createElement("body");return Qt.innerHTML=Yt,ut.fragmentFromNodeChildren(Qt)},jt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Wt=0,Vt=1,Ut=2,zt=3,Ft=0,Kt=1,Gt=2,Xt=3;ft.extend(ke.rangePrototype,{compareBoundaryPoints:function(Yt,$t){at(this),Ze(this.startContainer,$t.startContainer);var Qt,Zt,Jt,en,tn=Yt==zt||Yt==Wt?"start":"end",nn=Yt==Vt||Yt==Wt?"start":"end";return Qt=this[tn+"Container"],Zt=this[tn+"Offset"],Jt=$t[nn+"Container"],en=$t[nn+"Offset"],Et(Qt,Zt,Jt,en)},insertNode:function(Yt){if(at(this),$e(Yt,Dt),Je(this.startContainer),Nt(Yt,this.startContainer))throw new bt("HIERARCHY_REQUEST_ERR");var $t=qe(Yt,this.startContainer,this.startOffset);this.setStartBefore($t)},cloneContents:function(){at(this);var Yt,$t;if(this.collapsed)return Me(this).createDocumentFragment();if(this.startContainer===this.endContainer&&yt(this.startContainer))return Yt=this.startContainer.cloneNode(!0),Yt.data=Yt.data.slice(this.startOffset,this.endOffset),$t=Me(this).createDocumentFragment(),$t.appendChild(Yt),$t;var Qt=new Ge(this,!0);return Yt=We(Qt),Qt.detach(),Yt},canSurroundContents:function(){at(this),Je(this.startContainer),Je(this.endContainer);var Yt=new Ge(this,!0),$t=Yt._first&&Pe(Yt._first,this)||Yt._last&&Pe(Yt._last,this);return Yt.detach(),!$t},surroundContents:function(Yt){if($e(Yt,It),!this.canSurroundContents())throw new bt("INVALID_STATE_ERR");var $t=this.extractContents();if(Yt.hasChildNodes())for(;Yt.lastChild;)Yt.removeChild(Yt.lastChild);qe(Yt,this.startContainer,this.startOffset),Yt.appendChild($t),this.selectNode(Yt)},cloneRange:function(){at(this);for(var Yt,$t=new pt(Me(this)),Qt=jt.length;Qt--;)Yt=jt[Qt],$t[Yt]=this[Yt];return $t},toString:function(){at(this);var Yt=this.startContainer;if(Yt===this.endContainer&&yt(Yt))return 3==Yt.nodeType||4==Yt.nodeType?Yt.data.slice(this.startOffset,this.endOffset):"";var $t=[],Qt=new Ge(this,!0);return Ve(Qt,function(Zt){(3==Zt.nodeType||4==Zt.nodeType)&&$t.push(Zt.data)}),Qt.detach(),$t.join("")},compareNode:function(Yt){at(this);var $t=Yt.parentNode,Qt=Ct(Yt);if(!$t)throw new bt("NOT_FOUND_ERR");var Zt=this.comparePoint($t,Qt),Jt=this.comparePoint($t,Qt+1);return 0>Zt?0<Jt?Gt:Ft:0<Jt?Kt:Xt},comparePoint:function(Yt,$t){return at(this),et(Yt,"HIERARCHY_REQUEST_ERR"),Ze(Yt,this.startContainer),0>Et(Yt,$t,this.startContainer,this.startOffset)?-1:0<Et(Yt,$t,this.endContainer,this.endOffset)?1:0},createContextualFragment:qt,toHtml:function(){return st(this)},intersectsNode:function(Yt,$t){if(at(this),et(Yt,"NOT_FOUND_ERR"),xt(Yt)!==Me(this))return!1;var Qt=Yt.parentNode,Zt=Ct(Yt);et(Qt,"NOT_FOUND_ERR");var Jt=Et(Qt,Zt,this.endContainer,this.endOffset),en=Et(Qt,Zt+1,this.startContainer,this.startOffset);return $t?0>=Jt&&0<=en:0>Jt&&0<en},isPointInRange:function(Yt,$t){return at(this),et(Yt,"HIERARCHY_REQUEST_ERR"),Ze(Yt,this.startContainer),0<=Et(Yt,$t,this.startContainer,this.startOffset)&&0>=Et(Yt,$t,this.endContainer,this.endOffset)},intersectsRange:function(Yt){return je(this,Yt,!1)},intersectsOrTouchesRange:function(Yt){return je(this,Yt,!0)},intersection:function(Yt){if(this.intersectsRange(Yt)){var $t=Et(this.startContainer,this.startOffset,Yt.startContainer,Yt.startOffset),Qt=Et(this.endContainer,this.endOffset,Yt.endContainer,Yt.endOffset),Zt=this.cloneRange();return-1==$t&&Zt.setStart(Yt.startContainer,Yt.startOffset),1==Qt&&Zt.setEnd(Yt.endContainer,Yt.endOffset),Zt}return null},union:function(Yt){if(this.intersectsOrTouchesRange(Yt)){var $t=this.cloneRange();return-1==Et(Yt.startContainer,Yt.startOffset,this.startContainer,this.startOffset)&&$t.setStart(Yt.startContainer,Yt.startOffset),1==Et(Yt.endContainer,Yt.endOffset,this.endContainer,this.endOffset)&&$t.setEnd(Yt.endContainer,Yt.endOffset),$t}throw new bt("Ranges do not intersect")},containsNode:function(Yt,$t){return $t?this.intersectsNode(Yt,!1):this.compareNode(Yt)==Xt},containsNodeContents:function(Yt){return 0<=this.comparePoint(Yt,0)&&0>=this.comparePoint(Yt,Tt(Yt))},containsRange:function(Yt){var $t=this.intersection(Yt);return null!==$t&&Yt.equals($t)},containsNodeText:function(Yt){var $t=this.cloneRange();$t.selectNode(Yt);var Qt=$t.getNodes([3]);if(0<Qt.length){$t.setStart(Qt[0],0);var Zt=Qt.pop();return $t.setEnd(Zt,Zt.length),this.containsRange($t)}return this.containsNodeContents(Yt)},getNodes:function(Yt,$t){return at(this),Fe(this,Yt,$t)},getDocument:function(){return Me(this)},collapseBefore:function(Yt){this.setEndBefore(Yt),this.collapse(!1)},collapseAfter:function(Yt){this.setStartAfter(Yt),this.collapse(!0)},getBookmark:function(Yt){var $t=Me(this),Qt=ke.createRange($t);Yt=Yt||ut.getBody($t),Qt.selectNodeContents(Yt);var Zt=this.intersection(Qt),Jt=0,en=0;return Zt&&(Qt.setEnd(Zt.startContainer,Zt.startOffset),Jt=Qt.toString().length,en=Jt+Zt.toString().length),{start:Jt,end:en,containerNode:Yt}},moveToBookmark:function(Yt){var $t=Yt.containerNode,Qt=0;this.setStart($t,0),this.collapse(!0);for(var Zt,Jt,en,tn,nn=[$t],on=!1,an=!1;!an&&(Zt=nn.pop());)if(3==Zt.nodeType)Jt=Qt+Zt.length,!on&&Yt.start>=Qt&&Yt.start<=Jt&&(this.setStart(Zt,Yt.start-Qt),on=!0),on&&Yt.end>=Qt&&Yt.end<=Jt&&(this.setEnd(Zt,Yt.end-Qt),an=!0),Qt=Jt;else for(tn=Zt.childNodes,en=tn.length;en--;)nn.push(tn[en])},getName:function(){return"DomRange"},equals:function(Yt){return pt.rangesEqual(this,Yt)},isValid:function(){return ot(this)},inspect:function(){return Ke(this)},detach:function(){}}),ct(pt,gt),ft.extend(pt,{rangeProperties:jt,RangeIterator:Ge,copyComparisonConstants:it,createPrototypeRange:ct,inspect:Ke,toHtml:st,getRangeDocument:Me,rangesEqual:function(Yt,$t){return Yt.startContainer===$t.startContainer&&Yt.startOffset===$t.startOffset&&Yt.endContainer===$t.endContainer&&Yt.endOffset===$t.endOffset}}),ke.DomRange=pt}),ve.createCoreModule("WrappedRange",["DomRange"],function(ke,Pe){var Me,Be,He=ke.dom,qe=ke.util,je=He.DomPosition,We=ke.DomRange,Ve=He.getBody,Ue=He.getContentDocument,ze=He.isCharacterDataNode;if(ke.features.implementsDomRange&&!function(){function Qe(it){for(var dt,ct=tt.length;ct--;)dt=tt[ct],it[dt]=it.nativeRange[dt];it.collapsed=it.startContainer===it.endContainer&&it.startOffset===it.endOffset}var Je,et,tt=We.rangeProperties;Me=function(it){if(!it)throw Pe.createError("WrappedRange: Range must be specified");this.nativeRange=it,Qe(this)},We.createPrototypeRange(Me,function(it,dt,ct,mt,gt){var pt=it.startContainer!==dt||it.startOffset!=ct,ut=it.endContainer!==mt||it.endOffset!=gt,ft=!it.equals(it.nativeRange);(pt||ut||ft)&&(it.setEnd(mt,gt),it.setStart(dt,ct))}),Je=Me.prototype,Je.selectNode=function(it){this.nativeRange.selectNode(it),Qe(this)},Je.cloneContents=function(){return this.nativeRange.cloneContents()},Je.surroundContents=function(it){this.nativeRange.surroundContents(it),Qe(this)},Je.collapse=function(it){this.nativeRange.collapse(it),Qe(this)},Je.cloneRange=function(){return new Me(this.nativeRange.cloneRange())},Je.refresh=function(){Qe(this)},Je.toString=function(){return this.nativeRange.toString()};var nt=document.createTextNode("test");Ve(document).appendChild(nt);var ot=document.createRange();ot.setStart(nt,0),ot.setEnd(nt,0);try{ot.setStart(nt,1),Je.setStart=function(it,dt){this.nativeRange.setStart(it,dt),Qe(this)},Je.setEnd=function(it,dt){this.nativeRange.setEnd(it,dt),Qe(this)},et=function(it){return function(dt){this.nativeRange[it](dt),Qe(this)}}}catch(it){Je.setStart=function(dt,ct){try{this.nativeRange.setStart(dt,ct)}catch(mt){this.nativeRange.setEnd(dt,ct),this.nativeRange.setStart(dt,ct)}Qe(this)},Je.setEnd=function(dt,ct){try{this.nativeRange.setEnd(dt,ct)}catch(mt){this.nativeRange.setStart(dt,ct),this.nativeRange.setEnd(dt,ct)}Qe(this)},et=function(dt,ct){return function(mt){try{this.nativeRange[dt](mt)}catch(gt){this.nativeRange[ct](mt),this.nativeRange[dt](mt)}Qe(this)}}}Je.setStartBefore=et("setStartBefore","setEndBefore"),Je.setStartAfter=et("setStartAfter","setEndAfter"),Je.setEndBefore=et("setEndBefore","setStartBefore"),Je.setEndAfter=et("setEndAfter","setStartAfter"),Je.selectNodeContents=function(it){this.setStartAndEnd(it,0,He.getNodeLength(it))},ot.selectNodeContents(nt),ot.setEnd(nt,3);var at=document.createRange();at.selectNodeContents(nt),at.setEnd(nt,4),at.setStart(nt,2),Je.compareBoundaryPoints=-1==ot.compareBoundaryPoints(ot.START_TO_END,at)&&1==ot.compareBoundaryPoints(ot.END_TO_START,at)?function(it,dt){return dt=dt.nativeRange||dt,it==dt.START_TO_END?it=dt.END_TO_START:it==dt.END_TO_START&&(it=dt.START_TO_END),this.nativeRange.compareBoundaryPoints(it,dt)}:function(it,dt){return this.nativeRange.compareBoundaryPoints(it,dt.nativeRange||dt)};var rt=document.createElement("div");rt.innerHTML="123";var st=rt.firstChild,lt=Ve(document);lt.appendChild(rt),ot.setStart(st,1),ot.setEnd(st,2),ot.deleteContents(),"13"==st.data&&(Je.deleteContents=function(){this.nativeRange.deleteContents(),Qe(this)},Je.extractContents=function(){var it=this.nativeRange.extractContents();return Qe(this),it}),lt.removeChild(rt),lt=null,qe.isHostMethod(ot,"createContextualFragment")&&(Je.createContextualFragment=function(it){return this.nativeRange.createContextualFragment(it)}),Ve(document).removeChild(nt),Je.getName=function(){return"WrappedRange"},ke.WrappedRange=Me,ke.createNativeRange=function(it){return it=Ue(it,Pe,"createNativeRange"),it.createRange()}}(),ke.features.implementsTextRange){var Fe=function(Qe){var Ze=Qe.parentElement(),Je=Qe.duplicate();Je.collapse(!0);var et=Je.parentElement();Je=Qe.duplicate(),Je.collapse(!1);var tt=Je.parentElement(),nt=et==tt?et:He.getCommonAncestor(et,tt);return nt==Ze?nt:He.getCommonAncestor(Ze,nt)},Ke=function(Qe){return 0==Qe.compareEndPoints("StartToEnd",Qe)},Ge=function(Qe,Ze,Je,et,tt){var nt=Qe.duplicate();nt.collapse(Je);var ot=nt.parentElement();if(He.isOrIsAncestorOf(Ze,ot)||(ot=Ze),!ot.canHaveHTML){var at=new je(ot.parentNode,He.getNodeIndex(ot));return{boundaryPosition:at,nodeInfo:{nodeIndex:at.offset,containerElement:at.node}}}var rt=He.getDocument(ot).createElement("span");rt.parentNode&&rt.parentNode.removeChild(rt);for(var st,lt,it,dt,ct,mt=Je?"StartToStart":"StartToEnd",gt=tt&&tt.containerElement==ot?tt.nodeIndex:0,pt=ot.childNodes.length,ut=pt,ft=ut;;){if(ft==pt?ot.appendChild(rt):ot.insertBefore(rt,ot.childNodes[ft]),nt.moveToElementText(rt),st=nt.compareEndPoints(mt,Qe),0==st||gt==ut)break;if(-1==st){if(ut==gt+1)break;gt=ft}else ut=ut==gt+1?gt:ft;ft=Math.floor((gt+ut)/2),ot.removeChild(rt)}if(ct=rt.nextSibling,-1==st&&ct&&ze(ct)){nt.setEndPoint(Je?"EndToStart":"EndToEnd",Qe);var ht;if(/[\r\n]/.test(ct.data)){var bt=nt.duplicate(),yt=bt.text.replace(/\r\n/g,"\r").length;for(ht=bt.moveStart("character",yt);-1==(st=bt.compareEndPoints("StartToEnd",bt));)ht++,bt.moveStart("character",1)}else ht=nt.text.length;dt=new je(ct,ht)}else lt=(et||!Je)&&rt.previousSibling,it=(et||Je)&&rt.nextSibling,dt=it&&ze(it)?new je(it,0):lt&&ze(lt)?new je(lt,lt.data.length):new je(ot,He.getNodeIndex(rt));return rt.parentNode.removeChild(rt),{boundaryPosition:dt,nodeInfo:{nodeIndex:ft,containerElement:ot}}},Xe=function(Qe,Ze){var Je,et,tt,nt,ot=Qe.offset,at=He.getDocument(Qe.node),rt=Ve(at).createTextRange(),st=ze(Qe.node);return st?(Je=Qe.node,et=Je.parentNode):(nt=Qe.node.childNodes,Je=ot<nt.length?nt[ot]:null,et=Qe.node),tt=at.createElement("span"),tt.innerHTML="&#feff;",Je?et.insertBefore(tt,Je):et.appendChild(tt),rt.moveToElementText(tt),rt.collapse(!Ze),et.removeChild(tt),st&&rt[Ze?"moveStart":"moveEnd"]("character",ot),rt};Be=function(Qe){this.textRange=Qe,this.refresh()},Be.prototype=new We(document),Be.prototype.refresh=function(){var Qe,Ze,Je,et=Fe(this.textRange);Ke(this.textRange)?Ze=Qe=Ge(this.textRange,et,!0,!0).boundaryPosition:(Je=Ge(this.textRange,et,!0,!1),Qe=Je.boundaryPosition,Ze=Ge(this.textRange,et,!1,!1,Je.nodeInfo).boundaryPosition),this.setStart(Qe.node,Qe.offset),this.setEnd(Ze.node,Ze.offset)},Be.prototype.getName=function(){return"WrappedTextRange"},We.copyComparisonConstants(Be);var Ye=function(Qe){if(Qe.collapsed)return Xe(new je(Qe.startContainer,Qe.startOffset),!0);var Ze=Xe(new je(Qe.startContainer,Qe.startOffset),!0),Je=Xe(new je(Qe.endContainer,Qe.endOffset),!1),et=Ve(We.getRangeDocument(Qe)).createTextRange();return et.setEndPoint("StartToStart",Ze),et.setEndPoint("EndToEnd",Je),et};if(Be.rangeToTextRange=Ye,Be.prototype.toTextRange=function(){return Ye(this)},ke.WrappedTextRange=Be,!ke.features.implementsDomRange||ke.config.preferTextRange){var $e=function(){return this}();"undefined"==typeof $e.Range&&($e.Range=Be),ke.createNativeRange=function(Qe){return Qe=Ue(Qe,Pe,"createNativeRange"),Ve(Qe).createTextRange()},ke.WrappedRange=Be}}ke.createRange=function(Qe){return Qe=Ue(Qe,Pe,"createRange"),new ke.WrappedRange(ke.createNativeRange(Qe))},ke.createRangyRange=function(Qe){return Qe=Ue(Qe,Pe,"createRangyRange"),new We(Qe)},ke.createIframeRange=function(Qe){return Pe.deprecationNotice("createIframeRange()","createRange(iframeEl)"),ke.createRange(Qe)},ke.createIframeRangyRange=function(Qe){return Pe.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),ke.createRangyRange(Qe)},ke.addShimListener(function(Qe){var Ze=Qe.document;"undefined"==typeof Ze.createRange&&(Ze.createRange=function(){return ke.createRange(Ze)}),Ze=Qe=null})}),ve.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(ke,Pe){function Me(Vt){return"string"==typeof Vt?/^backward(s)?$/i.test(Vt):!!Vt}function Be(Vt,Ut){if(Vt){if(it.isWindow(Vt))return Vt;if(Vt instanceof Qe)return Vt.win;var zt=it.getContentDocument(Vt,Pe,Ut);return it.getWindow(zt)}return window}function qe(Vt){return Be(Vt,"getDocSelection").document.selection}function je(Vt){var Ut=!1;return Vt.anchorNode&&(Ut=1==it.comparePoints(Vt.anchorNode,Vt.anchorOffset,Vt.focusNode,Vt.focusOffset)),Ut}function We(Vt,Ut,zt){var Ft=zt?"end":"start",Kt=zt?"start":"end";Vt.anchorNode=Ut[Ft+"Container"],Vt.anchorOffset=Ut[Ft+"Offset"],Vt.focusNode=Ut[Kt+"Container"],Vt.focusOffset=Ut[Kt+"Offset"]}function Ve(Vt){var Ut=Vt.nativeSelection;Vt.anchorNode=Ut.anchorNode,Vt.anchorOffset=Ut.anchorOffset,Vt.focusNode=Ut.focusNode,Vt.focusOffset=Ut.focusOffset}function Ue(Vt){Vt.anchorNode=Vt.focusNode=null,Vt.anchorOffset=Vt.focusOffset=0,Vt.rangeCount=0,Vt.isCollapsed=!0,Vt._ranges.length=0}function ze(Vt){var Ut;return Vt instanceof mt?(Ut=ke.createNativeRange(Vt.getDocument()),Ut.setEnd(Vt.endContainer,Vt.endOffset),Ut.setStart(Vt.startContainer,Vt.startOffset)):Vt instanceof gt?Ut=Vt.nativeRange:ft.implementsDomRange&&Vt instanceof it.getWindow(Vt.startContainer).Range&&(Ut=Vt),Ut}function Fe(Vt){if(!Vt.length||1!=Vt[0].nodeType)return!1;for(var Ut=1,zt=Vt.length;zt>Ut;++Ut)if(!it.isAncestorOf(Vt[0],Vt[Ut]))return!1;return!0}function Ke(Vt){var Ut=Vt.getNodes();if(!Fe(Ut))throw Pe.createError("getSingleElementFromRange: range "+Vt.inspect()+" did not consist of a single element");return Ut[0]}function Ge(Vt){return!!Vt&&"undefined"!=typeof Vt.text}function Xe(Vt,Ut){var zt=new gt(Ut);Vt._ranges=[zt],We(Vt,zt,!1),Vt.rangeCount=1,Vt.isCollapsed=zt.collapsed}function Ye(Vt){if(Vt._ranges.length=0,"None"==Vt.docSelection.type)Ue(Vt);else{var Ut=Vt.docSelection.createRange();if(Ge(Ut))Xe(Vt,Ut);else{Vt.rangeCount=Ut.length;for(var zt,Ft=bt(Ut.item(0)),Kt=0;Kt<Vt.rangeCount;++Kt)zt=ke.createRange(Ft),zt.selectNode(Ut.item(Kt)),Vt._ranges.push(zt);Vt.isCollapsed=1==Vt.rangeCount&&Vt._ranges[0].collapsed,We(Vt,Vt._ranges[Vt.rangeCount-1],!1)}}}function $e(Vt,Ut){for(var zt=Vt.docSelection.createRange(),Ft=Ke(Ut),Kt=bt(zt.item(0)),Gt=yt(Kt).createControlRange(),Xt=0,Yt=zt.length;Yt>Xt;++Xt)Gt.add(zt.item(Xt));try{Gt.add(Ft)}catch($t){throw Pe.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Gt.select(),Ye(Vt)}function Qe(Vt,Ut,zt){this.nativeSelection=Vt,this.docSelection=Ut,this._ranges=[],this.win=zt,this.refresh()}function Ze(Vt){Vt.win=Vt.anchorNode=Vt.focusNode=Vt._ranges=null,Vt.rangeCount=Vt.anchorOffset=Vt.focusOffset=0,Vt.detached=!0}function Je(Vt,Ut){for(var zt,Ft,Kt=Pt.length;Kt--;)if(zt=Pt[Kt],Ft=zt.selection,"deleteAll"==Ut)Ze(Ft);else if(zt.win==Vt)return"delete"==Ut?(Pt.splice(Kt,1),!0):Ft;return"deleteAll"==Ut&&(Pt.length=0),null}function et(Vt,Ut){for(var zt,Ft=bt(Ut[0].startContainer),Kt=yt(Ft).createControlRange(),Gt=0,Xt=Ut.length;Xt>Gt;++Gt){zt=Ke(Ut[Gt]);try{Kt.add(zt)}catch(Yt){throw Pe.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}Kt.select(),Ye(Vt)}function tt(Vt,Ut){if(Vt.win.document!=bt(Ut))throw new pt("WRONG_DOCUMENT_ERR")}function nt(Vt){return function(Ut,zt){var Ft;this.rangeCount?(Ft=this.getRangeAt(0),Ft["set"+(Vt?"Start":"End")](Ut,zt)):(Ft=ke.createRange(this.win.document),Ft.setStartAndEnd(Ut,zt)),this.setSingleRange(Ft,this.isBackward())}}function ot(Vt){var Ut=[],zt=new ut(Vt.anchorNode,Vt.anchorOffset),Ft=new ut(Vt.focusNode,Vt.focusOffset),Kt="function"==typeof Vt.getName?Vt.getName():"Selection";if("undefined"!=typeof Vt.rangeCount)for(var Gt=0,Xt=Vt.rangeCount;Xt>Gt;++Gt)Ut[Gt]=mt.inspect(Vt.getRangeAt(Gt));return"["+Kt+"(Ranges: "+Ut.join(", ")+")(anchor: "+zt.inspect()+", focus: "+Ft.inspect()+"]"}ke.config.checkSelectionRanges=!0;var at,rt,st="boolean",lt="number",it=ke.dom,dt=ke.util,ct=dt.isHostMethod,mt=ke.DomRange,gt=ke.WrappedRange,pt=ke.DOMException,ut=it.DomPosition,ft=ke.features,ht="Control",bt=it.getDocument,yt=it.getBody,Ct=mt.rangesEqual,Nt=ct(window,"getSelection"),xt=dt.isHostObject(document,"selection");ft.implementsWinGetSelection=Nt,ft.implementsDocSelection=xt;var Et=xt&&(!Nt||ke.config.preferTextRange);Et?(at=qe,ke.isSelectionValid=function(Vt){var Ut=Be(Vt,"isSelectionValid").document,zt=Ut.selection;return"None"!=zt.type||bt(zt.createRange().parentElement())==Ut}):Nt?(at=function(Vt){return Be(Vt,"getWinSelection").getSelection()},ke.isSelectionValid=function(){return!0}):Pe.fail("Neither document.selection or window.getSelection() detected."),ke.getNativeSelection=at;var wt=at(),St=ke.createNativeRange(document),Tt=yt(document),Rt=dt.areHostProperties(wt,["anchorNode","focusNode","anchorOffset","focusOffset"]);ft.selectionHasAnchorAndFocus=Rt;var At=ct(wt,"extend");ft.selectionHasExtend=At;var vt=typeof wt.rangeCount==lt;ft.selectionHasRangeCount=vt;var _t=!1,Ot=!0,Lt=At?function(Vt,Ut){var zt=mt.getRangeDocument(Ut),Ft=ke.createRange(zt);Ft.collapseToPoint(Ut.endContainer,Ut.endOffset),Vt.addRange(ze(Ft)),Vt.extend(Ut.startContainer,Ut.startOffset)}:null;dt.areHostMethods(wt,["addRange","getRangeAt","removeAllRanges"])&&typeof wt.rangeCount==lt&&ft.implementsDomRange&&!function(){var Vt=window.getSelection();if(Vt){for(var Ut=Vt.rangeCount,zt=1<Ut,Ft=[],Kt=je(Vt),Gt=0;Ut>Gt;++Gt)Ft[Gt]=Vt.getRangeAt(Gt);var Xt=yt(document),Yt=Xt.appendChild(document.createElement("div"));Yt.contentEditable="false";var $t=Yt.appendChild(document.createTextNode("\xA0\xA0\xA0")),Qt=document.createRange();if(Qt.setStart($t,1),Qt.collapse(!0),Vt.addRange(Qt),Ot=1==Vt.rangeCount,Vt.removeAllRanges(),!zt){var Zt=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(Zt&&36<=parseInt(Zt[1]))_t=!1;else{var Jt=Qt.cloneRange();Qt.setStart($t,0),Jt.setEnd($t,3),Jt.setStart($t,2),Vt.addRange(Qt),Vt.addRange(Jt),_t=2==Vt.rangeCount}}for(Xt.removeChild(Yt),Vt.removeAllRanges(),Gt=0;Ut>Gt;++Gt)0==Gt&&Kt?Lt?Lt(Vt,Ft[Gt]):(ke.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),Vt.addRange(Ft[Gt])):Vt.addRange(Ft[Gt])}}(),ft.selectionSupportsMultipleRanges=_t,ft.collapsedNonEditableSelectionsSupported=Ot;var Dt,It=!1;Tt&&ct(Tt,"createControlRange")&&(Dt=Tt.createControlRange(),dt.areHostProperties(Dt,["item","add"])&&(It=!0)),ft.implementsControlRange=It,rt=Rt?function(Vt){return Vt.anchorNode===Vt.focusNode&&Vt.anchorOffset===Vt.focusOffset}:function(Vt){return!!Vt.rangeCount&&Vt.getRangeAt(Vt.rangeCount-1).collapsed};var kt;ct(wt,"getRangeAt")?kt=function(Vt,Ut){try{return Vt.getRangeAt(Ut)}catch(zt){return null}}:Rt&&(kt=function(Vt){var Ut=bt(Vt.anchorNode),zt=ke.createRange(Ut);return zt.setStartAndEnd(Vt.anchorNode,Vt.anchorOffset,Vt.focusNode,Vt.focusOffset),zt.collapsed!==this.isCollapsed&&zt.setStartAndEnd(Vt.focusNode,Vt.focusOffset,Vt.anchorNode,Vt.anchorOffset),zt}),Qe.prototype=ke.selectionPrototype;var Pt=[],Mt=function(Vt){if(Vt&&Vt instanceof Qe)return Vt.refresh(),Vt;Vt=Be(Vt,"getNativeSelection");var Ut=Je(Vt),zt=at(Vt),Ft=xt?qe(Vt):null;return Ut?(Ut.nativeSelection=zt,Ut.docSelection=Ft,Ut.refresh()):(Ut=new Qe(zt,Ft,Vt),Pt.push({win:Vt,selection:Ut})),Ut};ke.getSelection=Mt,ke.getIframeSelection=function(Vt){return Pe.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),ke.getSelection(it.getIframeWindow(Vt))};var Bt=Qe.prototype;if(!Et&&Rt&&dt.areHostMethods(wt,["removeAllRanges","addRange"])){Bt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Ue(this)};var Ht=function(Vt,Ut){Lt(Vt.nativeSelection,Ut),Vt.refresh()};Bt.addRange=vt?function(Vt,Ut){if(It&&xt&&this.docSelection.type==ht)$e(this,Vt);else if(Me(Ut)&&At)Ht(this,Vt);else{var zt;if(_t?zt=this.rangeCount:(this.removeAllRanges(),zt=0),this.nativeSelection.addRange(ze(Vt).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==zt+1){if(ke.config.checkSelectionRanges){var Ft=kt(this.nativeSelection,this.rangeCount-1);Ft&&!Ct(Ft,Vt)&&(Vt=new gt(Ft))}this._ranges[this.rangeCount-1]=Vt,We(this,Vt,Wt(this.nativeSelection)),this.isCollapsed=rt(this)}else this.refresh()}}:function(Vt,Ut){Me(Ut)&&At?Ht(this,Vt):(this.nativeSelection.addRange(ze(Vt)),this.refresh())},Bt.setRanges=function(Vt){if(It&&xt&&1<Vt.length)et(this,Vt);else{this.removeAllRanges();for(var Ut=0,zt=Vt.length;zt>Ut;++Ut)this.addRange(Vt[Ut])}}}else{if(!(ct(wt,"empty")&&ct(St,"select")&&It&&Et))return Pe.fail("No means of selecting a Range or TextRange was found"),!1;Bt.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var Vt;if(this.anchorNode)Vt=bt(this.anchorNode);else if(this.docSelection.type==ht){var Ut=this.docSelection.createRange();Ut.length&&(Vt=bt(Ut.item(0)))}if(Vt){var zt=yt(Vt).createTextRange();zt.select(),this.docSelection.empty()}}}catch(Ft){}Ue(this)},Bt.addRange=function(Vt){this.docSelection.type==ht?$e(this,Vt):(ke.WrappedTextRange.rangeToTextRange(Vt).select(),this._ranges[0]=Vt,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,We(this,Vt,!1))},Bt.setRanges=function(Vt){this.removeAllRanges();var Ut=Vt.length;1<Ut?et(this,Vt):Ut&&this.addRange(Vt[0])}}Bt.getRangeAt=function(Vt){if(0>Vt||Vt>=this.rangeCount)throw new pt("INDEX_SIZE_ERR");return this._ranges[Vt].cloneRange()};var qt;if(Et)qt=function(Vt){var Ut;ke.isSelectionValid(Vt.win)?Ut=Vt.docSelection.createRange():(Ut=yt(Vt.win.document).createTextRange(),Ut.collapse(!0)),Vt.docSelection.type==ht?Ye(Vt):Ge(Ut)?Xe(Vt,Ut):Ue(Vt)};else if(ct(wt,"getRangeAt")&&typeof wt.rangeCount==lt)qt=function(Vt){if(It&&xt&&Vt.docSelection.type==ht)Ye(Vt);else if(Vt._ranges.length=Vt.rangeCount=Vt.nativeSelection.rangeCount,Vt.rangeCount){for(var Ut=0,zt=Vt.rangeCount;zt>Ut;++Ut)Vt._ranges[Ut]=new ke.WrappedRange(Vt.nativeSelection.getRangeAt(Ut));We(Vt,Vt._ranges[Vt.rangeCount-1],Wt(Vt.nativeSelection)),Vt.isCollapsed=rt(Vt)}else Ue(Vt)};else{if(!Rt||typeof wt.isCollapsed!=st||typeof St.collapsed!=st||!ft.implementsDomRange)return Pe.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;qt=function(Vt){var Ut,zt=Vt.nativeSelection;zt.anchorNode?(Ut=kt(zt,0),Vt._ranges=[Ut],Vt.rangeCount=1,Ve(Vt),Vt.isCollapsed=rt(Vt)):Ue(Vt)}}Bt.refresh=function(Vt){var Ut=Vt?this._ranges.slice(0):null,zt=this.anchorNode,Ft=this.anchorOffset;if(qt(this),Vt){var Kt=Ut.length;if(Kt!=this._ranges.length)return!0;if(this.anchorNode!=zt||this.anchorOffset!=Ft)return!0;for(;Kt--;)if(!Ct(Ut[Kt],this._ranges[Kt]))return!0;return!1}};var jt=function(Vt,Ut){var zt=Vt.getAllRanges();Vt.removeAllRanges();for(var Ft=0,Kt=zt.length;Kt>Ft;++Ft)Ct(Ut,zt[Ft])||Vt.addRange(zt[Ft]);Vt.rangeCount||Ue(Vt)};Bt.removeRange=It&&xt?function(Vt){if(this.docSelection.type==ht){for(var Ut,zt=this.docSelection.createRange(),Ft=Ke(Vt),Kt=bt(zt.item(0)),Gt=yt(Kt).createControlRange(),Xt=!1,Yt=0,$t=zt.length;$t>Yt;++Yt)Ut=zt.item(Yt),Ut!==Ft||Xt?Gt.add(zt.item(Yt)):Xt=!0;Gt.select(),Ye(this)}else jt(this,Vt)}:function(Vt){jt(this,Vt)};var Wt;!Et&&Rt&&ft.implementsDomRange?(Wt=je,Bt.isBackward=function(){return Wt(this)}):Wt=Bt.isBackward=function(){return!1},Bt.isBackwards=Bt.isBackward,Bt.toString=function(){for(var Vt=[],Ut=0,zt=this.rangeCount;zt>Ut;++Ut)Vt[Ut]=""+this._ranges[Ut];return Vt.join("")},Bt.collapse=function(Vt,Ut){tt(this,Vt);var zt=ke.createRange(Vt);zt.collapseToPoint(Vt,Ut),this.setSingleRange(zt),this.isCollapsed=!0},Bt.collapseToStart=function(){if(!this.rangeCount)throw new pt("INVALID_STATE_ERR");var Vt=this._ranges[0];this.collapse(Vt.startContainer,Vt.startOffset)},Bt.collapseToEnd=function(){if(!this.rangeCount)throw new pt("INVALID_STATE_ERR");var Vt=this._ranges[this.rangeCount-1];this.collapse(Vt.endContainer,Vt.endOffset)},Bt.selectAllChildren=function(Vt){tt(this,Vt);var Ut=ke.createRange(Vt);Ut.selectNodeContents(Vt),this.setSingleRange(Ut)},Bt.deleteFromDocument=function(){if(It&&xt&&this.docSelection.type==ht){for(var Vt,Ut=this.docSelection.createRange();Ut.length;)Vt=Ut.item(0),Ut.remove(Vt),Vt.parentNode.removeChild(Vt);this.refresh()}else if(this.rangeCount){var zt=this.getAllRanges();if(zt.length){this.removeAllRanges();for(var Ft=0,Kt=zt.length;Kt>Ft;++Ft)zt[Ft].deleteContents();this.addRange(zt[Kt-1])}}},Bt.eachRange=function(Vt,Ut){for(var zt=0,Ft=this._ranges.length;Ft>zt;++zt)if(Vt(this.getRangeAt(zt)))return Ut},Bt.getAllRanges=function(){var Vt=[];return this.eachRange(function(Ut){Vt.push(Ut)}),Vt},Bt.setSingleRange=function(Vt,Ut){this.removeAllRanges(),this.addRange(Vt,Ut)},Bt.callMethodOnEachRange=function(Vt,Ut){var zt=[];return this.eachRange(function(Ft){zt.push(Ft[Vt].apply(Ft,Ut))}),zt},Bt.setStart=nt(!0),Bt.setEnd=nt(!1),ke.rangePrototype.select=function(Vt){Mt(this.getDocument()).setSingleRange(this,Vt)},Bt.changeEachRange=function(Vt){var Ut=[],zt=this.isBackward();this.eachRange(function(Ft){Vt(Ft),Ut.push(Ft)}),this.removeAllRanges(),zt&&1==Ut.length?this.addRange(Ut[0],"backward"):this.setRanges(Ut)},Bt.containsNode=function(Vt,Ut){return this.eachRange(function(zt){return zt.containsNode(Vt,Ut)},!0)||!1},Bt.getBookmark=function(Vt){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[Vt])}},Bt.moveToBookmark=function(Vt){for(var Ut,zt,Ft=[],Kt=0;Ut=Vt.rangeBookmarks[Kt++];)zt=ke.createRange(this.win),zt.moveToBookmark(Ut),Ft.push(zt);Vt.backward?this.setSingleRange(Ft[0],"backward"):this.setRanges(Ft)},Bt.toHtml=function(){var Vt=[];return this.eachRange(function(Ut){Vt.push(mt.toHtml(Ut))}),Vt.join("")},ft.implementsTextRange&&(Bt.getNativeTextRange=function(){var Vt;if(Vt=this.docSelection){var Ut=Vt.createRange();if(Ge(Ut))return Ut;throw Pe.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return ke.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw Pe.createError("getNativeTextRange: selection contains no range")}),Bt.getName=function(){return"WrappedSelection"},Bt.inspect=function(){return ot(this)},Bt.detach=function(){Je(this.win,"delete"),Ze(this)},Qe.detachAll=function(){Je(null,"deleteAll")},Qe.inspect=ot,Qe.isDirectionBackward=Me,ke.Selection=Qe,ke.selectionPrototype=Bt,ke.addShimListener(function(Vt){"undefined"==typeof Vt.getSelection&&(Vt.getSelection=function(){return Mt(Vt)}),Vt=null})}),ve)},this),function(ee,te){"function"==typeof define&&define.amd?(ee(window.rangy),define(["rangy"],ee)):ee(te.rangy)}(function(ee){ee.createModule("SaveRestore",["WrappedRange"],function(te,ne){function oe(be,ye){return(ye||document).getElementById(be)}function ae(be,ye){var Ce,Ne="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),xe=fe.getDocument(be.startContainer),Ee=be.cloneRange();return Ee.collapse(ye),Ce=xe.createElement("span"),Ce.id=Ne,Ce.style.lineHeight="0",Ce.style.display="none",Ce.className="rangySelectionBoundary",Ce.appendChild(xe.createTextNode(he)),Ee.insertNode(Ce),Ce}function re(be,ye,Ce,Ne){var xe=oe(Ce,be);xe?(ye[Ne?"setStartBefore":"setEndBefore"](xe),xe.parentNode.removeChild(xe)):ne.warn("Marker element has been removed. Cannot restore selection.")}function se(be,ye){return ye.compareBoundaryPoints(be.START_TO_START,be)}function le(be,ye){var Ce,Ne,xe=te.DomRange.getRangeDocument(be),Ee=be.toString();return be.collapsed?(Ne=ae(be,!1),{document:xe,markerId:Ne.id,collapsed:!0}):(Ne=ae(be,!1),Ce=ae(be,!0),{document:xe,startMarkerId:Ce.id,endMarkerId:Ne.id,collapsed:!1,backward:ye,toString:function(){return"original text: '"+Ee+"', new text: '"+be.toString()+"'"}})}function ie(be,ye){var Ce=be.document;"undefined"==typeof ye&&(ye=!0);var Ne=te.createRange(Ce);if(be.collapsed){var xe=oe(be.markerId,Ce);if(xe){xe.style.display="inline";var Ee=xe.previousSibling;Ee&&3==Ee.nodeType?(xe.parentNode.removeChild(xe),Ne.collapseToPoint(Ee,Ee.length)):(Ne.collapseBefore(xe),xe.parentNode.removeChild(xe))}else ne.warn("Marker element has been removed. Cannot restore selection.")}else re(Ce,Ne,be.startMarkerId,!0),re(Ce,Ne,be.endMarkerId,!1);return ye&&Ne.normalizeBoundaries(),Ne}function de(be,ye){var Ce,Ne,xe=[];be=be.slice(0),be.sort(se);for(var Ee=0,we=be.length;we>Ee;++Ee)xe[Ee]=le(be[Ee],ye);for(Ee=we-1;0<=Ee;--Ee)Ce=be[Ee],Ne=te.DomRange.getRangeDocument(Ce),Ce.collapsed?Ce.collapseAfter(oe(xe[Ee].markerId,Ne)):(Ce.setEndBefore(oe(xe[Ee].endMarkerId,Ne)),Ce.setStartAfter(oe(xe[Ee].startMarkerId,Ne)));return xe}function me(be){for(var ye=[],Ce=be.length,Ne=Ce-1;0<=Ne;Ne--)ye[Ne]=ie(be[Ne],!0);return ye}function pe(be,ye){var Ce=oe(ye,be);Ce&&Ce.parentNode.removeChild(Ce)}var fe=te.dom,he="\uFEFF";te.util.extend(te,{saveRange:le,restoreRange:ie,saveRanges:de,restoreRanges:me,saveSelection:function(be){if(!te.isSelectionValid(be))return ne.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var ye=te.getSelection(be),Ce=ye.getAllRanges(),Ne=1==Ce.length&&ye.isBackward(),xe=de(Ce,Ne);return Ne?ye.setSingleRange(Ce[0],"backward"):ye.setRanges(Ce),{win:be,rangeInfos:xe,restored:!1}},restoreSelection:function(be,ye){if(!be.restored){var Ce=be.rangeInfos,Ne=te.getSelection(be.win),xe=me(Ce),Ee=Ce.length;1==Ee&&ye&&te.features.selectionHasExtend&&Ce[0].backward?(Ne.removeAllRanges(),Ne.addRange(xe[0],!0)):Ne.setRanges(xe),be.restored=!0}},removeMarkerElement:pe,removeMarkers:function(be){for(var ye,Ce=be.rangeInfos,Ne=0,xe=Ce.length;xe>Ne;++Ne)ye=Ce[Ne],ye.collapsed?pe(be.doc,ye.markerId):(pe(be.doc,ye.startMarkerId),pe(be.doc,ye.endMarkerId))}})})},this);var Base=function(){};Base.extend=function(ee,te){var ne=Base.prototype.extend;Base._prototyping=!0;var oe=new this;ne.call(oe,ee),oe.base=function(){},delete Base._prototyping;var ae=oe.constructor,re=oe.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==re)this._constructing=!0,ae.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||ne).call(arguments[0],oe)};return re.ancestor=this,re.extend=this.extend,re.forEach=this.forEach,re.implement=this.implement,re.prototype=oe,re.toString=this.toString,re.valueOf=function(se){return"object"==se?re:ae.valueOf()},ne.call(re,te),"function"==typeof re.init&&re.init(),re},Base.prototype={extend:function(ee,te){if(1<arguments.length){var ne=this[ee];if(ne&&"function"==typeof te&&(!ne.valueOf||ne.valueOf()!=te.valueOf())&&/\bbase\b/.test(te)){var oe=te.valueOf();te=function(){var de=this.base||Base.prototype.base;this.base=ne;var ce=oe.apply(this,arguments);return this.base=de,ce},te.valueOf=function(de){return"object"==de?te:oe},te.toString=Base.toString}this[ee]=te}else if(ee){var ae=Base.prototype.extend;Base._prototyping||"function"==typeof this||(ae=this.extend||ae);for(var re={toSource:null},se=["constructor","toString","valueOf"],le=Base._prototyping?0:1;ie=se[le++];)ee[ie]!=re[ie]&&ae.call(this,ie,ee[ie]);for(var ie in ee)re[ie]||ae.call(this,ie,ee[ie])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(ee,te,ne){for(var oe in ee)void 0===this.prototype[oe]&&te.call(ne,ee[oe],oe,ee)},implement:function(){for(var ee=0;ee<arguments.length;ee++)"function"==typeof arguments[ee]?arguments[ee](this.prototype):this.prototype.extend(arguments[ee]);return this},toString:function(){return this.valueOf()+""}}),wysihtml5.browser=function(){function ee(de){return+(/ipad|iphone|ipod/.test(de)&&de.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function te(de){return+(de.match(/android (\d+)/)||[void 0,0])[1]}function ne(de,ce){var me,ge=-1;return"Microsoft Internet Explorer"==navigator.appName?me=/MSIE ([0-9]{1,}[.0-9]{0,})/:"Netscape"==navigator.appName&&(me=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/),me&&null!=me.exec(navigator.userAgent)&&(ge=parseFloat(RegExp.$1)),-1!==ge&&(!de||(ce?"<"===ce?ge>de:">"===ce?de>ge:"<="===ce?ge>=de:">="===ce?de>=ge:void 0:de===ge))}var oe=navigator.userAgent,ae=document.createElement("div"),re=-1!==oe.indexOf("Gecko")&&-1===oe.indexOf("KHTML"),se=-1!==oe.indexOf("AppleWebKit/"),le=-1!==oe.indexOf("Chrome/"),ie=-1!==oe.indexOf("Opera/");return{USER_AGENT:oe,supported:function(){var de=this.USER_AGENT.toLowerCase(),me=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,ge=document.querySelector&&document.querySelectorAll,pe=this.isIos()&&5>ee(de)||this.isAndroid()&&4>te(de)||-1!==de.indexOf("opera mobi")||-1!==de.indexOf("hpwos/");return"contentEditable"in ae&&me&&ge&&!pe},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return /ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return ne()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return ne()},hasCurrentStyleProperty:function(){return"currentStyle"in ae},hasHistoryIssue:function(){return re&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return re},supportsPlaceholderAttributeOn:function(de){return"placeholder"in de},supportsEvent:function(de){return"on"+de in ae||function(){return ae.setAttribute("on"+de,"return;"),"function"==typeof ae["on"+de]}()},supportsEventsInIframeCorrectly:function(){return!ie},supportsHTML5Tags:function(de){var ce=de.createElement("div"),me="<article>foo</article>";return ce.innerHTML=me,ce.innerHTML.toLowerCase()===me},supportsCommand:function(){var de={formatBlock:ne(10,"<="),insertUnorderedList:ne(),insertOrderedList:ne()},ce={insertHTML:re};return function(me,ge){var pe=de[ge];if(!pe){try{return me.queryCommandSupported(ge)}catch(ue){}try{return me.queryCommandEnabled(ge)}catch(ue){return!!ce[ge]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return ne()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return re||ie||se},supportsGetAttributeCorrectly:function(){var de=document.createElement("td");return"1"!=de.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return re||ne()||ie},autoScrollsToCaret:function(){return!se},autoClosesUnclosedTags:function(){var de,ce,me=ae.cloneNode(!1);return me.innerHTML="<p><div></div>",ce=me.innerHTML.toLowerCase(),de="<p></p><div></div>"===ce||"<p><div></div></p>"===ce,this.autoClosesUnclosedTags=function(){return de},de},supportsNativeGetElementsByClassName:function(){return-1!==(document.getElementsByClassName+"").indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return ie},supportsSpeechApiOn:function(de){var ce=oe.match(/Chrome\/(\d+)/)||[void 0,0];return 11<=ce[1]&&("onwebkitspeechchange"in de||"speech"in de)},crashesWhenDefineProperty:function(de){return ne(9)&&("XMLHttpRequest"===de||"XDomainRequest"===de)},doesAsyncFocus:function(){return ne()},hasProblemsSettingCaretAfterImg:function(){return ne()},hasUndoInContextMenu:function(){return re||le||ie},hasInsertNodeIssue:function(){return ie},hasIframeFocusIssue:function(){return ne()},createsNestedInvalidMarkupAfterPaste:function(){return se},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(ee){return{contains:function(te){if(Array.isArray(te)){for(var ne=te.length;ne--;)if(-1!==wysihtml5.lang.array(ee).indexOf(te[ne]))return!0;return!1}return-1!==wysihtml5.lang.array(ee).indexOf(te)},indexOf:function(te){if(ee.indexOf)return ee.indexOf(te);for(var ne=0,oe=ee.length;oe>ne;ne++)if(ee[ne]===te)return ne;return-1},without:function(te){te=wysihtml5.lang.array(te);for(var ne=[],oe=0,ae=ee.length;ae>oe;oe++)te.contains(ee[oe])||ne.push(ee[oe]);return ne},get:function(){for(var te=0,ne=ee.length,oe=[];ne>te;te++)oe.push(ee[te]);return oe},map:function(te,ne){if(Array.prototype.map)return ee.map(te,ne);for(var oe=ee.length>>>0,ae=Array(oe),re=0;oe>re;re++)ae[re]=te.call(ne,ee[re],re,ee);return ae},unique:function(){for(var te=[],ne=ee.length,oe=0;ne>oe;)wysihtml5.lang.array(te).contains(ee[oe])||te.push(ee[oe]),oe++;return te}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(ee,te){return this.events=this.events||{},this.events[ee]=this.events[ee]||[],this.events[ee].push(te),this},off:function(ee,te){this.events=this.events||{};var ne,oe,ae=0;if(ee){for(ne=this.events[ee]||[],oe=[];ae<ne.length;ae++)ne[ae]!==te&&te&&oe.push(ne[ae]);this.events[ee]=oe}else this.events={};return this},fire:function(ee,te){this.events=this.events||{};for(var ne=this.events[ee]||[],oe=0;oe<ne.length;oe++)ne[oe].call(this,te);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(ee){return{merge:function(te){for(var ne in te)ee[ne]=te[ne];return this},get:function(){return ee},clone:function(te){var ne,oe={};if(null===ee||!wysihtml5.lang.object(ee).isPlainObject())return ee;for(ne in ee)ee.hasOwnProperty(ne)&&(oe[ne]=te?wysihtml5.lang.object(ee[ne]).clone(te):ee[ne]);return oe},isArray:function(){return"[object Array]"===Object.prototype.toString.call(ee)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(ee)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(ee)}}},function(){var ee=/^\s+/,te=/\s+$/,ne=/[&<>\t"]/g,oe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(ae){return ae=ae+"",{trim:function(){return ae.replace(ee,"").replace(te,"")},interpolate:function(re){for(var se in re)ae=this.replace("#{"+se+"}").by(re[se]);return ae},replace:function(re){return{by:function(se){return ae.split(re).join(se)}}},escapeHTML:function(re,se){var le=ae.replace(ne,function(ie){return oe[ie]});return re&&(le=le.replace(/(?:\r\n|\r|\n)/g,"<br />")),se&&(le=le.replace(/  /gi,"&nbsp; ")),le}}}}(),function(ee){function ne(ge){return ge.replace(ie,function(pe,ue){var fe=(ue.match(de)||[])[1]||"",he=me[fe];ue=ue.replace(de,""),ue.split(he).length>ue.split(fe).length&&(ue+=fe,fe="");var be=ue,ye=ue;return ue.length>ce&&(ye=ye.substr(0,ce)+"..."),"www."===be.substr(0,4)&&(be="http://"+be),"<a href=\""+be+"\">"+ye+"</a>"+fe})}function oe(ge){var pe=ge._wysihtml5_tempElement;return pe||(pe=ge._wysihtml5_tempElement=ge.createElement("div")),pe}function ae(ge){var pe=ge.parentNode,ue=ee.lang.string(ge.data).escapeHTML(),fe=oe(pe.ownerDocument);for(fe.innerHTML="<span></span>"+ne(ue),fe.removeChild(fe.firstChild);fe.firstChild;)pe.insertBefore(fe.firstChild,ge);pe.removeChild(ge)}function re(ge,pe){for(var ue;ge.parentNode;){if(ge=ge.parentNode,ue=ge.nodeName,ge.className&&ee.lang.array(ge.className.split(" ")).contains(pe))return!0;if(le.contains(ue))return!0;if("body"===ue)return!1}return!1}function se(ge,pe){if(!(le.contains(ge.nodeName)||ge.className&&ee.lang.array(ge.className.split(" ")).contains(pe))){if(ge.nodeType===ee.TEXT_NODE&&ge.data.match(ie))return void ae(ge);for(var ue=ee.lang.array(ge.childNodes).get(),fe=ue.length,he=0;fe>he;he++)se(ue[he],pe);return ge}}var le=ee.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),ie=/((https?:\/\/|www\.)[^\s<]{3,})/gi,de=/([^\w\/\-](,?))$/i,ce=100,me={")":"(","]":"[","}":"{"};ee.dom.autoLink=function(ge,pe){return re(ge,pe)?ge:(ge===ge.ownerDocument.documentElement&&(ge=ge.ownerDocument.body),se(ge,pe))},ee.dom.autoLink.URL_REG_EXP=ie}(wysihtml5),function(ee){var te=ee.dom;te.addClass=function(ne,oe){var ae=ne.classList;return ae?ae.add(oe):void(te.hasClass(ne,oe)||(ne.className+=" "+oe))},te.removeClass=function(ne,oe){var ae=ne.classList;return ae?ae.remove(oe):void(ne.className=ne.className.replace(new RegExp("(^|\\s+)"+oe+"(\\s+|$)")," "))},te.hasClass=function(ne,oe){var ae=ne.classList;if(ae)return ae.contains(oe);var re=ne.className;return 0<re.length&&(re==oe||new RegExp("(^|\\s)"+oe+"(\\s|$)").test(re))}}(wysihtml5),wysihtml5.dom.contains=function(){var ee=document.documentElement;return ee.contains?function(te,ne){return ne.nodeType!==wysihtml5.ELEMENT_NODE&&(ne=ne.parentNode),te!==ne&&te.contains(ne)}:ee.compareDocumentPosition?function(te,ne){return!!(16&te.compareDocumentPosition(ne))}:void 0}(),wysihtml5.dom.convertToList=function(){function ee(oe,ae){var re=oe.createElement("li");return ae.appendChild(re),re}function te(oe,ae){return oe.createElement(ae)}return function(oe,ae,re){if("UL"===oe.nodeName||"OL"===oe.nodeName||"MENU"===oe.nodeName)return oe;var se,le,ie,de,ce,me,ge,pe,ue,fe=oe.ownerDocument,he=te(fe,ae),be=oe.querySelectorAll("br"),ye=be.length;for(ue=0;ye>ue;ue++)for(de=be[ue];(ce=de.parentNode)&&ce!==oe&&ce.lastChild===de;){if("block"===wysihtml5.dom.getStyle("display").from(ce)){ce.removeChild(de);break}wysihtml5.dom.insert(de).after(de.parentNode)}for(se=wysihtml5.lang.array(oe.childNodes).get(),le=se.length,ue=0;le>ue;ue++)pe=pe||ee(fe,he),ie=se[ue],me="block"===wysihtml5.dom.getStyle("display").from(ie),ge="BR"===ie.nodeName,!me||re&&wysihtml5.dom.hasClass(ie,re)?ge?pe=pe.firstChild?null:pe:pe.appendChild(ie):(pe=pe.firstChild?ee(fe,he):pe,pe.appendChild(ie),pe=null);return 0===se.length&&ee(fe,he),oe.parentNode.replaceChild(he,oe),he}}(),wysihtml5.dom.copyAttributes=function(ee){return{from:function(te){return{to:function(ne){for(var oe,ae=0,re=ee.length;re>ae;ae++)oe=ee[ae],"undefined"!=typeof te[oe]&&""!==te[oe]&&(ne[oe]=te[oe]);return{andTo:arguments.callee}}}}}},function(ee){var te=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],ne=function(ae){return!!oe(ae)&&parseInt(ee.getStyle("width").from(ae),10)<ae.offsetWidth},oe=function(ae){for(var re=0,se=te.length;se>re;re++)if("border-box"===ee.getStyle(te[re]).from(ae))return te[re]};ee.copyStyles=function(ae){return{from:function(re){ne(re)&&(ae=wysihtml5.lang.array(ae).without(te));for(var se,le="",ie=ae.length,de=0;ie>de;de++)se=ae[de],le+=se+":"+ee.getStyle(se).from(re)+";";return{to:function(ce){return ee.setStyles(le).on(ce),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(ee){ee.dom.delegate=function(te,ne,oe,ae){return ee.dom.observe(te,oe,function(re){for(var se=re.target,le=ee.lang.array(te.querySelectorAll(ne));se&&se!==te;){if(le.contains(se)){ae.call(se,re);break}se=se.parentNode}})}}(wysihtml5),function(ee){ee.dom.domNode=function(te){var ne=[ee.ELEMENT_NODE,ee.TEXT_NODE],oe=function(ae){return ae.nodeType===ee.TEXT_NODE&&/^\s*$/g.test(ae.data)};return{prev:function(ae){var re=te.previousSibling,se=ae&&ae.nodeTypes?ae.nodeTypes:ne;return re?!ee.lang.array(se).contains(re.nodeType)||ae&&ae.ignoreBlankTexts&&oe(re)?ee.dom.domNode(re).prev(ae):re:null},next:function(ae){var re=te.nextSibling,se=ae&&ae.nodeTypes?ae.nodeTypes:ne;return re?!ee.lang.array(se).contains(re.nodeType)||ae&&ae.ignoreBlankTexts&&oe(re)?ee.dom.domNode(re).next(ae):re:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var ee=function(oe,ae){var re=ae.createElement("div");re.style.display="none",ae.body.appendChild(re);try{re.innerHTML=oe}catch(se){}return ae.body.removeChild(re),re},te=function(oe){if(!oe._wysihtml5_supportsHTML5Tags){for(var ae=0,re=ne.length;re>ae;ae++)oe.createElement(ne[ae]);oe._wysihtml5_supportsHTML5Tags=!0}},ne=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(oe,ae){ae=ae||document;var re;return"object"==typeof oe&&oe.nodeType?(re=ae.createElement("div"),re.appendChild(oe)):wysihtml5.browser.supportsHTML5Tags(ae)?(re=ae.createElement("div"),re.innerHTML=oe):(te(ae),re=ee(oe,ae)),re}}(),wysihtml5.dom.getParentElement=function(){function ee(ae,re){return re&&re.length?"string"==typeof re?ae===re:wysihtml5.lang.array(re).contains(ae):!0}function te(ae){return ae.nodeType===wysihtml5.ELEMENT_NODE}function ne(ae,re,se){var le=(ae.className||"").match(se)||[];return re?le[le.length-1]===re:!!le.length}function oe(ae,re,se){var le=(ae.getAttribute("style")||"").match(se)||[];return re?le[le.length-1]===re:!!le.length}return function(ae,re,se,le){var ie=re.cssStyle||re.styleRegExp,de=re.className||re.classRegExp;for(se=se||50;se--&&ae&&"BODY"!==ae.nodeName&&(!le||ae!==le);){if(te(ae)&&ee(ae.nodeName,re.nodeName)&&(!ie||oe(ae,re.cssStyle,re.styleRegExp))&&(!de||ne(ae,re.className,re.classRegExp)))return ae;ae=ae.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function ee(oe){return oe.replace(ne,function(ae){return ae.charAt(1).toUpperCase()})}var te={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},ne=/\-[a-z]/g;return function(oe){return{from:function(ae){if(ae.nodeType===wysihtml5.ELEMENT_NODE){var re=ae.ownerDocument,se=te[oe]||ee(oe),le=ae.style,ie=ae.currentStyle,de=le[se];if(de)return de;if(ie)try{return ie[se]}catch(ue){}var ce,me,ge=re.defaultView||re.parentWindow,pe=("height"===oe||"width"===oe)&&"TEXTAREA"===ae.nodeName;return ge.getComputedStyle?(pe&&(ce=le.overflow,le.overflow="hidden"),me=ge.getComputedStyle(ae,null).getPropertyValue(oe),pe&&(le.overflow=ce||""),me):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(ee,te){var ne=[];for(ee=ee.firstChild;ee;ee=ee.nextSibling)3==ee.nodeType?te&&/^\s*$/.test(ee.innerText||ee.textContent)||ne.push(ee):ne=ne.concat(wysihtml5.dom.getTextNodes(ee,te));return ne},wysihtml5.dom.hasElementWithTagName=function(){function ee(oe){return oe._wysihtml5_identifier||(oe._wysihtml5_identifier=ne++)}var te={},ne=1;return function(oe,ae){var re=ee(oe)+":"+ae,se=te[re];return se||(se=te[re]=oe.getElementsByTagName(ae)),0<se.length}}(),function(ee){function te(ae){return ae._wysihtml5_identifier||(ae._wysihtml5_identifier=oe++)}var ne={},oe=1;ee.dom.hasElementWithClassName=function(ae,re){if(!ee.browser.supportsNativeGetElementsByClassName())return!!ae.querySelector("."+re);var se=te(ae)+":"+re,le=ne[se];return le||(le=ne[se]=ae.getElementsByClassName(re)),0<le.length}}(wysihtml5),wysihtml5.dom.insert=function(ee){return{after:function(te){te.parentNode.insertBefore(ee,te.nextSibling)},before:function(te){te.parentNode.insertBefore(ee,te)},into:function(te){te.appendChild(ee)}}},wysihtml5.dom.insertCSS=function(ee){return ee=ee.join("\n"),{into:function(te){var ne=te.createElement("style");ne.type="text/css",ne.styleSheet?ne.styleSheet.cssText=ee:ne.appendChild(te.createTextNode(ee));var oe=te.querySelector("head link");if(oe)return void oe.parentNode.insertBefore(ne,oe);var ae=te.querySelector("head");ae&&ae.appendChild(ne)}}},function(ee){ee.dom.lineBreaks=function(te){function ne(ae){return"BR"===ae.nodeName}function oe(ae){return!!ne(ae)||!("block"!==ee.dom.getStyle("display").from(ae))}return{add:function(){var ae=te.ownerDocument,re=ee.dom.domNode(te).next({ignoreBlankTexts:!0}),se=ee.dom.domNode(te).prev({ignoreBlankTexts:!0});re&&!oe(re)&&ee.dom.insert(ae.createElement("br")).after(te),se&&!oe(se)&&ee.dom.insert(ae.createElement("br")).before(te)},remove:function(){var ae=ee.dom.domNode(te).next({ignoreBlankTexts:!0}),re=ee.dom.domNode(te).prev({ignoreBlankTexts:!0});ae&&ne(ae)&&ae.parentNode.removeChild(ae),re&&ne(re)&&re.parentNode.removeChild(re)}}}}(wysihtml5),wysihtml5.dom.observe=function(ee,te,ne){te="string"==typeof te?[te]:te;for(var oe,ae,re=0,se=te.length;se>re;re++)ae=te[re],ee.addEventListener?ee.addEventListener(ae,ne,!1):(oe=function(le){"target"in le||(le.target=le.srcElement),le.preventDefault=le.preventDefault||function(){this.returnValue=!1},le.stopPropagation=le.stopPropagation||function(){this.cancelBubble=!0},ne.call(ee,le)},ee.attachEvent("on"+ae,oe));return{stop:function(){for(var le,ie=0,de=te.length;de>ie;ie++)le=te[ie],ee.removeEventListener?ee.removeEventListener(le,ne,!1):ee.detachEvent("on"+le,oe)}}},wysihtml5.dom.parse=function(ee,te){function oe(Re,Ae,ve,_e){var Oe,Le,De,Ie=Re.nodeType,ke=Re.childNodes,Pe=ke.length,Me=fe[Ie],Be=0;if(_e&&1===Ie&&wysihtml5.dom.hasClass(Re,_e))return Re;if(Le=Me&&Me(Re,ve),!Le){if(!1===Le){for(Oe=Re.ownerDocument.createDocumentFragment(),Be=Pe;Be--;)ke[Be]&&(De=oe(ke[Be],Ae,ve,_e),De&&(ke[Be]===De&&Be--,Oe.insertBefore(De,Oe.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(Re)&&Oe.appendChild(Re.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(Re.nodeName.toLowerCase())&&Re.parentNode.lastChild!==Re&&(Re.nextSibling&&3===Re.nextSibling.nodeType&&/^\s/.test(Re.nextSibling.nodeValue)||Oe.appendChild(Re.ownerDocument.createTextNode(" "))),Oe.normalize&&Oe.normalize(),Oe}return null}for(Be=0;Pe>Be;Be++)ke[Be]&&(De=oe(ke[Be],Ae,ve,_e),De&&(ke[Be]===De&&Be--,Le.appendChild(De)));if(Ae&&Le.nodeName.toLowerCase()===he&&(!Le.childNodes.length||/^\s*$/gi.test(Le.innerHTML)&&(ve||"_wysihtml5-temp-placeholder"!==Re.className&&"rangySelectionBoundary"!==Re.className)||!Le.attributes.length)){for(Oe=Le.ownerDocument.createDocumentFragment();Le.firstChild;)Oe.appendChild(Le.firstChild);return Oe.normalize&&Oe.normalize(),Oe}return Le.normalize&&Le.normalize(),Le}function ae(Re,Ae){var ve,_e,Oe;for(ve in Ae)if(Ae.hasOwnProperty(ve)){wysihtml5.lang.object(Ae[ve]).isFunction()?_e=Ae[ve]:"string"==typeof Ae[ve]&&Te[Ae[ve]]&&(_e=Te[Ae[ve]]),Oe=Re.querySelectorAll(ve);for(var Le=Oe.length;Le--;)_e(Oe[Le])}}function se(Re,Ae,ve,_e){var Oe,Le;if("SPAN"===Re.nodeName&&!_e&&("_wysihtml5-temp-placeholder"===Re.className||"rangySelectionBoundary"===Re.className))return!0;for(Le in ve)if(ve.hasOwnProperty(Le)&&Ae.type_definitions&&Ae.type_definitions[Le]&&(Oe=Ae.type_definitions[Le],le(Re,Oe)))return!0;return!1}function le(Re,Ae){var ve,_e,Oe,Le,De,Ie=Re.getAttribute("class"),ke=Re.getAttribute("style");if(Ae.methods)for(var Pe in Ae.methods)if(Ae.methods.hasOwnProperty(Pe)&&Se[Pe]&&Se[Pe](Re))return!0;if(Ie&&Ae.classes){Ie=Ie.replace(/^\s+/g,"").replace(/\s+$/g,"").split(be),ve=Ie.length;for(var Me=0;ve>Me;Me++)if(Ae.classes[Ie[Me]])return!0}if(ke&&Ae.styles)for(_e in ke=ke.split(";"),Ae.styles)if(Ae.styles.hasOwnProperty(_e))for(var Be=ke.length;Be--;)if(De=ke[Be].split(":"),De[0].replace(/\s/g,"").toLowerCase()===_e&&(!0===Ae.styles[_e]||1===Ae.styles[_e]||wysihtml5.lang.array(Ae.styles[_e]).contains(De[1].replace(/\s/g,"").toLowerCase())))return!0;if(Ae.attrs)for(Oe in Ae.attrs)if(Ae.attrs.hasOwnProperty(Oe)&&(Le=wysihtml5.dom.getAttribute(Re,Oe),"string"==typeof Le&&-1<Le.search(Ae.attrs[Oe])))return!0;return!1}function ie(Re,Ae,ve){var _e,Oe;if(ve&&ve.keep_styles)for(_e in ve.keep_styles)if(ve.keep_styles.hasOwnProperty(_e)){if(Oe="float"===_e?Re.style.styleFloat||Re.style.cssFloat:Re.style[_e],ve.keep_styles[_e]instanceof RegExp&&!ve.keep_styles[_e].test(Oe))continue;"float"===_e?Ae.style[Re.style.styleFloat?"styleFloat":"cssFloat"]=Oe:Re.style[_e]&&(Ae.style[_e]=Oe)}}function de(Re,Ae){var ve=[];for(var _e in Ae)Ae.hasOwnProperty(_e)&&0===_e.indexOf(Re)&&ve.push(_e);return ve}function ce(Re,Ae,ve,_e){var Oe,Le=xe[ve];return Le&&(Ae||"alt"===Re&&"IMG"==_e)&&(Oe=Le(Ae),"string"==typeof Oe)&&Oe}function me(Re,Ae){var ve,_e,Oe,Le=wysihtml5.lang.object(Ce.attributes||{}).clone(),De=wysihtml5.lang.object(Le).merge(wysihtml5.lang.object(Ae||{}).clone()).get(),Ie={},ke=wysihtml5.dom.getAttributes(Re);for(ve in De)if(/\*$/.test(ve)){Oe=de(ve.slice(0,-1),ke);for(var Pe=0,Me=Oe.length;Me>Pe;Pe++)_e=ce(Oe[Pe],ke[Oe[Pe]],De[ve],Re.nodeName),!1!==_e&&(Ie[Oe[Pe]]=_e)}else _e=ce(ve,ke[ve],De[ve],Re.nodeName),!1!==_e&&(Ie[ve]=_e);return Ie}function ge(Re,Ae,ve,_e){var Oe,Le,De,Ie,ke,Pe={},Me=ve.set_class,Be=ve.add_class,He=ve.add_style,qe=ve.set_attributes,je=Ce.classes,We=0,Ve=[],Ue=[],ze=[],Fe=[];if(qe&&(Pe=wysihtml5.lang.object(qe).clone()),Pe=wysihtml5.lang.object(Pe).merge(me(Re,ve.check_attributes)).get(),Me&&Ve.push(Me),Be)for(Ie in Be)ke=we[Be[Ie]],ke&&(De=ke(wysihtml5.dom.getAttribute(Re,Ie)),"string"==typeof De&&Ve.push(De));if(He)for(Ie in He)ke=Ee[He[Ie]],ke&&(newStyle=ke(wysihtml5.dom.getAttribute(Re,Ie)),"string"==typeof newStyle&&Ue.push(newStyle));if(!("string"==typeof je&&"any"===je&&Re.getAttribute("class"))){for(_e||(je["_wysihtml5-temp-placeholder"]=1,je._rangySelectionBoundary=1,je["wysiwyg-tmp-selected-cell"]=1),Fe=Re.getAttribute("class"),Fe&&(Ve=Ve.concat(Fe.split(be))),Oe=Ve.length;Oe>We;We++)Le=Ve[We],je[Le]&&ze.push(Le);ze.length&&(Pe["class"]=wysihtml5.lang.array(ze).unique().join(" "))}else if(Ce.classes_blacklist){for(Fe=Re.getAttribute("class"),Fe&&(Ve=Ve.concat(Fe.split(be))),Oe=Ve.length;Oe>We;We++)Le=Ve[We],Ce.classes_blacklist[Le]||ze.push(Le);ze.length&&(Pe["class"]=wysihtml5.lang.array(ze).unique().join(" "))}else Pe["class"]=Re.getAttribute("class");for(Ie in Pe["class"]&&_e&&(Pe["class"]=Pe["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(Pe["class"])&&delete Pe["class"]),Ue.length&&(Pe.style=wysihtml5.lang.array(Ue).unique().join(" ")),Pe)try{Ae.setAttribute(Ie,Pe[Ie])}catch(Ke){}Pe.src&&("undefined"!=typeof Pe.width&&Ae.setAttribute("width",Pe.width),"undefined"!=typeof Pe.height&&Ae.setAttribute("height",Pe.height))}var fe={1:function(Re,Ae){var ve,_e,Oe,Le=Ce.tags,De=Re.nodeName.toLowerCase(),Ie=Re.scopeName;if(Re._wysihtml5)return null;if(Re._wysihtml5=1,"wysihtml5-temp"===Re.className)return null;if(Ie&&"HTML"!=Ie&&(De=Ie+":"+De),"outerHTML"in Re&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==Re.nodeName||"</p>"===Re.outerHTML.slice(-4).toLowerCase()||(De="div")),De in Le){if(ve=Le[De],!ve||ve.remove)return null;if(ve.unwrap)return!1;ve="string"==typeof ve?{rename_tag:ve}:ve}else{if(!Re.firstChild)return null;ve={rename_tag:he}}if(ve.one_of_type&&!se(Re,Ce,ve.one_of_type,Ae)){if(!ve.remove_action)return null;if("unwrap"===ve.remove_action)return!1;if("rename"!==ve.remove_action)return null;Oe=ve.remove_action_rename_to||he}return _e=Re.ownerDocument.createElement(Oe||ve.rename_tag||De),ge(Re,_e,ve,Ae),ie(Re,_e,ve),Re=null,_e.normalize&&_e.normalize(),_e},3:function(Re){var Ae=Re.nextSibling;if(!Ae||Ae.nodeType!==wysihtml5.TEXT_NODE){var ve=Re.data.replace(Ne,"");return Re.ownerDocument.createTextNode(ve)}Ae.data=Re.data.replace(Ne,"")+Ae.data.replace(Ne,"")},8:function(Re){return Ce.comments?Re.ownerDocument.createComment(Re.nodeValue):void 0}},he="span",be=/\s+/,ye={tags:{},classes:{}},Ce={},Ne=/\uFEFF/g,xe={url:function(){var Re=/^https?:\/\//i;return function(Ae){return Ae&&Ae.match(Re)?Ae.replace(Re,function(ve){return ve.toLowerCase()}):null}}(),src:function(){var Re=/^(\/|https?:\/\/)/i;return function(Ae){return Ae&&Ae.match(Re)?Ae.replace(Re,function(ve){return ve.toLowerCase()}):null}}(),href:function(){var Re=/^(#|\/|https?:\/\/|mailto:)/i;return function(Ae){return Ae&&Ae.match(Re)?Ae.replace(Re,function(ve){return ve.toLowerCase()}):null}}(),alt:function(){var Re=/[^ a-z0-9_\-]/gi;return function(Ae){return Ae?Ae.replace(Re,""):""}}(),numbers:function(){var Re=/\D/g;return function(Ae){return Ae=(Ae||"").replace(Re,""),Ae||null}}(),any:function(){return function(Re){return Re}}()},Ee={align_text:function(){var Re={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(Ae){return Re[(Ae+"").toLowerCase()]}}()},we={align_img:function(){var Re={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(Ae){return Re[(Ae+"").toLowerCase()]}}(),align_text:function(){var Re={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(Ae){return Re[(Ae+"").toLowerCase()]}}(),clear_br:function(){var Re={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(Ae){return Re[(Ae+"").toLowerCase()]}}(),size_font:function(){var Re={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(Ae){return Re[(Ae+"").charAt(0)]}}()},Se={has_visible_contet:function(){var Re,Ae=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(ve){if(Re=(ve.innerText||ve.textContent).replace(/\s/g,""),Re&&0<Re.length)return!0;for(var _e=Ae.length;_e--;)if(ve.querySelector(Ae[_e]))return!0;return ve.offsetWidth&&0<ve.offsetWidth&&ve.offsetHeight&&0<ve.offsetHeight}}()},Te={unwrap:function(Re){wysihtml5.dom.unwrap(Re)},remove:function(Re){Re.parentNode.removeChild(Re)}};return function(Re,Ae){wysihtml5.lang.object(Ce).merge(ye).merge(Ae.rules).get();var ve,_e,Oe,Le=Ae.context||Re.ownerDocument||document,De=Le.createDocumentFragment(),Ie="string"==typeof Re,ke=!1;for(!0===Ae.clearInternals&&(ke=!0),ve=Ie?wysihtml5.dom.getAsDom(Re,Le):Re,Ce.selectors&&ae(ve,Ce.selectors);ve.firstChild;)Oe=ve.firstChild,_e=oe(Oe,Ae.cleanUp,ke,Ae.uneditableClass),_e&&De.appendChild(_e),Oe!==_e&&ve.removeChild(Oe);if(Ae.unjoinNbsps)for(var Pe=wysihtml5.dom.getTextNodes(De),Me=Pe.length;Me--;)Pe[Me].nodeValue=Pe[Me].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return ve.innerHTML="",ve.appendChild(De),Ie?wysihtml5.quirks.getCorrectInnerHTML(ve):ve}(ee,te)},wysihtml5.dom.removeEmptyTextNodes=function(ee){for(var te,ne=wysihtml5.lang.array(ee.childNodes).get(),oe=ne.length,ae=0;oe>ae;ae++)te=ne[ae],te.nodeType===wysihtml5.TEXT_NODE&&""===te.data&&te.parentNode.removeChild(te)},wysihtml5.dom.renameElement=function(ee,te){for(var ne,oe=ee.ownerDocument.createElement(te);ne=ee.firstChild;)oe.appendChild(ne);return wysihtml5.dom.copyAttributes(["align","className"]).from(ee).to(oe),ee.parentNode.replaceChild(oe,ee),oe},wysihtml5.dom.replaceWithChildNodes=function(ee){if(ee.parentNode){if(!ee.firstChild)return void ee.parentNode.removeChild(ee);for(var te=ee.ownerDocument.createDocumentFragment();ee.firstChild;)te.appendChild(ee.firstChild);ee.parentNode.replaceChild(te,ee),ee=te=null}},function(ee){function te(re){return"block"===ee.getStyle("display").from(re)}function ne(re){return"BR"===re.nodeName}function oe(re){var se=re.ownerDocument.createElement("br");re.appendChild(se)}ee.resolveList=function(re,se){if(re.nodeName.match(/^(MENU|UL|OL)$/)){var le,ie,de,ce,me,ge,pe=re.ownerDocument,ue=pe.createDocumentFragment(),fe=wysihtml5.dom.domNode(re).prev({ignoreBlankTexts:!0});if(se)for(!fe||te(fe)||ne(fe)||oe(ue);ge=re.firstElementChild||re.firstChild;){for(ie=ge.lastChild;le=ge.firstChild;)de=le==ie,ce=de&&!te(le)&&!ne(le),ue.appendChild(le),ce&&oe(ue);ge.parentNode.removeChild(ge)}else for(;ge=re.firstElementChild||re.firstChild;){if(ge.querySelector&&ge.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;le=ge.firstChild;)ue.appendChild(le);else{for(me=pe.createElement("p");le=ge.firstChild;)me.appendChild(le);ue.appendChild(me)}ge.parentNode.removeChild(ge)}re.parentNode.replaceChild(ue,re)}}}(wysihtml5.dom),function(ee){var te=document,ne=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],oe=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],ae=["referrer","write","open","close"];ee.dom.Sandbox=Base.extend({constructor:function(re,se){this.callback=re||ee.EMPTY_FUNCTION,this.config=ee.lang.object({}).merge(se).get(),this.editableArea=this._createIframe()},insertInto:function(re){"string"==typeof re&&(re=te.getElementById(re)),re.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var re=this.getIframe();re.parentNode.removeChild(re)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var re=this,se=te.createElement("iframe");return se.className="wysihtml5-sandbox",ee.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(se),ee.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(se.src="javascript:'<html></html>'"),se.onload=function(){se.onreadystatechange=se.onload=null,re._onLoadIframe(se)},se.onreadystatechange=function(){/loaded|complete/.test(se.readyState)&&(se.onreadystatechange=se.onload=null,re._onLoadIframe(se))},se},_onLoadIframe:function(re){if(ee.dom.contains(te.documentElement,re)){var se=this,le=re.contentWindow,ie=re.contentWindow.document,de=te.characterSet||te.charset||"utf-8",ce=this._getHtml({charset:de,stylesheets:this.config.stylesheets});if(ie.open("text/html","replace"),ie.write(ce),ie.close(),this.getWindow=function(){return re.contentWindow},this.getDocument=function(){return re.contentWindow.document},le.onerror=function(pe,ue,fe){throw new Error("wysihtml5.Sandbox: "+pe,ue,fe)},!ee.browser.supportsSandboxedIframes()){var me,ge;for(me=0,ge=ne.length;ge>me;me++)this._unset(le,ne[me]);for(me=0,ge=oe.length;ge>me;me++)this._unset(le,oe[me],ee.EMPTY_FUNCTION);for(me=0,ge=ae.length;ge>me;me++)this._unset(ie,ae[me]);this._unset(ie,"cookie","",!0)}this.loaded=!0,setTimeout(function(){se.callback(se)},0)}},_getHtml:function(re){var se,le=re.stylesheets,ie="",de=0;if(le="string"==typeof le?[le]:le)for(se=le.length;se>de;de++)ie+="<link rel=\"stylesheet\" href=\""+le[de]+"\">";return re.stylesheets=ie,ee.lang.string("<!DOCTYPE html><html><head><meta charset=\"#{charset}\">#{stylesheets}</head><body></body></html>").interpolate(re)},_unset:function(re,se,le,ie){try{re[se]=le}catch(ce){}try{re.__defineGetter__(se,function(){return le})}catch(ce){}if(ie)try{re.__defineSetter__(se,function(){})}catch(ce){}if(!ee.browser.crashesWhenDefineProperty(se))try{var de={get:function(){return le}};ie&&(de.set=function(){}),Object.defineProperty(re,se,de)}catch(ce){}}})}(wysihtml5),function(ee){var te=document;ee.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(ne,oe,ae){this.callback=ne||ee.EMPTY_FUNCTION,this.config=ee.lang.object({}).merge(oe).get(),this.element=ae?this._bindElement(ae):this._createElement()},_createElement:function(){var ne=te.createElement("div");return ne.className="wysihtml5-sandbox",this._loadElement(ne),ne},_bindElement:function(ne){return ne.className=ne.className&&""!=ne.className?ne.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(ne,!0),ne},_loadElement:function(ne,oe){var ae=this;if(!oe){var re=this._getHtml();ne.innerHTML=re}this.getWindow=function(){return ne.ownerDocument.defaultView},this.getDocument=function(){return ne.ownerDocument},this.loaded=!0,setTimeout(function(){rangy&&rangy.getSelection&&rangy.getSelection().removeAllRanges(),ae.callback(ae)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var ee={className:"class"};wysihtml5.dom.setAttributes=function(te){return{on:function(ne){for(var oe in te)ne.setAttribute(ee[oe]||oe,te[oe])}}}}(),wysihtml5.dom.setStyles=function(ee){return{on:function(te){var ne=te.style;if("string"==typeof ee)return void(ne.cssText+=";"+ee);for(var oe in ee)"float"===oe?(ne.cssFloat=ee[oe],ne.styleFloat=ee[oe]):ne[oe]=ee[oe]}}},function(ee){ee.simulatePlaceholder=function(te,ne,oe){var ae="placeholder",re=function(){var le=0<ne.element.offsetWidth&&0<ne.element.offsetHeight;ne.hasPlaceholderSet()&&(ne.clear(),ne.element.focus(),le&&setTimeout(function(){var ie=ne.selection.getSelection();ie.focusNode&&ie.anchorNode||ne.selection.selectNode(ne.element.firstChild||ne.element)},0)),ne.placeholderSet=!1,ee.removeClass(ne.element,ae)},se=function(){ne.isEmpty()&&(ne.placeholderSet=!0,ne.setValue(oe),ee.addClass(ne.element,ae))};te.on("set_placeholder",se).on("unset_placeholder",re).on("focus:composer",re).on("paste:composer",re).on("blur:composer",se),se()}}(wysihtml5.dom),function(ee){var te=document.documentElement;"textContent"in te?(ee.setTextContent=function(ne,oe){ne.textContent=oe},ee.getTextContent=function(ne){return ne.textContent}):"innerText"in te?(ee.setTextContent=function(ne,oe){ne.innerText=oe},ee.getTextContent=function(ne){return ne.innerText}):(ee.setTextContent=function(ne,oe){ne.nodeValue=oe},ee.getTextContent=function(ne){return ne.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(ee,te){var ne=!wysihtml5.browser.supportsGetAttributeCorrectly();te=te.toLowerCase();var oe=ee.nodeName;if("IMG"==oe&&"src"==te&&!0===wysihtml5.dom.isLoadedImage(ee))return ee.src;if(ne&&"outerHTML"in ee){var ae=ee.outerHTML.toLowerCase(),re=-1!=ae.indexOf(" "+te+"=");return re?ee.getAttribute(te):null}return ee.getAttribute(te)},wysihtml5.dom.getAttributes=function(ee){var te,ne=!wysihtml5.browser.supportsGetAttributeCorrectly(),oe=ee.nodeName,ae=[];for(te in ee.attributes)(ee.attributes.hasOwnProperty&&ee.attributes.hasOwnProperty(te)||!ee.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(ee.attributes,te))&&ee.attributes[te].specified&&("IMG"==oe&&"src"==ee.attributes[te].name.toLowerCase()&&!0===wysihtml5.dom.isLoadedImage(ee)?ae.src=ee.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(ee.attributes[te].name.toLowerCase())&&ne?1!==ee.attributes[te].value&&(ae[ee.attributes[te].name]=ee.attributes[te].value):ae[ee.attributes[te].name]=ee.attributes[te].value);return ae},wysihtml5.dom.isLoadedImage=function(ee){try{return ee.complete&&!ee.mozMatchesSelector(":-moz-broken")}catch(te){if(ee.complete&&"complete"===ee.readyState)return!0}},function(ee){function te(ie,de){for(var ce,me=[],ge=0,pe=ie.length;pe>ge;ge++)if(ce=ie[ge].querySelectorAll(de))for(var ue=ce.length;ue--;me.unshift(ce[ue]));return me}function ne(ie){ie.parentNode.removeChild(ie)}function oe(ie,de){ie.parentNode.insertBefore(de,ie.nextSibling)}function ae(ie,de){for(var ce=ie.nextSibling;1!=ce.nodeType;)if(ce=ce.nextSibling,!de||de==ce.tagName.toLowerCase())return ce;return null}var re=ee.dom,se=function(ie){this.el=ie,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},le=function(ie,de){ie?(this.cell=ie,this.table=re.getParentElement(ie,{nodeName:["TABLE"]})):de&&(this.table=de,this.cell=this.table.querySelectorAll("th, td")[0])};le.prototype={addSpannedCellToMap:function(ie,de,ce,me,ge,pe){for(var ue=[],fe=ce+(pe?parseInt(pe,10)-1:0),he=me+(ge?parseInt(ge,10)-1:0),be=ce;fe>=be;be++){"undefined"==typeof de[be]&&(de[be]=[]);for(var ye=me;he>=ye;ye++)de[be][ye]=new se(ie),de[be][ye].isColspan=ge&&1<parseInt(ge,10),de[be][ye].isRowspan=pe&&1<parseInt(pe,10),de[be][ye].firstCol=ye==me,de[be][ye].lastCol=ye==he,de[be][ye].firstRow=be==ce,de[be][ye].lastRow=be==fe,de[be][ye].isReal=ye==me&&be==ce,de[be][ye].spanCollection=ue,ue.push(de[be][ye])}},setCellAsModified:function(ie){if(ie.modified=!0,0<ie.spanCollection.length)for(var de=0,ce=ie.spanCollection.length;ce>de;de++)ie.spanCollection[de].modified=!0},setTableMap:function(){var ie,de,ce,me,ge,pe,ue,fe,he=[],be=this.getTableRows();for(ie=0;ie<be.length;ie++)for(de=be[ie],ce=this.getRowCells(de),pe=0,"undefined"==typeof he[ie]&&(he[ie]=[]),me=0;me<ce.length;me++){for(ge=ce[me];"undefined"!=typeof he[ie][pe];)pe++;ue=re.getAttribute(ge,"colspan"),fe=re.getAttribute(ge,"rowspan"),ue||fe?(this.addSpannedCellToMap(ge,he,ie,pe,ue,fe),pe+=ue?parseInt(ue,10):1):(he[ie][pe]=new se(ge),pe++)}return this.map=he,he},getRowCells:function(ie){var de=this.table.querySelectorAll("table"),ce=de?te(de,"th, td"):[],me=ie.querySelectorAll("th, td"),ge=0<ce.length?ee.lang.array(me).without(ce):me;return ge},getTableRows:function(){var ie=this.table.querySelectorAll("table"),de=ie?te(ie,"tr"):[],ce=this.table.querySelectorAll("tr"),me=0<de.length?ee.lang.array(ce).without(de):ce;return me},getMapIndex:function(ie){for(var de=this.map.length,ce=this.map&&this.map[0]?this.map[0].length:0,me=0;de>me;me++)for(var ge=0;ce>ge;ge++)if(this.map[me][ge].el===ie)return{row:me,col:ge};return!1},getElementAtIndex:function(ie){return this.setTableMap(),this.map[ie.row]&&this.map[ie.row][ie.col]&&this.map[ie.row][ie.col].el?this.map[ie.row][ie.col].el:null},getMapElsTo:function(ie){var de=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(ie),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var ce=this.idx_start;this.idx_start=this.idx_end,this.idx_end=ce}if(this.idx_start.col>this.idx_end.col){var me=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=me}if(null!=this.idx_start&&null!=this.idx_end)for(var ge=this.idx_start.row,pe=this.idx_end.row;pe>=ge;ge++)for(var ue=this.idx_start.col,fe=this.idx_end.col;fe>=ue;ue++)de.push(this.map[ge][ue].el);return de},orderSelectionEnds:function(ie){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(ie),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var de=this.idx_start;this.idx_start=this.idx_end,this.idx_end=de}if(this.idx_start.col>this.idx_end.col){var ce=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=ce}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(ie,de,ce){for(var me,ge=this.table.ownerDocument,pe=ge.createDocumentFragment(),ue=0;de>ue;ue++){if(me=ge.createElement(ie),ce)for(var fe in ce)ce.hasOwnProperty(fe)&&me.setAttribute(fe,ce[fe]);me.appendChild(document.createTextNode("\xA0")),pe.appendChild(me)}return pe},correctColIndexForUnreals:function(ie,de){for(var ce=this.map[de],me=-1,ge=0;ie>ge;ge++)ce[ge].isReal&&me++;return me},getLastNewCellOnRow:function(ie,de){for(var ce,me,ge=this.getRowCells(ie),pe=0,ue=ge.length;ue>pe;pe++)if(ce=ge[pe],me=this.getMapIndex(ce),!1===me||"undefined"!=typeof de&&me.row!=de)return ce;return null},removeEmptyTable:function(){var ie=this.table.querySelectorAll("td, th");return ie&&0!=ie.length?!1:(ne(this.table),!0)},splitRowToCells:function(ie){if(ie.isColspan){var de=parseInt(re.getAttribute(ie.el,"colspan")||1,10),ce=ie.el.tagName.toLowerCase();if(1<de){var me=this.createCells(ce,de-1);oe(ie.el,me)}ie.el.removeAttribute("colspan")}},getRealRowEl:function(ie,de){var ce=null,me=null;de=de||this.idx;for(var ge=0,pe=this.map[de.row].length;pe>ge;ge++)if(me=this.map[de.row][ge],me.isReal&&(ce=re.getParentElement(me.el,{nodeName:["TR"]})))return ce;return null===ce&&ie&&(ce=re.getParentElement(this.map[de.row][de.col].el,{nodeName:["TR"]})||null),ce},injectRowAt:function(ie,de,ce,me,ge){var pe=this.getRealRowEl(!1,{row:ie,col:de}),ue=this.createCells(me,ce);if(pe){var fe=this.correctColIndexForUnreals(de,ie);0<=fe?oe(this.getRowCells(pe)[fe],ue):pe.insertBefore(ue,pe.firstChild)}else{var he=this.table.ownerDocument.createElement("tr");he.appendChild(ue),oe(re.getParentElement(ge.el,{nodeName:["TR"]}),he)}},canMerge:function(ie){if(this.to=ie,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var de=this.idx_start;this.idx_start=this.idx_end,this.idx_end=de}if(this.idx_start.col>this.idx_end.col){var ce=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=ce}for(var me=this.idx_start.row,ge=this.idx_end.row;ge>=me;me++)for(var pe=this.idx_start.col,ue=this.idx_end.col;ue>=pe;pe++)if(this.map[me][pe].isColspan||this.map[me][pe].isRowspan)return!1;return!0},decreaseCellSpan:function(ie,de){var ce=parseInt(re.getAttribute(ie.el,de),10)-1;1<=ce?ie.el.setAttribute(de,ce):(ie.el.removeAttribute(de),"colspan"==de&&(ie.isColspan=!1),"rowspan"==de&&(ie.isRowspan=!1),ie.firstCol=!0,ie.lastCol=!0,ie.firstRow=!0,ie.lastRow=!0,ie.isReal=!0)},removeSurplusLines:function(){var ie,de,ce,me,ge,pe,ue;if(this.setTableMap(),this.map){for(ce=0,me=this.map.length;me>ce;ce++){for(ie=this.map[ce],ue=!0,ge=0,pe=ie.length;pe>ge;ge++)if(de=ie[ge],!(re.getAttribute(de.el,"rowspan")&&1<parseInt(re.getAttribute(de.el,"rowspan"),10)&&!0!==de.firstRow)){ue=!1;break}if(ue)for(ge=0;pe>ge;ge++)this.decreaseCellSpan(ie[ge],"rowspan")}var fe=this.getTableRows();for(ce=0,me=fe.length;me>ce;ce++)ie=fe[ce],0==ie.childNodes.length&&/^\s*$/.test(ie.textContent||ie.innerText)&&ne(ie)}},fillMissingCells:function(){var ie=0,de=0,ce=null;if(this.setTableMap(),this.map){ie=this.map.length;for(var me=0;ie>me;me++)this.map[me].length>de&&(de=this.map[me].length);for(var ge=0;ie>ge;ge++)for(var pe=0;de>pe;pe++)this.map[ge]&&!this.map[ge][pe]&&0<pe&&(this.map[ge][pe]=new se(this.createCells("td",1)),ce=this.map[ge][pe-1],ce&&ce.el&&ce.el.parent&&oe(this.map[ge][pe-1].el,this.map[ge][pe].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var ie=this.map[this.idx.row][this.idx.col],de=re.getAttribute(ie.el,"colspan")?parseInt(re.getAttribute(ie.el,"colspan"),10):1,ce=ie.el.tagName.toLowerCase();if(ie.isRowspan){var me=parseInt(re.getAttribute(ie.el,"rowspan"),10);if(1<me)for(var ge=1;me-1>=ge;ge++)this.injectRowAt(this.idx.row+ge,this.idx.col,de,ce,ie);ie.el.removeAttribute("rowspan")}this.splitRowToCells(ie)}},merge:function(ie){if(this.rectify())if(this.canMerge(ie)){for(var de=this.idx_end.row-this.idx_start.row+1,ce=this.idx_end.col-this.idx_start.col+1,me=this.idx_start.row,ge=this.idx_end.row;ge>=me;me++)for(var pe=this.idx_start.col,ue=this.idx_end.col;ue>=pe;pe++)me==this.idx_start.row&&pe==this.idx_start.col?(1<de&&this.map[me][pe].el.setAttribute("rowspan",de),1<ce&&this.map[me][pe].el.setAttribute("colspan",ce)):(/^\s*<br\/?>\s*$/.test(this.map[me][pe].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[me][pe].el.innerHTML),ne(this.map[me][pe].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(ie){var de=this.getMapIndex(ie.el),ce=de.row+1,me={row:ce,col:de.col};if(ce<this.map.length){var ge=this.getRealRowEl(!1,me);if(null!==ge){var pe=this.correctColIndexForUnreals(me.col,me.row);if(0<=pe)oe(this.getRowCells(ge)[pe],ie.el);else{var ue=this.getLastNewCellOnRow(ge,ce);null===ue?ge.insertBefore(ie.el,ge.firstChild):oe(ue,ie.el)}2<parseInt(re.getAttribute(ie.el,"rowspan"),10)?ie.el.setAttribute("rowspan",parseInt(re.getAttribute(ie.el,"rowspan"),10)-1):ie.el.removeAttribute("rowspan")}}},removeRowCell:function(ie){ie.isReal?ie.isRowspan?this.collapseCellToNextRow(ie):ne(ie.el):2<parseInt(re.getAttribute(ie.el,"rowspan"),10)?ie.el.setAttribute("rowspan",parseInt(re.getAttribute(ie.el,"rowspan"),10)-1):ie.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var ie=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var de=this.map[this.idx.row],ce=0,me=de.length;me>ce;ce++)de[ce].isReal&&ie.push(de[ce].el);return ie},getColumnElementsByCell:function(){var ie=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var de=0,ce=this.map.length;ce>de;de++)this.map[de][this.idx.col]&&this.map[de][this.idx.col].isReal&&ie.push(this.map[de][this.idx.col].el);return ie},removeRow:function(){var ie=re.getParentElement(this.cell,{nodeName:["TR"]});if(ie){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var de=this.map[this.idx.row],ce=0,me=de.length;me>ce;ce++)de[ce].modified||(this.setCellAsModified(de[ce]),this.removeRowCell(de[ce]));ne(ie)}},removeColCell:function(ie){ie.isColspan?2<parseInt(re.getAttribute(ie.el,"colspan"),10)?ie.el.setAttribute("colspan",parseInt(re.getAttribute(ie.el,"colspan"),10)-1):ie.el.removeAttribute("colspan"):ie.isReal&&ne(ie.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var ie=0,de=this.map.length;de>ie;ie++)this.map[ie][this.idx.col].modified||(this.setCellAsModified(this.map[ie][this.idx.col]),this.removeColCell(this.map[ie][this.idx.col]))},remove:function(ie){this.rectify()&&("row"===ie?this.removeRow():"column"===ie?this.removeColumn():void 0,this.rectify())},addRow:function(ie){var de=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==ie&&re.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(re.getAttribute(this.cell,"rowspan"),10)-1),!1!==this.idx){for(var ce=this.map[this.idx.row],me=de.createElement("tr"),ge=0,pe=ce.length;pe>ge;ge++)ce[ge].modified||(this.setCellAsModified(ce[ge]),this.addRowCell(ce[ge],me,ie));switch(ie){case"below":oe(this.getRealRowEl(!0),me);break;case"above":var ue=re.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});ue&&ue.parentNode.insertBefore(me,ue);}}},addRowCell:function(ie,de,ce){var me=ie.isColspan?{colspan:re.getAttribute(ie.el,"colspan")}:null;ie.isReal?"above"!=ce&&ie.isRowspan?ie.el.setAttribute("rowspan",parseInt(re.getAttribute(ie.el,"rowspan"),10)+1):de.appendChild(this.createCells("td",1,me)):"above"!=ce&&ie.isRowspan&&ie.lastRow?de.appendChild(this.createCells("td",1,me)):c.isRowspan&&ie.el.attr("rowspan",parseInt(re.getAttribute(ie.el,"rowspan"),10)+1)},add:function(ie){this.rectify()&&(("below"==ie||"above"==ie)&&this.addRow(ie),("before"==ie||"after"==ie)&&this.addColumn(ie))},addColCell:function(ie,de,ce){var me,ge=ie.el.tagName.toLowerCase();"before"===ce?me=!ie.isColspan||ie.firstCol:"after"===ce?me=!ie.isColspan||ie.lastCol||ie.isColspan&&c.el==this.cell:void 0;me?("before"===ce?ie.el.parentNode.insertBefore(this.createCells(ge,1),ie.el):"after"===ce?oe(ie.el,this.createCells(ge,1)):void 0,ie.isRowspan&&this.handleCellAddWithRowspan(ie,de+1,ce)):ie.el.setAttribute("colspan",parseInt(re.getAttribute(ie.el,"colspan"),10)+1)},addColumn:function(ie){var de,ce;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==ie&&re.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(re.getAttribute(this.cell,"colspan"),10)-1),!1!==this.idx)for(var me=0,ge=this.map.length;ge>me;me++)de=this.map[me],de[this.idx.col]&&(ce=de[this.idx.col],ce.modified||(this.setCellAsModified(ce),this.addColCell(ce,me,ie)))},handleCellAddWithRowspan:function(ie,de,ce){for(var me,ge,pe,ue=parseInt(re.getAttribute(this.cell,"rowspan"),10)-1,fe=re.getParentElement(ie.el,{nodeName:["TR"]}),he=ie.el.tagName.toLowerCase(),be=this.table.ownerDocument,ye=0;ue>ye;ye++)(me=this.correctColIndexForUnreals(this.idx.col,de+ye),fe=ae(fe,"tr"))?0<me?"before"===ce?(ge=this.getRowCells(fe),0<me&&this.map[de+ye][this.idx.col].el!=ge[me]&&me==ge.length-1?oe(ge[me],this.createCells(he,1)):ge[me].parentNode.insertBefore(this.createCells(he,1),ge[me])):"after"===ce?oe(this.getRowCells(fe)[me],this.createCells(he,1)):void 0:fe.insertBefore(this.createCells(he,1),fe.firstChild):(pe=be.createElement("tr"),pe.appendChild(this.createCells(he,1)),this.table.appendChild(pe))}},re.table={getCellsBetween:function(ie,de){var ce=new le(ie);return ce.getMapElsTo(de)},addCells:function(ie,de){var ce=new le(ie);ce.add(de)},removeCells:function(ie,de){var ce=new le(ie);ce.remove(de)},mergeCellsBetween:function(ie,de){var ce=new le(ie);ce.merge(de)},unmergeCell:function(ie){var de=new le(ie);de.unmerge()},orderSelectionEnds:function(ie,de){var ce=new le(ie);return ce.orderSelectionEnds(de)},indexOf:function(ie){var de=new le(ie);return de.setTableMap(),de.getMapIndex(ie)},findCell:function(ie,de){var ce=new le(null,ie);return ce.getElementAtIndex(de)},findRowByCell:function(ie){var de=new le(ie);return de.getRowElementsByCell()},findColumnByCell:function(ie){var de=new le(ie);return de.getColumnElementsByCell()},canMerge:function(ie,de){var ce=new le(ie);return ce.canMerge(de)}}}(wysihtml5),wysihtml5.dom.query=function(ee,te){var ne,oe=[];ee.nodeType&&(ee=[ee]);for(var ae=0,re=ee.length;re>ae;ae++)if(ne=ee[ae].querySelectorAll(te))for(var se=ne.length;se--;oe.unshift(ne[se]));return oe},wysihtml5.dom.compareDocumentPosition=function(){var ee=document.documentElement;return ee.compareDocumentPosition?function(te,ne){return te.compareDocumentPosition(ne)}:function(te,ne){var oe,ae;if(oe=9===te.nodeType?te:te.ownerDocument,ae=9===ne.nodeType?ne:ne.ownerDocument,te===ne)return 0;if(te===ne.ownerDocument)return 20;if(te.ownerDocument===ne)return 10;if(oe!==ae)return 1;if(2===te.nodeType&&te.childNodes&&-1!==wysihtml5.lang.array(te.childNodes).indexOf(ne))return 20;if(2===ne.nodeType&&ne.childNodes&&-1!==wysihtml5.lang.array(ne.childNodes).indexOf(te))return 10;for(var re=te,se=[],le=null;re;){if(re==ne)return 10;se.push(re),re=re.parentNode}for(re=ne,le=null;re;){if(re==te)return 20;var ie=wysihtml5.lang.array(se).indexOf(re);if(-1!==ie){var de=se[ie],ce=wysihtml5.lang.array(de.childNodes).indexOf(se[ie-1]),me=wysihtml5.lang.array(de.childNodes).indexOf(le);return ce>me?2:4}le=re,re=re.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(ee){if(ee.parentNode){for(;ee.lastChild;)wysihtml5.dom.insert(ee.lastChild).after(ee);ee.parentNode.removeChild(ee)}},wysihtml5.dom.getPastedHtml=function(ee){var te;return ee.clipboardData&&(wysihtml5.lang.array(ee.clipboardData.types).contains("text/html")?te=ee.clipboardData.getData("text/html"):wysihtml5.lang.array(ee.clipboardData.types).contains("text/plain")&&(te=wysihtml5.lang.string(ee.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),te},wysihtml5.dom.getPastedHtmlWithDiv=function(ee,te){var ne=ee.selection.getBookmark(),oe=ee.element.ownerDocument,ae=oe.createElement("DIV");oe.body.appendChild(ae),ae.style.width="1px",ae.style.height="1px",ae.style.overflow="hidden",ae.setAttribute("contenteditable","true"),ae.focus(),setTimeout(function(){ee.selection.setBookmark(ne),te(ae.innerHTML),ae.parentNode.removeChild(ae)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var ee=function(oe){var ae=wysihtml5.lang.string(oe).trim(),re=ae.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+re+"$).)*$","i")},te=function(oe,ae){var re,se,le=wysihtml5.lang.object(oe).clone(!0);for(re in le.tags)if(le.tags.hasOwnProperty(re)&&le.tags[re].keep_styles)for(se in le.tags[re].keep_styles)le.tags[re].keep_styles.hasOwnProperty(se)&&ae[se]&&(le.tags[re].keep_styles[se]=ee(ae[se]));return le},ne=function(oe,ae){var re;if(!oe)return null;for(var se=0,le=oe.length;le>se;se++)if(oe[se].condition||(re=oe[se].set),oe[se].condition&&oe[se].condition.test(ae))return oe[se].set;return re};return function(oe,ae){var re,se={color:wysihtml5.dom.getStyle("color").from(ae.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(ae.referenceNode)},le=te(ne(ae.rules,oe)||{},se);return re=wysihtml5.dom.parse(oe,{rules:le,cleanUp:!0,context:ae.referenceNode.ownerDocument,uneditableClass:ae.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var ee=function(){var te=this;setTimeout(function(){var ne=te.innerHTML.toLowerCase();("<p>&nbsp;</p>"==ne||"<p>&nbsp;</p><p>&nbsp;</p>"==ne)&&(te.innerHTML="")},0)};return function(te){wysihtml5.dom.observe(te.element,["cut","keydown"],ee)}}(),function(ee){var te="%7E";ee.quirks.getCorrectInnerHTML=function(ne){var oe=ne.innerHTML;if(-1===oe.indexOf(te))return oe;var ae,re,se,le,ie=ne.querySelectorAll("[href*='~'], [src*='~']");for(le=0,se=ie.length;se>le;le++)ae=ie[le].href||ie[le].src,re=ee.lang.string(ae).replace("~").by(te),oe=ee.lang.string(oe).replace(re).by(ae);return oe}}(wysihtml5),function(ee){var te="wysihtml5-quirks-redraw";ee.quirks.redraw=function(ne){ee.dom.addClass(ne,te),ee.dom.removeClass(ne,te);try{var oe=ne.ownerDocument;oe.execCommand("italic",!1,null),oe.execCommand("italic",!1,null)}catch(ae){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(ee,te){function oe(fe){me.start=fe,me.end=fe,me.cells=[fe],me.table=ce.getParentElement(me.start,{nodeName:["TABLE"]}),me.table&&(ae(),ce.addClass(fe,ge),pe=ce.observe(ee,"mousemove",se),ue=ce.observe(ee,"mouseup",le),te.fire("tableselectstart").fire("tableselectstart:composer"))}function ae(){if(ee){var fe=ee.querySelectorAll("."+ge);if(0<fe.length)for(var he=0;he<fe.length;he++)ce.removeClass(fe[he],ge)}}function re(fe){for(var he=0;he<fe.length;he++)ce.addClass(fe[he],ge)}function se(fe){var he,be=null,ye=ce.getParentElement(fe.target,{nodeName:["TD","TH"]});ye&&me.table&&me.start&&(be=ce.getParentElement(ye,{nodeName:["TABLE"]}),be&&be===me.table&&(ae(),he=me.end,me.end=ye,me.cells=ce.table.getCellsBetween(me.start,ye),1<me.cells.length&&te.composer.selection.deselect(),re(me.cells),me.end!==he&&te.fire("tableselectchange").fire("tableselectchange:composer")))}function le(){pe.stop(),ue.stop(),te.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){ie()},0)}function ie(){var fe=ce.observe(ee.ownerDocument,"click",function(he){fe.stop(),ce.getParentElement(he.target,{nodeName:["TABLE"]})!=me.table&&(ae(),me.table=null,me.start=null,me.end=null,te.fire("tableunselect").fire("tableunselect:composer"))})}var ce=wysihtml5.dom,me={table:null,start:null,end:null,cells:null,select:function(fe,he){me.start=fe,me.end=he,me.table=ce.getParentElement(me.start,{nodeName:["TABLE"]}),selectedCells=ce.table.getCellsBetween(me.start,me.end),re(selectedCells),ie(),te.fire("tableselect").fire("tableselect:composer")}},ge="wysiwyg-tmp-selected-cell",pe=null,ue=null;return function(){return ce.observe(ee,"mousedown",function(fe){var he=wysihtml5.dom.getParentElement(fe.target,{nodeName:["TD","TH"]});he&&oe(he)}),me}()},function(ee){var te=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,ne=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,oe=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,ae=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,re=function(se){return new RegExp("(^|\\s|;)"+se+"\\s*:\\s*[^;$]+","gi")};ee.quirks.styleParser={parseColor:function(se,le){var ie,de,ce=re(le),me=se.match(ce),ge=10;if(me){for(var pe=me.length;pe--;)me[pe]=ee.lang.string(me[pe].split(":")[1]).trim();if(ie=me[me.length-1],te.test(ie))de=ie.match(te);else if(ne.test(ie))de=ie.match(ne);else if(oe.test(ie))de=ie.match(oe),ge=16;else if(ae.test(ie))return de=ie.match(ae),de.shift(),de.push(1),ee.lang.array(de).map(function(ue,fe){return 3>fe?16*parseInt(ue,16)+parseInt(ue,16):parseFloat(ue)});if(de)return de.shift(),de[3]||de.push(1),ee.lang.array(de).map(function(ue,fe){return 3>fe?parseInt(ue,ge):parseFloat(ue)})}return!1},unparseColor:function(se,le){if(le){if("hex"==le)return se[0].toString(16).toUpperCase()+se[1].toString(16).toUpperCase()+se[2].toString(16).toUpperCase();if("hash"==le)return"#"+se[0].toString(16).toUpperCase()+se[1].toString(16).toUpperCase()+se[2].toString(16).toUpperCase();if("rgb"==le)return"rgb("+se[0]+","+se[1]+","+se[2]+")";if("rgba"==le)return"rgba("+se[0]+","+se[1]+","+se[2]+","+se[3]+")";if("csv"==le)return se[0]+","+se[1]+","+se[2]+","+se[3]}return se[3]&&1!==se[3]?"rgba("+se[0]+","+se[1]+","+se[2]+","+se[3]+")":"rgb("+se[0]+","+se[1]+","+se[2]+")"},parseFontSize:function(se){var le=se.match(re("font-size"));return!!le&&ee.lang.string(le[le.length-1].split(":")[1]).trim()}}}(wysihtml5),function(ee){function te(re){var se=0;if(re.parentNode)do se+=re.offsetTop||0,re=re.offsetParent;while(re);return se}function ne(re,se){for(var le=0;se!==re;)if(le++,se=se.parentNode,!se)throw new Error("not a descendant of ancestor!");return le}function oe(re){if(!re.canSurroundContents())for(var se=re.commonAncestorContainer,le=ne(se,re.startContainer),ie=ne(se,re.endContainer);!re.canSurroundContents();)le>ie?(re.setStartBefore(re.startContainer),le=ne(se,re.startContainer)):(re.setEndAfter(re.endContainer),ie=ne(se,re.endContainer))}var ae=ee.dom;ee.Selection=Base.extend({constructor:function(re,se,le){window.rangy.init(),this.editor=re,this.composer=re.composer,this.doc=this.composer.doc,this.contain=se,this.unselectableClass=le||!1},getBookmark:function(){var re=this.getRange();return re&&oe(re),re&&re.cloneRange()},setBookmark:function(re){re&&this.setSelection(re)},setBefore:function(re){var se=rangy.createRange(this.doc);return se.setStartBefore(re),se.setEndBefore(re),this.setSelection(se)},setAfter:function(re){var se=rangy.createRange(this.doc);return se.setStartAfter(re),se.setEndAfter(re),this.setSelection(se)},selectNode:function(re,se){var le=rangy.createRange(this.doc),ie=re.nodeType===ee.ELEMENT_NODE,de="canHaveHTML"in re?re.canHaveHTML:"IMG"!==re.nodeName,ce=ie?re.innerHTML:re.data,me=""===ce||ce===ee.INVISIBLE_SPACE,ge=ae.getStyle("display").from(re);if(me&&ie&&de&&!se)try{re.innerHTML=ee.INVISIBLE_SPACE}catch(ue){}de?le.selectNodeContents(re):le.selectNode(re),de&&me&&ie?le.collapse("block"===ge||"list-item"===ge):de&&me&&(le.setStartAfter(re),le.setEndAfter(re)),this.setSelection(le)},getSelectedNode:function(re){var se,le;return re&&this.doc.selection&&"Control"===this.doc.selection.type&&(le=this.doc.selection.createRange(),le&&le.length)?le.item(0):(se=this.getSelection(this.doc),se.focusNode===se.anchorNode?se.focusNode:(le=this.getRange(this.doc),le?le.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var re=this.getRange();oe(re),this.setSelection(re)},getSelectedOwnNodes:function(){for(var re=this.getOwnRanges(),se=[],le=0,ie=re.length;ie>le;le++)se.push(re[le].commonAncestorContainer||this.doc.body);return se},findNodesInSelection:function(re){for(var se,le=this.getOwnRanges(),ie=[],de=0,ce=le.length;ce>de;de++)se=le[de].getNodes([1],function(me){return ee.lang.array(re).contains(me.nodeName)}),ie=ie.concat(se);return ie},containsUneditable:function(){for(var re=this.getOwnUneditables(),se=this.getSelection(),le=0,ie=re.length;ie>le;le++)if(se.containsNode(re[le]))return!0;return!1},deleteContents:function(){for(var re=this.getOwnRanges(),se=re.length;se--;)re[se].deleteContents();this.setSelection(re[0])},getPreviousNode:function(re,se){if(!re){var le=this.getSelection();re=le.anchorNode}if(re===this.contain)return!1;var ie,de=re.previousSibling;return de!==this.contain&&(de&&3!==de.nodeType&&1!==de.nodeType?de=this.getPreviousNode(de,se):de&&3===de.nodeType&&/^\s*$/.test(de.textContent)?de=this.getPreviousNode(de,se):se&&de&&1===de.nodeType&&!ee.lang.array(["BR","HR","IMG"]).contains(de.nodeName)&&/^[\s]*$/.test(de.innerHTML)?de=this.getPreviousNode(de,se):de||re===this.contain||(ie=re.parentNode,ie!==this.contain&&(de=this.getPreviousNode(ie,se))),de!==this.contain&&de)},getSelectionParentsByTag:function(){for(var re,se=this.getSelectedOwnNodes(),le=[],ie=0,de=se.length;de>ie;ie++)re=se[ie].nodeName&&"LI"===se[ie].nodeName?se[ie]:ee.dom.getParentElement(se[ie],{nodeName:["LI"]},!1,this.contain),re&&le.push(re);return le.length?le:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var re=this.getRange(),se=re.startContainer,le=re.startOffset,ie=rangy.createRange(this.doc);return ie.selectNodeContents(se),ie.setStart(se,le),ie}},caretIsLastInSelection:function(){var re=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),se=re.textContent;return /^\s*$/.test(se)},caretIsFirstInSelection:function(){var re=rangy.createRange(this.doc),se=this.getSelection(),le=this.getRange(),ie=le.startContainer;return ie.nodeType===ee.TEXT_NODE?this.isCollapsed()&&ie.nodeType===ee.TEXT_NODE&&/^\s*$/.test(ie.data.substr(0,le.startOffset)):(re.selectNodeContents(this.getRange().commonAncestorContainer),re.collapse(!0),this.isCollapsed()&&(re.startContainer===se.anchorNode||re.endContainer===se.anchorNode)&&re.startOffset===se.anchorOffset)},caretIsInTheBeginnig:function(re){var se=this.getSelection(),le=se.anchorNode,ie=se.anchorOffset;return re?0===ie&&(le.nodeName&&le.nodeName===re.toUpperCase()||ee.dom.getParentElement(le.parentNode,{nodeName:re},1)):0===ie&&!this.getPreviousNode(le,!0)},caretIsBeforeUneditable:function(){var re=this.getSelection(),se=re.anchorNode,le=re.anchorOffset;if(0===le){var ie=this.getPreviousNode(se,!0);if(ie)for(var de=this.getOwnUneditables(),ce=0,me=de.length;me>ce;ce++)if(ie===de[ce])return de[ce]}return!1},executeAndRestoreRangy:function(re){var se=this.doc.defaultView||this.doc.parentWindow,le=rangy.saveSelection(se);if(le)try{re()}catch(ie){setTimeout(function(){throw ie},0)}else re();rangy.restoreSelection(le)},executeAndRestore:function(re,se){var le,ie,de,ce,me,ge,pe,ue,fe=this.doc.body,he=se&&fe.scrollTop,be=se&&fe.scrollLeft,ye="_wysihtml5-temp-placeholder",Ce="<span class=\""+ye+"\">"+ee.INVISIBLE_SPACE+"</span>",Ne=this.getRange(!0);if(!Ne)return void re(fe,fe);Ne.collapsed||(pe=Ne.cloneRange(),ge=pe.createContextualFragment(Ce),pe.collapse(!1),pe.insertNode(ge),pe.detach()),me=Ne.createContextualFragment(Ce),Ne.insertNode(me),ge&&(le=this.contain.querySelectorAll("."+ye),Ne.setStartBefore(le[0]),Ne.setEndAfter(le[le.length-1])),this.setSelection(Ne);try{re(Ne.startContainer,Ne.endContainer)}catch(Ee){setTimeout(function(){throw Ee},0)}if(le=this.contain.querySelectorAll("."+ye),le&&le.length){ue=rangy.createRange(this.doc),de=le[0].nextSibling,1<le.length&&(ce=le[le.length-1].previousSibling),ce&&de?(ue.setStartBefore(de),ue.setEndAfter(ce)):(ie=this.doc.createTextNode(ee.INVISIBLE_SPACE),ae.insert(ie).after(le[0]),ue.setStartBefore(ie),ue.setEndAfter(ie)),this.setSelection(ue);for(var xe=le.length;xe--;)le[xe].parentNode.removeChild(le[xe])}else this.contain.focus();se&&(fe.scrollTop=he,fe.scrollLeft=be);try{le.parentNode.removeChild(le)}catch(Ee){}},set:function(re,se){var le=rangy.createRange(this.doc);le.setStart(re,se||0),this.setSelection(le)},insertHTML:function(re){var se,le=(rangy.createRange(this.doc),this.doc.createElement("DIV")),ie=this.doc.createDocumentFragment();for(le.innerHTML=re,se=le.lastChild;le.firstChild;)ie.appendChild(le.firstChild);this.insertNode(ie),se&&this.setAfter(se)},insertNode:function(re){var se=this.getRange();se&&se.insertNode(re)},surround:function(re){var se,le=this.getOwnRanges(),ie=[];if(0==le.length)return ie;for(var de=le.length;de--;){se=this.doc.createElement(re.nodeName),ie.push(se),re.className&&(se.className=re.className),re.cssStyle&&se.setAttribute("style",re.cssStyle);try{le[de].surroundContents(se),this.selectNode(se)}catch(ce){se.appendChild(le[de].extractContents()),le[de].insertNode(se)}}return ie},deblockAndSurround:function(re){var se,le,ie,de=this.doc.createElement("div"),ce=rangy.createRange(this.doc);if(de.className=re.className,this.composer.commands.exec("formatBlock",re.nodeName,re.className),se=this.contain.querySelectorAll("."+re.className),se[0]){for(se[0].parentNode.insertBefore(de,se[0]),ce.setStartBefore(se[0]),ce.setEndAfter(se[se.length-1]),le=ce.extractContents();le.firstChild;)if(ie=le.firstChild,1==ie.nodeType&&ee.dom.hasClass(ie,re.className)){for(;ie.firstChild;)de.appendChild(ie.firstChild);"BR"!==ie.nodeName&&de.appendChild(this.doc.createElement("br")),le.removeChild(ie)}else de.appendChild(ie);}else de=null;return de},scrollIntoView:function(){var re,se=this.doc,ie=se.documentElement.scrollHeight>se.documentElement.offsetHeight,de=se._wysihtml5ScrollIntoViewElement=se._wysihtml5ScrollIntoViewElement||function(){var ce=se.createElement("span");return ce.innerHTML=ee.INVISIBLE_SPACE,ce}();ie&&(this.insertNode(de),re=te(de),de.parentNode.removeChild(de),re>=se.body.scrollTop+se.documentElement.offsetHeight-5&&(se.body.scrollTop=re))},selectLine:function(){ee.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var re=this.doc.defaultView,se=re.getSelection();se.modify("move","left","lineboundary"),se.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var re,se,le,ie,de,ce=this.doc.selection.createRange(),me=ce.boundingTop,ge=this.doc.body.scrollWidth;if(ce.moveToPoint){for(0===me&&(le=this.doc.createElement("span"),this.insertNode(le),me=le.offsetTop,le.parentNode.removeChild(le)),me+=1,ie=-10;ge>ie;ie+=2)try{ce.moveToPoint(ie,me);break}catch(pe){}for(re=me,se=this.doc.selection.createRange(),de=ge;0<=de;de--)try{se.moveToPoint(de,re);break}catch(pe){}ce.setEndPoint("EndToEnd",se),ce.select()}},getText:function(){var re=this.getSelection();return re?re.toString():""},getNodes:function(re,se){var le=this.getRange();return le?le.getNodes([re],se):[]},fixRangeOverflow:function(re){if(this.contain&&this.contain.firstChild&&re){var se=re.compareNode(this.contain);if(2!==se)1===se&&re.setStartBefore(this.contain.firstChild),0===se&&re.setEndAfter(this.contain.lastChild),3===se&&(re.setStartBefore(this.contain.firstChild),re.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(re)){var le=re.endContainer.previousElementSibling;le&&re.setEnd(le,this._endOffsetForNode(le))}}},_endOffsetForNode:function(re){var se=document.createRange();return se.selectNodeContents(re),se.endOffset},_detectInlineRangeProblems:function(re){var se=ae.compareDocumentPosition(re.startContainer,re.endContainer);return 0==re.endOffset&&4&se},getRange:function(re){var se=this.getSelection(),le=se&&se.rangeCount&&se.getRangeAt(0);return!0!==re&&this.fixRangeOverflow(le),le},getOwnUneditables:function(){var re=ae.query(this.contain,"."+this.unselectableClass),se=ae.query(re,"."+this.unselectableClass);return ee.lang.array(re).without(se)},getOwnRanges:function(){var re,se=[],le=this.getRange();if(le&&se.push(le),this.unselectableClass&&this.contain&&le){var ie,de=this.getOwnUneditables();if(0<de.length)for(var ce=0,me=de.length;me>ce;ce++){re=[];for(var ge=0,pe=se.length;pe>ge;ge++){if(se[ge])switch(se[ge].compareNode(de[ce])){case 2:break;case 3:ie=se[ge].cloneRange(),ie.setEndBefore(de[ce]),re.push(ie),ie=se[ge].cloneRange(),ie.setStartAfter(de[ce]),re.push(ie);break;default:re.push(se[ge]);}se=re}}}return se},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(re){var se=this.doc.defaultView||this.doc.parentWindow,le=rangy.getSelection(se);return le.setSingleRange(re)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(re){var se=this.getRange(),le=se.commonAncestorContainer,ie=se.startContainer,de=se.endContainer;if(le.nodeType===ee.TEXT_NODE&&(le=le.parentNode),ie.nodeType===ee.TEXT_NODE&&!/^\s*$/.test(ie.data.substr(se.startOffset)))return!1;if(de.nodeType===ee.TEXT_NODE&&!/^\s*$/.test(de.data.substr(se.endOffset)))return!1;for(;ie&&ie!==le;){if(ie.nodeType!==ee.TEXT_NODE&&!ee.dom.contains(le,ie))return!1;if(ee.dom.domNode(ie).prev({ignoreBlankTexts:!0}))return!1;ie=ie.parentNode}for(;de&&de!==le;){if(de.nodeType!==ee.TEXT_NODE&&!ee.dom.contains(le,de))return!1;if(ee.dom.domNode(de).next({ignoreBlankTexts:!0}))return!1;de=de.parentNode}return!!ee.lang.array(re).contains(le.nodeName)&&le},deselect:function(){var re=this.getSelection();re&&re.removeAllRanges()}})}(wysihtml5),function(ee,te){function ne(xe,Ee,we){if(!xe.className)return!1;var Se=xe.className.match(we)||[];return Se[Se.length-1]===Ee}function oe(xe,Ee){return xe.getAttribute&&xe.getAttribute("style")&&(xe.getAttribute("style").match(Ee),!!xe.getAttribute("style").match(Ee))}function ae(xe,Ee,we){xe.getAttribute("style")?(le(xe,we),xe.getAttribute("style")&&!/^\s*$/.test(xe.getAttribute("style"))?xe.setAttribute("style",Ee+";"+xe.getAttribute("style")):xe.setAttribute("style",Ee)):xe.setAttribute("style",Ee)}function re(xe,Ee,we){xe.className?(se(xe,we),xe.className+=" "+Ee):xe.className=Ee}function se(xe,Ee){xe.className&&(xe.className=xe.className.replace(Ee,""))}function le(xe,Ee){var we,Se=[];if(xe.getAttribute("style")){we=xe.getAttribute("style").split(";");for(var Te=we.length;Te--;)we[Te].match(Ee)||/^\s*$/.test(we[Te])||Se.push(we[Te]);Se.length?xe.setAttribute("style",Se.join(";")):xe.removeAttribute("style")}}function ie(xe,Ee){var we=[],Se=Ee.split(";"),Te=xe.getAttribute("style");if(Te){Te=Te.replace(/\s/gi,"").toLowerCase(),we.push(new RegExp("(^|\\s|;)"+Ee.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var Re=Se.length;0<Re--;)/^\s*$/.test(Se[Re])||we.push(new RegExp("(^|\\s|;)"+Se[Re].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var Ae=0,ve=we.length;ve>Ae;Ae++)if(Te.match(we[Ae]))return we[Ae]}return!1}function de(xe,Ee,we,Se){return we?ie(xe,we):Se?ee.dom.hasClass(xe,Se):te.dom.arrayContains(Ee,xe.tagName.toLowerCase())}function ce(xe,Ee,we,Se){for(var Te=xe.length;Te--;)if(!de(xe[Te],Ee,we,Se))return!1;return!!xe.length}function me(xe,Ee,we){var Se=ie(xe,Ee);return Se?(le(xe,Se),"remove"):(ae(xe,Ee,we),"change")}function ge(xe,Ee){return xe.className.replace(Ne," ")==Ee.className.replace(Ne," ")}function pe(xe){for(var Ee=xe.parentNode;xe.firstChild;)Ee.insertBefore(xe.firstChild,xe);Ee.removeChild(xe)}function ue(xe,Ee){if(xe.attributes.length!=Ee.attributes.length)return!1;for(var we,Se,Te,Re=0,Ae=xe.attributes.length;Ae>Re;++Re)if(we=xe.attributes[Re],Te=we.name,"class"!=Te){if(Se=Ee.attributes.getNamedItem(Te),we.specified!=Se.specified)return!1;if(we.specified&&we.nodeValue!==Se.nodeValue)return!1}return!0}function fe(xe,Ee){return te.dom.isCharacterDataNode(xe)?0==Ee?!!xe.previousSibling:Ee!=xe.length||!!xe.nextSibling:0<Ee&&Ee<xe.childNodes.length}function he(xe,Ee,we,Se){var Te;if(te.dom.isCharacterDataNode(Ee)&&(0==we?(we=te.dom.getNodeIndex(Ee),Ee=Ee.parentNode):we==Ee.length?(we=te.dom.getNodeIndex(Ee)+1,Ee=Ee.parentNode):Te=te.dom.splitDataNode(Ee,we)),!(Te||Se&&Ee===Se)){Te=Ee.cloneNode(!1),Te.id&&Te.removeAttribute("id");for(var Re;Re=Ee.childNodes[we];)Te.appendChild(Re);te.dom.insertAfter(Te,Ee)}return Ee==xe?Te:he(xe,Te.parentNode,te.dom.getNodeIndex(Te),Se)}function be(xe){this.isElementMerge=xe.nodeType==ee.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?xe.lastChild:xe,this.textNodes=[this.firstTextNode]}function ye(xe,Ee,we,Se,Te,Re,Ae){this.tagNames=xe||[Ce],this.cssClass=Ee||!1!==Ee&&"",this.similarClassRegExp=we,this.cssStyle=Te||"",this.similarStyleRegExp=Re,this.normalize=Se,this.applyToAnyTagName=!1,this.container=Ae}var Ce="span",Ne=/\s+/g;be.prototype={doMerge:function(){for(var xe,Ee,we,Se=[],Te=0,Re=this.textNodes.length;Re>Te;++Te)xe=this.textNodes[Te],Ee=xe.parentNode,Se[Te]=xe.data,Te&&(Ee.removeChild(xe),Ee.hasChildNodes()||Ee.parentNode.removeChild(Ee));return this.firstTextNode.data=we=Se.join(""),we},getLength:function(){for(var xe=this.textNodes.length,Ee=0;xe--;)Ee+=this.textNodes[xe].length;return Ee},toString:function(){for(var xe=[],Ee=0,we=this.textNodes.length;we>Ee;++Ee)xe[Ee]="'"+this.textNodes[Ee].data+"'";return"[Merge("+xe.join(",")+")]"}},ye.prototype={getAncestorWithClass:function(xe){for(var Ee;xe;){if(Ee=this.cssClass?ne(xe,this.cssClass,this.similarClassRegExp):!(""!==this.cssStyle),xe.nodeType==ee.ELEMENT_NODE&&"false"!=xe.getAttribute("contenteditable")&&te.dom.arrayContains(this.tagNames,xe.tagName.toLowerCase())&&Ee)return xe;xe=xe.parentNode}return!1},getAncestorWithStyle:function(xe){for(var Ee;xe;){if(Ee=!!this.cssStyle&&oe(xe,this.similarStyleRegExp),xe.nodeType==ee.ELEMENT_NODE&&"false"!=xe.getAttribute("contenteditable")&&te.dom.arrayContains(this.tagNames,xe.tagName.toLowerCase())&&Ee)return xe;xe=xe.parentNode}return!1},getMatchingAncestor:function(xe){var Ee=this.getAncestorWithClass(xe),we=!1;return Ee?this.cssStyle&&(we="class"):(Ee=this.getAncestorWithStyle(xe),Ee&&(we="style")),{element:Ee,type:we}},postApply:function(xe,Ee){for(var we,Se,Te,Re=xe[0],Ae=xe[xe.length-1],ve=[],_e=Re,Oe=Ae,Le=0,De=Ae.length,Ie=0,ke=xe.length;ke>Ie;++Ie)Se=xe[Ie],Te=null,Se&&Se.parentNode&&(Te=this.getAdjacentMergeableTextNode(Se.parentNode,!1)),Te?(we||(we=new be(Te),ve.push(we)),we.textNodes.push(Se),Se===Re&&(_e=we.firstTextNode,Le=_e.length),Se===Ae&&(Oe=we.firstTextNode,De=we.getLength())):we=null;if(Ae&&Ae.parentNode){var Pe=this.getAdjacentMergeableTextNode(Ae.parentNode,!0);Pe&&(we||(we=new be(Ae),ve.push(we)),we.textNodes.push(Pe))}if(ve.length){for(Ie=0,ke=ve.length;ke>Ie;++Ie)ve[Ie].doMerge();Ee.setStart(_e,Le),Ee.setEnd(Oe,De)}},getAdjacentMergeableTextNode:function(xe,Ee){var we,Se=xe.nodeType==ee.TEXT_NODE,Te=Se?xe.parentNode:xe,Re=Ee?"nextSibling":"previousSibling";if(Se){if(we=xe[Re],we&&we.nodeType==ee.TEXT_NODE)return we;}else if(we=Te[Re],we&&this.areElementsMergeable(xe,we))return we[Ee?"firstChild":"lastChild"];return null},areElementsMergeable:function(xe,Ee){return te.dom.arrayContains(this.tagNames,(xe.tagName||"").toLowerCase())&&te.dom.arrayContains(this.tagNames,(Ee.tagName||"").toLowerCase())&&ge(xe,Ee)&&ue(xe,Ee)},createContainer:function(xe){var Ee=xe.createElement(this.tagNames[0]);return this.cssClass&&(Ee.className=this.cssClass),this.cssStyle&&Ee.setAttribute("style",this.cssStyle),Ee},applyToTextNode:function(xe){var Ee=xe.parentNode;if(1==Ee.childNodes.length&&te.dom.arrayContains(this.tagNames,Ee.tagName.toLowerCase()))this.cssClass&&re(Ee,this.cssClass,this.similarClassRegExp),this.cssStyle&&ae(Ee,this.cssStyle,this.similarStyleRegExp);else{var we=this.createContainer(te.dom.getDocument(xe));xe.parentNode.insertBefore(we,xe),we.appendChild(xe)}},isRemovable:function(xe){return te.dom.arrayContains(this.tagNames,xe.tagName.toLowerCase())&&""===ee.lang.string(xe.className).trim()&&(!xe.getAttribute("style")||""===ee.lang.string(xe.getAttribute("style")).trim())},undoToTextNode:function(xe,Ee,we,Se){var Te=!we,Re=we||Se,Ae=!1;if(!Ee.containsNode(Re)){var ve=Ee.cloneRange();ve.selectNode(Re),ve.isPointInRange(Ee.endContainer,Ee.endOffset)&&fe(Ee.endContainer,Ee.endOffset)&&(he(Re,Ee.endContainer,Ee.endOffset,this.container),Ee.setEndAfter(Re)),ve.isPointInRange(Ee.startContainer,Ee.startOffset)&&fe(Ee.startContainer,Ee.startOffset)&&(Re=he(Re,Ee.startContainer,Ee.startOffset,this.container))}!Te&&this.similarClassRegExp&&se(Re,this.similarClassRegExp),Te&&this.similarStyleRegExp&&(Ae="change"===me(Re,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(Re)&&!Ae&&pe(Re)},applyToRange:function(xe){for(var Ee,we=xe.length;we--;){if(Ee=xe[we].getNodes([ee.TEXT_NODE]),!Ee.length)try{var Se=this.createContainer(xe[we].endContainer.ownerDocument);return xe[we].surroundContents(Se),void this.selectNode(xe[we],Se)}catch(ve){}if(xe[we].splitBoundaries(),Ee=xe[we].getNodes([ee.TEXT_NODE]),Ee.length){for(var Te,Re=0,Ae=Ee.length;Ae>Re;++Re)Te=Ee[Re],this.getMatchingAncestor(Te).element||this.applyToTextNode(Te);xe[we].setStart(Ee[0],0),Te=Ee[Ee.length-1],xe[we].setEnd(Te,Te.length),this.normalize&&this.postApply(Ee,xe[we])}}},undoToRange:function(xe){for(var Ee,we,Se,Te=xe.length;Te--;){if(Ee=xe[Te].getNodes([ee.TEXT_NODE]),Ee.length)xe[Te].splitBoundaries(),Ee=xe[Te].getNodes([ee.TEXT_NODE]);else{var Re=xe[Te].endContainer.ownerDocument,Ae=Re.createTextNode(ee.INVISIBLE_SPACE);xe[Te].insertNode(Ae),xe[Te].selectNode(Ae),Ee=[Ae]}for(var ve=0,_e=Ee.length;_e>ve;++ve)xe[Te].isValid()&&(we=Ee[ve],Se=this.getMatchingAncestor(we),"style"===Se.type?this.undoToTextNode(we,xe[Te],!1,Se.element):Se.element&&this.undoToTextNode(we,xe[Te],Se.element));1==_e?this.selectNode(xe[Te],Ee[0]):(xe[Te].setStart(Ee[0],0),we=Ee[Ee.length-1],xe[Te].setEnd(we,we.length),this.normalize&&this.postApply(Ee,xe[Te]))}},selectNode:function(xe,Ee){var we=Ee.nodeType===ee.ELEMENT_NODE,Se=!("canHaveHTML"in Ee)||Ee.canHaveHTML,Te=we?Ee.innerHTML:Ee.data,Re=""===Te||Te===ee.INVISIBLE_SPACE;if(Re&&we&&Se)try{Ee.innerHTML=ee.INVISIBLE_SPACE}catch(Ae){}xe.selectNodeContents(Ee),Re&&we?xe.collapse(!1):Re&&(xe.setStartAfter(Ee),xe.setEndAfter(Ee))},getTextSelectedByRange:function(xe,Ee){var we=Ee.cloneRange();we.selectNodeContents(xe);var Se=we.intersection(Ee),Te=Se?Se.toString():"";return we.detach(),Te},isAppliedToRange:function(xe){for(var Ee,we,Se=[],Te="full",Re=xe.length;Re--;){if(we=xe[Re].getNodes([ee.TEXT_NODE]),!we.length)return Ee=this.getMatchingAncestor(xe[Re].startContainer).element,!!Ee&&{elements:[Ee],coverage:Te};for(var Ae,ve=0,_e=we.length;_e>ve;++ve)Ae=this.getTextSelectedByRange(we[ve],xe[Re]),Ee=this.getMatchingAncestor(we[ve]).element,Ee&&""!=Ae?(Se.push(Ee),1===ee.dom.getTextNodes(Ee,!0).length?Te="full":"full"==Te&&(Te="inline")):Ee||(Te="partial")}return!!Se.length&&{elements:Se,coverage:Te}},toggleRange:function(xe){var Ee,we=this.isAppliedToRange(xe);we?"full"===we.coverage?this.undoToRange(xe):"inline"===we.coverage?(Ee=ce(we.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(xe),Ee||this.applyToRange(xe)):(ce(we.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(xe),this.applyToRange(xe)):this.applyToRange(xe)}},ee.selection.HTMLApplier=ye}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(ee){this.editor=ee,this.composer=ee.composer,this.doc=this.composer.doc},support:function(ee){return wysihtml5.browser.supportsCommand(this.doc,ee)},exec:function(ee,te){var ne=wysihtml5.commands[ee],oe=wysihtml5.lang.array(arguments).get(),ae=ne&&ne.exec,re=null;if(this.editor.fire("beforecommand:composer"),ae)oe.unshift(this.composer),re=ae.apply(ne,oe);else try{re=this.doc.execCommand(ee,!1,te)}catch(se){}return this.editor.fire("aftercommand:composer"),re},state:function(ee){var te=wysihtml5.commands[ee],ne=wysihtml5.lang.array(arguments).get(),oe=te&&te.state;if(oe)return ne.unshift(this.composer),oe.apply(te,ne);try{return this.doc.queryCommandState(ee)}catch(ae){return!1}},stateValue:function(ee){var te=wysihtml5.commands[ee],ne=wysihtml5.lang.array(arguments).get(),oe=te&&te.stateValue;return!!oe&&(ne.unshift(this.composer),oe.apply(te,ne))}}),wysihtml5.commands.bold={exec:function(ee,te){wysihtml5.commands.formatInline.execWithToggle(ee,te,"b")},state:function(ee,te){return wysihtml5.commands.formatInline.state(ee,te,"b")}},function(ee){function te(se,le){var ie,de,ce,me,ge,pe,ue,fe,he,be=se.doc,ye="_wysihtml5-temp-"+ +new Date,Ce=/non-matching-class/g,Ne=0;for(ee.commands.formatInline.exec(se,oe,ae,ye,Ce,oe,oe,!0,!0),de=be.querySelectorAll(ae+"."+ye),ie=de.length;ie>Ne;Ne++)for(he in ce=de[Ne],ce.removeAttribute("class"),le)"text"!==he&&ce.setAttribute(he,le[he]);pe=ce,1===ie&&(ue=re.getTextContent(ce),me=!!ce.querySelector("*"),ge=""===ue||ue===ee.INVISIBLE_SPACE,!me&&ge&&(re.setTextContent(ce,le.text||ce.href),fe=be.createTextNode(" "),se.selection.setAfter(ce),re.insert(fe).after(ce),pe=fe)),se.selection.setAfter(pe)}function ne(se,le,ie){for(var de,ce=le.length;ce--;){de=le[ce].attributes;for(var me=de.length;me--;)le[ce].removeAttribute(de.item(me).name);for(var ge in ie)ie.hasOwnProperty(ge)&&le[ce].setAttribute(ge,ie[ge])}}var oe,ae="A",re=ee.dom;ee.commands.createLink={exec:function(se,le,ie){var de=this.state(se,le);de?se.selection.executeAndRestore(function(){ne(se,de,ie)}):(ie="object"==typeof ie?ie:{href:ie},te(se,ie))},state:function(se,le){return ee.commands.formatInline.state(se,le,"A")}}}(wysihtml5),function(ee){function te(oe,ae){for(var re,se,le,ie=ae.length,de=0;ie>de;de++)re=ae[de],se=ne.getParentElement(re,{nodeName:"code"}),le=ne.getTextContent(re),le.match(ne.autoLink.URL_REG_EXP)&&!se?se=ne.renameElement(re,"code"):ne.replaceWithChildNodes(re)}var ne=ee.dom;ee.commands.removeLink={exec:function(oe,ae){var re=this.state(oe,ae);re&&oe.selection.executeAndRestore(function(){te(oe,re)})},state:function(oe,ae){return ee.commands.formatInline.state(oe,ae,"A")}}}(wysihtml5),function(ee){var te=/wysiwyg-font-size-[0-9a-z\-]+/g;ee.commands.fontSize={exec:function(ne,oe,ae){ee.commands.formatInline.execWithToggle(ne,oe,"span","wysiwyg-font-size-"+ae,te)},state:function(ne,oe,ae){return ee.commands.formatInline.state(ne,oe,"span","wysiwyg-font-size-"+ae,te)}}}(wysihtml5),function(ee){var te=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;ee.commands.fontSizeStyle={exec:function(ne,oe,ae){ae="object"==typeof ae?ae.size:ae,/^\s*$/.test(ae)||ee.commands.formatInline.execWithToggle(ne,oe,"span",!1,!1,"font-size:"+ae,te)},state:function(ne,oe){return ee.commands.formatInline.state(ne,oe,"span",!1,!1,"font-size",te)},stateValue:function(ne,oe){var ae,re=this.state(ne,oe);return re&&ee.lang.object(re).isArray()&&(re=re[0]),re&&(ae=re.getAttribute("style"))&&ee.quirks.styleParser.parseFontSize(ae)}}}(wysihtml5),function(ee){var te=/wysiwyg-color-[0-9a-z]+/g;ee.commands.foreColor={exec:function(ne,oe,ae){ee.commands.formatInline.execWithToggle(ne,oe,"span","wysiwyg-color-"+ae,te)},state:function(ne,oe,ae){return ee.commands.formatInline.state(ne,oe,"span","wysiwyg-color-"+ae,te)}}}(wysihtml5),function(ee){var te=/(\s|^)color\s*:\s*[^;\s]+;?/gi;ee.commands.foreColorStyle={exec:function(ne,oe,ae){var re,se=ee.quirks.styleParser.parseColor("object"==typeof ae?"color:"+ae.color:"color:"+ae,"color");se&&(re="color: rgb("+se[0]+","+se[1]+","+se[2]+");",1!==se[3]&&(re+="color: rgba("+se[0]+","+se[1]+","+se[2]+","+se[3]+");"),ee.commands.formatInline.execWithToggle(ne,oe,"span",!1,!1,re,te))},state:function(ne,oe){return ee.commands.formatInline.state(ne,oe,"span",!1,!1,"color",te)},stateValue:function(ne,oe,ae){var re,se=this.state(ne,oe);return se&&ee.lang.object(se).isArray()&&(se=se[0]),se&&(re=se.getAttribute("style"),re&&re)&&(val=ee.quirks.styleParser.parseColor(re,"color"),ee.quirks.styleParser.unparseColor(val,ae))}}}(wysihtml5),function(ee){var te=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;ee.commands.bgColorStyle={exec:function(ne,oe,ae){var re,se=ee.quirks.styleParser.parseColor("object"==typeof ae?"background-color:"+ae.color:"background-color:"+ae,"background-color");se&&(re="background-color: rgb("+se[0]+","+se[1]+","+se[2]+");",1!==se[3]&&(re+="background-color: rgba("+se[0]+","+se[1]+","+se[2]+","+se[3]+");"),ee.commands.formatInline.execWithToggle(ne,oe,"span",!1,!1,re,te))},state:function(ne,oe){return ee.commands.formatInline.state(ne,oe,"span",!1,!1,"background-color",te)},stateValue:function(ne,oe,ae){var re,se=this.state(ne,oe),le=!1;return se&&ee.lang.object(se).isArray()&&(se=se[0]),se&&(re=se.getAttribute("style"))&&(le=ee.quirks.styleParser.parseColor(re,"background-color"),ee.quirks.styleParser.unparseColor(le,ae))}}}(wysihtml5),function(ee){function te(ge,pe,ue){ge.className?(oe(ge,ue),ge.className=ee.lang.string(ge.className+" "+pe).trim()):ge.className=pe}function ne(ge,pe,ue){ae(ge,ue),ge.getAttribute("style")?ge.setAttribute("style",ee.lang.string(ge.getAttribute("style")+" "+pe).trim()):ge.setAttribute("style",pe)}function oe(ge,pe){var ue=pe.test(ge.className);return ge.className=ge.className.replace(pe,""),""==ee.lang.string(ge.className).trim()&&ge.removeAttribute("class"),ue}function ae(ge,pe){var ue=pe.test(ge.getAttribute("style"));return ge.setAttribute("style",(ge.getAttribute("style")||"").replace(pe,"")),""==ee.lang.string(ge.getAttribute("style")||"").trim()&&ge.removeAttribute("style"),ue}function re(ge){var pe=ge.lastChild;pe&&se(pe)&&pe.parentNode.removeChild(pe)}function se(ge){return"BR"===ge.nodeName}function le(ge,pe){ge.selection.isCollapsed()&&ge.selection.selectLine();for(var ue=ge.selection.surround(pe),fe=0,he=ue.length;he>fe;fe++)ee.dom.lineBreaks(ue[fe]).remove(),re(ue[fe])}function ie(ge){return!!ee.lang.string(ge.className).trim()}function de(ge){return!!ee.lang.string(ge.getAttribute("style")||"").trim()}var ce=ee.dom,me=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];ee.commands.formatBlock={exec:function(ge,pe,ue,fe,he,be,ye){var Ce,Ne,xe,Ee,we,Se=(ge.doc,this.state(ge,pe,ue,fe,he,be,ye)),Te=ge.config.useLineBreaks,Re=Te?"DIV":"P";return ue="string"==typeof ue?ue.toUpperCase():ue,Se.length?void ge.selection.executeAndRestoreRangy(function(){for(var Ae=Se.length;Ae--;){if(he&&(Ne=oe(Se[Ae],he)),ye&&(Ee=ae(Se[Ae],ye)),(Ee||Ne)&&null===ue&&Se[Ae].nodeName!=Re)return;var ve=ie(Se[Ae]),_e=de(Se[Ae]);ve||_e||!Te&&"P"!==ue?ce.renameElement(Se[Ae],"P"===ue?"DIV":Re):(ee.dom.lineBreaks(Se[Ae]).add(),ce.replaceWithChildNodes(Se[Ae]))}}):void((null!==ue&&!ee.lang.array(me).contains(ue)||(Ce=ge.selection.findNodesInSelection(me).concat(ge.selection.getSelectedOwnNodes()),ge.selection.executeAndRestoreRangy(function(){for(var Ae=Ce.length;Ae--;)we=ce.getParentElement(Ce[Ae],{nodeName:me}),we==ge.element&&(we=null),we&&(ue&&(we=ce.renameElement(we,ue)),fe&&te(we,fe,he),be&&ne(we,be,ye),xe=!0)}),!xe))&&le(ge,{nodeName:ue||Re,className:fe||null,cssStyle:be||null}))},state:function(ge,pe,ue,fe,he,be,ye){var Ce,Ne=ge.selection.getSelectedOwnNodes(),xe=[];ue="string"==typeof ue?ue.toUpperCase():ue;for(var Ee=0,we=Ne.length;we>Ee;Ee++)Ce=ce.getParentElement(Ne[Ee],{nodeName:ue,className:fe,classRegExp:he,cssStyle:be,styleRegExp:ye}),Ce&&-1==ee.lang.array(xe).indexOf(Ce)&&xe.push(Ce);return 0!=xe.length&&xe}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(ee,te,ne){var oe,ae,re,se,le,ie=this.state(ee);ie?ee.selection.executeAndRestore(function(){oe=ie.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(ie),oe&&wysihtml5.dom.replaceWithChildNodes(oe)}):(ae=ee.selection.getRange(),re=ae.extractContents(),ie=ee.doc.createElement("pre"),oe=ee.doc.createElement("code"),ne&&(oe.className=ne),ie.appendChild(oe),oe.appendChild(re),ae.insertNode(ie),le=ie.nextSibling,parent=ie.parentElement,se=document.createElement("BR"),le?"BR"!=le.nodeName&&("#text"===le.nodeName?""===le.nodeValue&&(le.nodeValue="\xA0"):le.insertBefore(se,le)):parent.appendChild(se),ee.selection.selectNode(ie))},state:function(ee){var te=ee.selection.getSelectedNode();return te&&te.nodeName&&"PRE"==te.nodeName&&te.firstChild&&te.firstChild.nodeName&&"CODE"==te.firstChild.nodeName?te:wysihtml5.dom.getParentElement(te,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(te,{nodeName:"PRE"})}},function(ee){function te(re){var se=oe[re];return se?[re.toLowerCase(),se.toLowerCase()]:[re.toLowerCase()]}function ne(re,se,le,ie,de,ce){var me=re;return se&&(me+=":"+se),ie&&(me+=":"+ie),ae[me]||(ae[me]=new ee.selection.HTMLApplier(te(re),se,le,!0,ie,de,ce)),ae[me]}var oe={strong:"b",em:"i",b:"strong",i:"em"},ae={};ee.commands.formatInline={exec:function(re,se,le,ie,de,ce,me,ge,pe){var ue=re.selection.createRange(),fe=re.selection.getOwnRanges();return fe&&0!=fe.length&&(re.selection.getSelection().removeAllRanges(),ne(le,ie,de,ce,me,re.element).toggleRange(fe),void(ge?pe||re.cleanUp():(ue.setStart(fe[0].startContainer,fe[0].startOffset),ue.setEnd(fe[fe.length-1].endContainer,fe[fe.length-1].endOffset),re.selection.setSelection(ue),re.selection.executeAndRestore(function(){pe||re.cleanUp()},!0,!0))))},execWithToggle:function(re,se,le,ie,de,ce,me){var ge=this,pe=null;if(this.state(re,se,le,ie,de,ce,me)&&re.selection.isCollapsed()&&!re.selection.caretIsLastInSelection()&&!re.selection.caretIsFirstInSelection()){var ue=ge.state(re,se,le,ie,de)[0];re.selection.executeAndRestoreRangy(function(){ue.parentNode,re.selection.selectNode(ue,!0),ee.commands.formatInline.exec(re,se,le,ie,de,ce,me,!0,!0)})}else this.state(re,se,le,ie,de,ce,me)&&!re.selection.isCollapsed()?re.selection.executeAndRestoreRangy(function(){ee.commands.formatInline.exec(re,se,le,ie,de,ce,me,!0,!0)}):ee.commands.formatInline.exec(re,se,le,ie,de,ce,me);pe=re.selection.getRange(),pe.collapse(),re.selection.setSelection(pe)},state:function(re,se,le,ie,de,ce,me){var ge,pe,ue=re.doc,fe=oe[le]||le;return(ee.dom.hasElementWithTagName(ue,le)||ee.dom.hasElementWithTagName(ue,fe))&&(ie&&!ee.dom.hasElementWithClassName(ue,ie)?!1:(ge=re.selection.getOwnRanges(),ge&&0!==ge.length&&(pe=ne(le,ie,de,ce,me,re.element).isAppliedToRange(ge),pe&&pe.elements&&pe.elements)))}}}(wysihtml5),function(ee){ee.commands.insertBlockQuote={exec:function(te,ne){var oe=this.state(te,ne),ae=te.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);te.selection.executeAndRestore(function(){if(oe)te.config.useLineBreaks&&ee.dom.lineBreaks(oe).add(),ee.dom.unwrap(oe);else if(te.selection.isCollapsed()&&te.selection.selectLine(),ae){var re=ae.ownerDocument.createElement("blockquote");ee.dom.insert(re).after(ae),re.appendChild(ae)}else te.selection.surround({nodeName:"blockquote"})})},state:function(te){var ne=te.selection.getSelectedNode(),oe=ee.dom.getParentElement(ne,{nodeName:"BLOCKQUOTE"},!1,te.element);return!!oe&&oe}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(ee,te,ne){ee.commands.support(te)?ee.doc.execCommand(te,!1,ne):ee.selection.insertHTML(ne)},state:function(){return!1}},function(ee){var te="IMG";ee.commands.insertImage={exec:function(ne,oe,ae){ae="object"==typeof ae?ae:{src:ae};var re,se,le=ne.doc,ie=this.state(ne);if(ie)return ne.selection.setBefore(ie),se=ie.parentNode,se.removeChild(ie),ee.dom.removeEmptyTextNodes(se),"A"!==se.nodeName||se.firstChild||(ne.selection.setAfter(se),se.parentNode.removeChild(se)),void ee.quirks.redraw(ne.element);for(var de in ie=le.createElement(te),ae)ie.setAttribute("className"===de?"class":de,ae[de]);ne.selection.insertNode(ie),ee.browser.hasProblemsSettingCaretAfterImg()?(re=le.createTextNode(ee.INVISIBLE_SPACE),ne.selection.insertNode(re),ne.selection.setAfter(re)):ne.selection.setAfter(ie)},state:function(ne){var oe,ae,re,se=ne.doc;return ee.dom.hasElementWithTagName(se,te)&&(oe=ne.selection.getSelectedNode())&&(oe.nodeName===te?oe:!(oe.nodeType!==ee.ELEMENT_NODE)&&(ae=ne.selection.getText(),!(ae=ee.lang.string(ae).trim())&&(re=ne.selection.getNodes(ee.ELEMENT_NODE,function(le){return"IMG"===le.nodeName}),!(1!==re.length)&&re[0])))}}}(wysihtml5),function(ee){var te="<br>"+(ee.browser.needsSpaceAfterLineBreak()?" ":"");ee.commands.insertLineBreak={exec:function(ne,oe){ne.commands.support(oe)?(ne.doc.execCommand(oe,!1,null),ee.browser.autoScrollsToCaret()||ne.selection.scrollIntoView()):ne.commands.exec("insertHTML",te)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(ee,te){wysihtml5.commands.insertList.exec(ee,te,"OL")},state:function(ee,te){return wysihtml5.commands.insertList.state(ee,te,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(ee,te){wysihtml5.commands.insertList.exec(ee,te,"UL")},state:function(ee,te){return wysihtml5.commands.insertList.state(ee,te,"UL")}},wysihtml5.commands.insertList=function(ee){var te=function(le,ie){if(le&&le.nodeName){"string"==typeof ie&&(ie=[ie]);for(var de=ie.length;de--;)if(le.nodeName===ie[de])return!0}return!1},ne=function(le,ie,de){var ce={el:null,other:!1};if(le){var me=ee.dom.getParentElement(le,{nodeName:"LI"}),ge="UL"===ie?"OL":"UL";te(le,ie)?ce.el=le:te(le,ge)?ce={el:le,other:!0}:me&&(te(me.parentNode,ie)?ce.el=me.parentNode:te(me.parentNode,ge)&&(ce={el:me.parentNode,other:!0}))}return ce.el&&!de.element.contains(ce.el)&&(ce.el=null),ce},oe=function(le,ie,de){var ce,me="UL"===ie?"OL":"UL";de.selection.executeAndRestore(function(){var ge=re(me,de);if(ge.length)for(var pe=ge.length;pe--;)ee.dom.renameElement(ge[pe],ie.toLowerCase());else{ce=re(["OL","UL"],de);for(var ue=ce.length;ue--;)ee.dom.resolveList(ce[ue],de.config.useLineBreaks);ee.dom.resolveList(le,de.config.useLineBreaks)}})},ae=function(le,ie,de){var ce="UL"===ie?"OL":"UL";de.selection.executeAndRestore(function(){for(var me=[le].concat(re(ce,de)),ge=me.length;ge--;)ee.dom.renameElement(me[ge],ie.toLowerCase())})},re=function(le,ie){for(var de=ie.selection.getOwnRanges(),ce=[],me=de.length;me--;)ce=ce.concat(de[me].getNodes([1],function(ge){return te(ge,le)}));return ce},se=function(le,ie){ie.selection.executeAndRestoreRangy(function(){var de,ce,me="_wysihtml5-temp-"+new Date().getTime(),ge=ie.selection.deblockAndSurround({nodeName:"div",className:me}),pe=/\uFEFF/g;ge.innerHTML=ge.innerHTML.replace(pe,""),ge&&(de=ee.lang.array(["","<br>",ee.INVISIBLE_SPACE]).contains(ge.innerHTML),ce=ee.dom.convertToList(ge,le.toLowerCase(),ie.parent.config.uneditableContainerClassname),de&&ie.selection.selectNode(ce.querySelector("li"),!0))})};return{exec:function(le,ie,de){var ce=le.doc,me="OL"===de?"insertOrderedList":"insertUnorderedList",ge=le.selection.getSelectedNode(),pe=ne(ge,de,le);pe.el?pe.other?ae(pe.el,de,le):oe(pe.el,de,le):le.commands.support(me)?ce.execCommand(me,!1,null):se(de,le)},state:function(le,ie,de){var ce=le.selection.getSelectedNode(),me=ne(ce,de,le);return me.el&&!me.other&&me.el}}}(wysihtml5),wysihtml5.commands.italic={exec:function(ee,te){wysihtml5.commands.formatInline.execWithToggle(ee,te,"i")},state:function(ee,te){return wysihtml5.commands.formatInline.state(ee,te,"i")}},function(ee){var te="wysiwyg-text-align-center",ne=/wysiwyg-text-align-[0-9a-z]+/g;ee.commands.justifyCenter={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,te,ne)}}}(wysihtml5),function(ee){var te={left:"justifyLeft",right:"justifyRight",center:"justifyCenter"},ne={left:"wysiwyg-float-left",right:"wysiwyg-float-right",center:""};ee.commands.justifyCommon={exec:function(oe,ae,re){var se=this.state(oe);return se?void(se.className=se.className===ne[re]?"":ne[re]):(text_command=te[re],ee.commands[text_command].exec(oe,text_command))},state:function(oe,ae){return ee.commands.insertImage.state(oe,ae)}}}(wysihtml5),function(ee){var te="wysiwyg-text-align-left",ne=/wysiwyg-text-align-[0-9a-z]+/g;ee.commands.justifyLeft={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,te,ne)}}}(wysihtml5),function(ee){var te="wysiwyg-text-align-right",ne=/wysiwyg-text-align-[0-9a-z]+/g;ee.commands.justifyRight={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,te,ne)}}}(wysihtml5),function(ee){var te="wysiwyg-text-align-justify",ne=/wysiwyg-text-align-[0-9a-z]+/g;ee.commands.justifyFull={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,te,ne)}}}(wysihtml5),function(ee){var te="text-align: right;",ne=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;ee.commands.alignRightStyle={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,null,null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,null,null,te,ne)}}}(wysihtml5),function(ee){var te="text-align: left;",ne=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;ee.commands.alignLeftStyle={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,null,null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,null,null,te,ne)}}}(wysihtml5),function(ee){var te="text-align: center;",ne=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;ee.commands.alignCenterStyle={exec:function(oe){return ee.commands.formatBlock.exec(oe,"formatBlock",null,null,null,te,ne)},state:function(oe){return ee.commands.formatBlock.state(oe,"formatBlock",null,null,null,te,ne)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(ee){return ee.undoManager.redo()},state:function(){return!1}},wysihtml5.commands.underline={exec:function(ee,te){wysihtml5.commands.formatInline.execWithToggle(ee,te,"u")},state:function(ee,te){return wysihtml5.commands.formatInline.state(ee,te,"u")}},wysihtml5.commands.undo={exec:function(ee){return ee.undoManager.undo()},state:function(){return!1}},wysihtml5.commands.createTable={exec:function(ee,te,ne){var oe,ae,re;if(ne&&ne.cols&&ne.rows&&0<parseInt(ne.cols,10)&&0<parseInt(ne.rows,10)){for(re=ne.tableStyle?"<table style=\""+ne.tableStyle+"\">":"<table>",re+="<tbody>",ae=0;ae<ne.rows;ae++){for(re+="<tr>",oe=0;oe<ne.cols;oe++)re+="<td>&nbsp;</td>";re+="</tr>"}re+="</tbody></table>",ee.commands.exec("insertHTML",re)}},state:function(){return!1}},wysihtml5.commands.mergeTableCells={exec:function(ee,te){ee.tableSelection&&ee.tableSelection.start&&ee.tableSelection.end&&(this.state(ee,te)?wysihtml5.dom.table.unmergeCell(ee.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(ee.tableSelection.start,ee.tableSelection.end))},state:function(ee){if(ee.tableSelection){var te=ee.tableSelection.start,ne=ee.tableSelection.end;if(te&&ne&&te==ne&&(wysihtml5.dom.getAttribute(te,"colspan")&&1<parseInt(wysihtml5.dom.getAttribute(te,"colspan"),10)||wysihtml5.dom.getAttribute(te,"rowspan")&&1<parseInt(wysihtml5.dom.getAttribute(te,"rowspan"),10)))return[te]}return!1}},wysihtml5.commands.addTableCells={exec:function(ee,te,ne){if(ee.tableSelection&&ee.tableSelection.start&&ee.tableSelection.end){var oe=wysihtml5.dom.table.orderSelectionEnds(ee.tableSelection.start,ee.tableSelection.end);"before"==ne||"above"==ne?wysihtml5.dom.table.addCells(oe.start,ne):("after"==ne||"below"==ne)&&wysihtml5.dom.table.addCells(oe.end,ne),setTimeout(function(){ee.tableSelection.select(oe.start,oe.end)},0)}},state:function(){return!1}},wysihtml5.commands.deleteTableCells={exec:function(ee,te,ne){if(ee.tableSelection&&ee.tableSelection.start&&ee.tableSelection.end){var oe,ae=wysihtml5.dom.table.orderSelectionEnds(ee.tableSelection.start,ee.tableSelection.end),re=wysihtml5.dom.table.indexOf(ae.start),se=ee.tableSelection.table;wysihtml5.dom.table.removeCells(ae.start,ne),setTimeout(function(){oe=wysihtml5.dom.table.findCell(se,re),oe||("row"==ne&&(oe=wysihtml5.dom.table.findCell(se,{row:re.row-1,col:re.col})),"column"==ne&&(oe=wysihtml5.dom.table.findCell(se,{row:re.row,col:re.col-1}))),oe&&ee.tableSelection.select(oe,oe)},0)}},state:function(){return!1}},wysihtml5.commands.indentList={exec:function(ee){var te=ee.selection.getSelectionParentsByTag("LI");return!!te&&this.tryToPushLiLevel(te,ee.selection)},state:function(){return!1},tryToPushLiLevel:function(ee,te){var ne,oe,ae,re,se,le=!1;return te.executeAndRestoreRangy(function(){for(var ie=ee.length;ie--;)re=ee[ie],ne="OL"===re.parentNode.nodeName?"OL":"UL",oe=re.ownerDocument.createElement(ne),ae=wysihtml5.dom.domNode(re).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),se=ae?ae.querySelector("ul, ol"):null,ae&&(se?se.appendChild(re):(oe.appendChild(re),ae.appendChild(oe)),le=!0)}),le}},wysihtml5.commands.outdentList={exec:function(ee){var te=ee.selection.getSelectionParentsByTag("LI");return!!te&&this.tryToPullLiLevel(te,ee)},state:function(){return!1},tryToPullLiLevel:function(ee,te){var ne,oe,ae,re,se,le=!1,ie=this;return te.selection.executeAndRestoreRangy(function(){for(var de=ee.length;de--;)if(re=ee[de],re.parentNode&&(ne=re.parentNode,"OL"===ne.tagName||"UL"===ne.tagName)){if(le=!0,oe=wysihtml5.dom.getParentElement(ne.parentNode,{nodeName:["OL","UL"]},!1,te.element),ae=wysihtml5.dom.getParentElement(ne.parentNode,{nodeName:["LI"]},!1,te.element),oe&&ae)re.nextSibling&&(se=ie.getAfterList(ne,re),re.appendChild(se)),oe.insertBefore(re,ae.nextSibling);else{re.nextSibling&&(se=ie.getAfterList(ne,re),re.appendChild(se));for(var ce=re.childNodes.length;ce--;)ne.parentNode.insertBefore(re.childNodes[ce],ne.nextSibling);ne.parentNode.insertBefore(document.createElement("br"),ne.nextSibling),re.parentNode.removeChild(re)}0===ne.childNodes.length&&ne.parentNode.removeChild(ne)}}),le},getAfterList:function(ee,te){for(var ne=ee.nodeName,oe=document.createElement(ne);te.nextSibling;)oe.appendChild(te.nextSibling);return oe}},function(ee){var te=90,se="data-wysihtml5-selection-node",le="data-wysihtml5-selection-offset",ie=("<span id=\"_wysihtml5-undo\" class=\"_wysihtml5-temp\">"+ee.INVISIBLE_SPACE+"</span>","<span id=\"_wysihtml5-redo\" class=\"_wysihtml5-temp\">"+ee.INVISIBLE_SPACE+"</span>",ee.dom);ee.UndoManager=ee.lang.Dispatcher.extend({constructor:function(de){this.editor=de,this.composer=de.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){{var de,ce=this;this.composer.sandbox.getDocument()}ie.observe(this.element,"keydown",function(me){if(!me.altKey&&(me.ctrlKey||me.metaKey)){var ge=me.keyCode,pe=ge===te&&!me.shiftKey,ue=ge===te&&me.shiftKey||ge===89;pe?(ce.undo(),me.preventDefault()):ue&&(ce.redo(),me.preventDefault())}}),ie.observe(this.element,"keydown",function(me){var ge=me.keyCode;ge!==de&&(de=ge,(ge===8||ge===46)&&ce.transact())}),this.editor.on("newword:composer",function(){ce.transact()}).on("beforecommand:composer",function(){ce.transact()})},transact:function(){var de,ce,me,ge,pe,ue=this.historyStr[this.position-1],fe=this.composer.getValue(!1,!1),he=0<this.element.offsetWidth&&0<this.element.offsetHeight;if(fe!==ue){var be=this.historyStr.length=this.historyDom.length=this.position;be>25&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,he&&(de=this.composer.selection.getRange(),ce=de&&de.startContainer?de.startContainer:this.element,me=de&&de.startOffset?de.startOffset:0,ce.nodeType===ee.ELEMENT_NODE?ge=ce:(ge=ce.parentNode,pe=this.getChildNodeIndex(ge,ce)),ge.setAttribute(le,me),"undefined"!=typeof pe&&ge.setAttribute(se,pe));var ye=this.element.cloneNode(!!fe);this.historyDom.push(ye),this.historyStr.push(fe),ge&&(ge.removeAttribute(le),ge.removeAttribute(se))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(de){this.element.innerHTML="";for(var ce=0,me=de.childNodes,ge=de.childNodes.length;ge>ce;ce++)this.element.appendChild(me[ce].cloneNode(!0));var pe,ue,fe;de.hasAttribute(le)?(pe=de.getAttribute(le),fe=de.getAttribute(se),ue=this.element):(ue=this.element.querySelector("["+le+"]")||this.element,pe=ue.getAttribute(le),fe=ue.getAttribute(se),ue.removeAttribute(le),ue.removeAttribute(se)),null!==fe&&(ue=this.getChildNodeByIndex(ue,+fe)),this.composer.selection.set(ue,pe)},getChildNodeIndex:function(de,ce){for(var me=0,ge=de.childNodes,pe=ge.length;pe>me;me++)if(ge[me]===ce)return me},getChildNodeByIndex:function(de,ce){return de.childNodes[ce]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(ee,te,ne){this.parent=ee,this.element=te,this.config=ne,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var ee=this;this.parent.on("beforeload",function(){ee.parent.on("change_view",function(te){te===ee.name?(ee.parent.currentView=ee,ee.show(),setTimeout(function(){ee.focus()},0)):ee.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(ee){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(ee){var te=ee.dom,ne=ee.browser;ee.views.Composer=ee.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(oe,ae,re){this.base(oe,ae,re),this.config.noTextarea?this.editableArea=ae:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=ne.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(oe,ae){var re=this.isEmpty()?"":ee.quirks.getCorrectInnerHTML(this.element);return!1!==oe&&(re=this.parent.parse(re,!1!==ae)),re},setValue:function(oe,ae){ae&&(oe=this.parent.parse(oe));try{this.element.innerHTML=oe}catch(re){this.element.innerText=oe}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=te.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(oe){ee.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var ae=this.element.lastChild;oe&&ae&&this.selection&&("BR"===ae.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return te.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var oe=this.element.innerHTML.toLowerCase();return /^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(oe)||""===oe||"<br>"===oe||"<p></p>"===oe||"<p><br></p>"===oe||this.hasPlaceholderSet()},_initContentEditableArea:function(){var oe=this;this.config.noTextarea?this.sandbox=new te.ContentEditableArea(function(){oe._create()},{},this.editableArea):(this.sandbox=new te.ContentEditableArea(function(){oe._create()}),this.editableArea=this.sandbox.getContentEditable(),te.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var oe=this;this.sandbox=new te.Sandbox(function(){oe._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe();var ae=this.textarea.element;te.insert(this.editableArea).after(ae),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var oe=document.createElement("input");oe.type="hidden",oe.name="_wysihtml5_mode",oe.value=1,te.insert(oe).after(this.textarea.element)}},_create:function(){var oe=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new ee.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new ee.Commands(this.parent),this.config.noTextarea||te.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),te.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var ae=this.config.name;ae&&(te.addClass(this.element,ae),this.config.contentEditableMode||te.addClass(this.editableArea,ae)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var re="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");re&&te.simulatePlaceholder(this.parent,this,re),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||ne.isIos()||setTimeout(function(){oe.focus(!0)},100),ne.clearsContentEditableCorrectly()||ee.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var oe=this,ae=ne.canDisableAutoLinking(),re=ne.doesAutoLinkingInContentEditable();if(ae&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!re||re&&ae)&&(this.parent.on("newword:composer",function(){te.getTextContent(oe.element).match(te.autoLink.URL_REG_EXP)&&oe.selection.executeAndRestore(function(de,ce){for(var me=oe.element.querySelectorAll("."+oe.config.uneditableContainerClassname),ge=!1,pe=me.length;pe--;)ee.dom.contains(me[pe],ce)&&(ge=!0);ge||te.autoLink(ce.parentNode,[oe.config.uneditableContainerClassname])})}),te.observe(this.element,"blur",function(){te.autoLink(oe.element,[oe.config.uneditableContainerClassname])}));var se=this.sandbox.getDocument().getElementsByTagName("a"),le=te.autoLink.URL_REG_EXP,ie=function(de){var ce=ee.lang.string(te.getTextContent(de)).trim();return"www."===ce.substr(0,4)&&(ce="http://"+ce),ce};te.observe(this.element,"keydown",function(de){if(se.length){var ce,me=oe.selection.getSelectedNode(de.target.ownerDocument),ge=te.getParentElement(me,{nodeName:"A"},4);ge&&(ce=ie(ge),setTimeout(function(){var pe=ie(ge);pe!==ce&&pe.match(le)&&ge.setAttribute("href",pe)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),ne.supportsEvent("resizeend")){var oe=["width","height"],ae=oe.length,re=this.element;te.observe(re,"resizeend",function(se){var le,ie=se.target||se.srcElement,de=ie.style,ce=0;if("IMG"===ie.nodeName){for(;ae>ce;ce++)le=oe[ce],de[le]&&(ie.setAttribute(le,parseInt(de[le],10)),de[le]="");ee.quirks.redraw(re)}})}},_initUndoManager:function(){this.undoManager=new ee.UndoManager(this.parent)},_initLineBreaking:function(){function oe(ie){var de=te.getParentElement(ie,{nodeName:["P","DIV"]},2);de&&te.contains(ae.element,de)&&ae.selection.executeAndRestore(function(){ae.config.useLineBreaks?te.replaceWithChildNodes(de):"P"!==de.nodeName&&te.renameElement(de,"p")})}var ae=this,re=["LI","P","H1","H2","H3","H4","H5","H6"],se=["CODE","PRE"],le=["UL","OL","MENU"];this.config.useLineBreaks||te.observe(this.element,["focus","keydown"],function(){if(ae.isEmpty()){var ie=ae.doc.createElement("P");ae.element.innerHTML="",ae.element.appendChild(ie),ne.displaysCaretInEmptyContentEditableCorrectly()?ae.selection.selectNode(ie,!0):(ie.innerHTML="<br>",ae.selection.setBefore(ie.firstChild))}}),te.observe(this.element,"keydown",function(ie){var de=ie.keyCode;if(!ie.shiftKey&&(de===ee.ENTER_KEY||de===ee.BACKSPACE_KEY)){var ce=te.getParentElement(ae.selection.getSelectedNode(),{nodeName:se},4);if(ce&&de===ee.ENTER_KEY)return ie.preventDefault(),void ae.commands.exec("insertHTML","\n");var me=te.getParentElement(ae.selection.getSelectedNode(),{nodeName:re},4);return me?void setTimeout(function(){var ge,pe=ae.selection.getSelectedNode();if("LI"===me.nodeName){if(!pe)return;ge=te.getParentElement(pe,{nodeName:le},2),ge||oe(pe)}de===ee.ENTER_KEY&&me.nodeName.match(/^H[1-6]$/)&&oe(pe)},0):void(ae.config.useLineBreaks&&de===ee.ENTER_KEY&&!ee.browser.insertsLineBreaksOnReturn()&&(ie.preventDefault(),ae.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(ee){var te=ee.dom,ne=document,oe=window,ae=ne.createElement("div"),re=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],se=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],le=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",ee.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],ie=function(de){if(de.setActive)try{de.setActive()}catch(ue){}else{var ce=de.style,me=ne.documentElement.scrollTop||ne.body.scrollTop,ge=ne.documentElement.scrollLeft||ne.body.scrollLeft,pe={position:ce.position,top:ce.top,left:ce.left,WebkitUserSelect:ce.WebkitUserSelect};te.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(de),de.focus(),te.setStyles(pe).on(de),oe.scrollTo&&oe.scrollTo(ge,me)}};ee.views.Composer.prototype.style=function(){var de,ce=this,me=ne.querySelector(":focus"),ge=this.textarea.element,pe=ge.hasAttribute("placeholder"),ue=pe&&ge.getAttribute("placeholder"),fe=ge.style.display,he=ge.disabled;this.focusStylesHost=ae.cloneNode(!1),this.blurStylesHost=ae.cloneNode(!1),this.disabledStylesHost=ae.cloneNode(!1),pe&&ge.removeAttribute("placeholder"),ge===me&&ge.blur(),ge.disabled=!1,ge.style.display=de="none",(ge.getAttribute("rows")&&"auto"===te.getStyle("height").from(ge)||ge.getAttribute("cols")&&"auto"===te.getStyle("width").from(ge))&&(ge.style.display=de=fe),te.copyStyles(se).from(ge).to(this.editableArea).andTo(this.blurStylesHost),te.copyStyles(re).from(ge).to(this.element).andTo(this.blurStylesHost),te.insertCSS(le).into(this.element.ownerDocument),ge.disabled=!0,te.copyStyles(se).from(ge).to(this.disabledStylesHost),te.copyStyles(re).from(ge).to(this.disabledStylesHost),ge.disabled=he,ge.style.display=fe,ie(ge),ge.style.display=de,te.copyStyles(se).from(ge).to(this.focusStylesHost),te.copyStyles(re).from(ge).to(this.focusStylesHost),ge.style.display=fe,te.copyStyles(["display"]).from(ge).to(this.editableArea);var be=ee.lang.array(se).without(["display"]);return me?me.focus():ge.blur(),pe&&ge.setAttribute("placeholder",ue),this.parent.on("focus:composer",function(){te.copyStyles(be).from(ce.focusStylesHost).to(ce.editableArea),te.copyStyles(re).from(ce.focusStylesHost).to(ce.element)}),this.parent.on("blur:composer",function(){te.copyStyles(be).from(ce.blurStylesHost).to(ce.editableArea),te.copyStyles(re).from(ce.blurStylesHost).to(ce.element)}),this.parent.observe("disable:composer",function(){te.copyStyles(be).from(ce.disabledStylesHost).to(ce.editableArea),te.copyStyles(re).from(ce.disabledStylesHost).to(ce.element)}),this.parent.observe("enable:composer",function(){te.copyStyles(be).from(ce.blurStylesHost).to(ce.editableArea),te.copyStyles(re).from(ce.blurStylesHost).to(ce.element)}),this}}(wysihtml5),function(ee){var te=ee.dom,ne=ee.browser,oe={66:"bold",73:"italic",85:"underline"},ae=function(le,ie,de){var ce=le.getPreviousNode(ie,!0),me=le.getSelectedNode();if(1!==me.nodeType&&me.parentNode!==de&&(me=me.parentNode),ce)if(1==me.nodeType){var ge=me.firstChild;if(1==ce.nodeType)for(;me.firstChild;)ce.appendChild(me.firstChild);else for(;me.firstChild;)ie.parentNode.insertBefore(me.firstChild,ie);me.parentNode&&me.parentNode.removeChild(me),le.setBefore(ge)}else 1==ce.nodeType?ce.appendChild(me):ie.parentNode.insertBefore(me,ie),le.setBefore(me)},re=function(le,ie,de,ce){if(!ie.isCollapsed())ie.containsUneditable()&&(le.preventDefault(),ie.deleteContents());else if(ie.caretIsInTheBeginnig("LI"))le.preventDefault(),ce.commands.exec("outdentList");else if(ie.caretIsInTheBeginnig())le.preventDefault();else{if(ie.caretIsFirstInSelection()&&ie.getPreviousNode()&&ie.getPreviousNode().nodeName&&/^H\d$/gi.test(ie.getPreviousNode().nodeName)){var me=ie.getPreviousNode();if(le.preventDefault(),/^\s*$/.test(me.textContent||me.innerText))me.parentNode.removeChild(me);else{var ge=me.ownerDocument.createRange();ge.selectNodeContents(me),ge.collapse(!1),ie.setSelection(ge)}}var pe=ie.caretIsBeforeUneditable();pe&&(le.preventDefault(),ae(ie,pe,de))}},se=function(le){if(!le.selection.isCollapsed())le.selection.deleteContents();else if(le.selection.caretIsInTheBeginnig("LI")&&le.commands.exec("indentList"))return;le.commands.exec("insertHTML","&emsp;")};ee.views.Composer.prototype.observe=function(){var le=this,ie=this.getValue(!1,!1),de=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),ce=this.element,me=ne.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?ce:this.sandbox.getWindow();if(te.observe(de,"DOMNodeRemoved",function(){clearInterval(ue),le.parent.fire("destroy:composer")}),!ne.supportsMutationEvents())var ue=setInterval(function(){te.contains(document.documentElement,de)||(clearInterval(ue),le.parent.fire("destroy:composer"))},250);te.observe(me,["drop","paste","mouseup","focus","keyup"],function(){setTimeout(function(){le.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&ee.browser.supportsCommand(this.doc,"enableObjectResizing")&&ee.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=te.observe(de,["focus","mouseup","mouseover"],function(){le.doc.execCommand("enableObjectResizing",!1,"false"),le.doc.execCommand("enableInlineTableEditing",!1,"false"),le.tableClickHandle.stop()}):setTimeout(function(){le.doc.execCommand("enableObjectResizing",!1,"false"),le.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=ee.quirks.tableCellsSelection(ce,le.parent)),te.observe(me,"focus",function(he){le.parent.fire("focus",he).fire("focus:composer",he),setTimeout(function(){ie=le.getValue(!1,!1)},0)}),te.observe(me,"blur",function(he){if(ie!==le.getValue(!1,!1)){var be=he;"function"==typeof Object.create&&(be=Object.create(he,{type:{value:"change"}})),le.parent.fire("change",be).fire("change:composer",be)}le.parent.fire("blur",he).fire("blur:composer",he)}),te.observe(ce,"dragenter",function(){le.parent.fire("unset_placeholder")}),te.observe(ce,["drop","paste","beforepaste"],function(he){le.parent.fire(he.type,he).fire(he.type+":composer",he)}),this.config.copyedFromMarking&&te.observe(ce,"copy",function(he){he.clipboardData&&(he.clipboardData.setData("text/html",le.config.copyedFromMarking+le.selection.getHtml()),he.clipboardData.setData("text/plain",le.selection.getText()),he.preventDefault()),le.parent.fire(he.type,he).fire(he.type+":composer",he)}),te.observe(ce,"keyup",function(he){var be=he.keyCode;(be===ee.SPACE_KEY||be===ee.ENTER_KEY)&&le.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){le.parent.fire("newword:composer")},0)}),ne.canSelectImagesInContentEditable()||te.observe(ce,"mousedown",function(he){var be=he.target,ye=ce.querySelectorAll("img"),Ce=ce.querySelectorAll("."+le.config.uneditableContainerClassname+" img"),Ne=ee.lang.array(ye).without(Ce);"IMG"===be.nodeName&&ee.lang.array(Ne).contains(be)&&le.selection.selectNode(be)}),ne.canSelectImagesInContentEditable()||te.observe(ce,"drop",function(){setTimeout(function(){le.selection.getSelection().removeAllRanges()},0)}),ne.hasHistoryIssue()&&ne.supportsSelectionModify()&&te.observe(ce,"keydown",function(he){if(he.metaKey||he.ctrlKey){var be=he.keyCode,ye=ce.ownerDocument.defaultView,Ce=ye.getSelection();(37===be||39===be)&&(37===be&&(Ce.modify("extend","left","lineboundary"),he.shiftKey||Ce.collapseToStart()),39===be&&(Ce.modify("extend","right","lineboundary"),he.shiftKey||Ce.collapseToEnd()),he.preventDefault())}}),te.observe(ce,"keydown",function(he){var be=he.keyCode,ye=oe[be];(he.ctrlKey||he.metaKey)&&!he.altKey&&ye&&(le.commands.exec(ye),he.preventDefault()),8===be?re(he,le.selection,ce,le):le.config.handleTabKey&&9===be&&(he.preventDefault(),se(le,ce))}),te.observe(ce,"keydown",function(he){var be,ye=le.selection.getSelectedNode(!0),Ce=he.keyCode;ye&&"IMG"===ye.nodeName&&(Ce===ee.BACKSPACE_KEY||Ce===ee.DELETE_KEY)&&(be=ye.parentNode,be.removeChild(ye),"A"!==be.nodeName||be.firstChild||be.parentNode.removeChild(be),setTimeout(function(){ee.quirks.redraw(ce)},0),he.preventDefault())}),!this.config.contentEditableMode&&ne.hasIframeFocusIssue()&&(te.observe(de,"focus",function(){setTimeout(function(){le.doc.querySelector(":focus")!==le.element&&le.focus()},0)}),te.observe(this.element,"blur",function(){setTimeout(function(){le.selection.getSelection().removeAllRanges()},0)}));var fe={IMG:"Image: ",A:"Link: "};te.observe(ce,"mouseover",function(he){var be,ye=he.target,Ce=ye.nodeName;if("A"===Ce||"IMG"===Ce){var Ne=ye.hasAttribute("title");Ne||(be=fe[Ce]+(ye.getAttribute("href")||ye.getAttribute("src")),ye.setAttribute("title",be))}})}}(wysihtml5),function(ee){ee.views.Synchronizer=Base.extend({constructor:function(ne,oe,ae){this.editor=ne,this.textarea=oe,this.composer=ae,this._observe()},fromComposerToTextarea:function(ne){this.textarea.setValue(ee.lang.string(this.composer.getValue(!1,!1)).trim(),ne)},fromTextareaToComposer:function(ne){var oe=this.textarea.getValue(!1,!1);oe?this.composer.setValue(oe,ne):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(ne){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(ne):this.fromComposerToTextarea(ne)},_observe:function(){var ne,oe=this,ae=this.textarea.element.form,re=function(){ne=setInterval(function(){oe.fromComposerToTextarea()},400)},se=function(){clearInterval(ne),ne=null};re(),ae&&(ee.dom.observe(ae,"submit",function(){oe.sync(!0)}),ee.dom.observe(ae,"reset",function(){setTimeout(function(){oe.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(le){"composer"!==le||ne?"textarea"===le&&(oe.fromComposerToTextarea(!0),se()):(oe.fromTextareaToComposer(!0),re())}),this.editor.on("destroy:composer",se)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(ee,te,ne){this.base(ee,te,ne),this._observe()},clear:function(){this.element.value=""},getValue:function(ee){var te=this.isEmpty()?"":this.element.value;return!1!==ee&&(te=this.parent.parse(te)),te},setValue:function(ee,te){te&&(ee=this.parent.parse(ee)),this.element.value=ee},cleanUp:function(){var ee=this.parent.parse(this.element.value);this.element.value=ee},hasPlaceholderSet:function(){var ee=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),te=this.element.getAttribute("placeholder")||null,ne=this.element.value;return ee&&!ne||ne===te},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var ee=this.element,te=this.parent,ne={focusin:"focus",focusout:"blur"},oe=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];te.on("beforeload",function(){wysihtml5.dom.observe(ee,oe,function(ae){var re=ne[ae.type]||ae.type;te.fire(re).fire(re+":textarea")}),wysihtml5.dom.observe(ee,["paste","drop"],function(){setTimeout(function(){te.fire("paste").fire("paste:textarea")},0)})})}}),function(ee){var te,ne={name:te,style:!0,toolbar:te,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:ee.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:te,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:"<meta name=\"copied-from\" content=\"wysihtml5\">"};ee.Editor=ee.lang.Dispatcher.extend({constructor:function(oe,ae){if(this.editableElement="string"==typeof oe?document.getElementById(oe):oe,this.config=ee.lang.object({}).merge(ne).merge(ae).get(),this._isCompatible=ee.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new ee.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&ee.browser.isTouchDevice()){var re=this;return void setTimeout(function(){re.fire("beforeload").fire("load")},0)}ee.dom.addClass(document.body,this.config.bodyClassName),this.composer=new ee.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new ee.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new ee.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(oe,ae){return this.currentView.getValue(oe,ae)},setValue:function(oe,ae){return this.fire("unset_placeholder"),oe?(this.currentView.setValue(oe,ae),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(oe){return this.currentView.focus(oe),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(oe,ae){var re=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,se=this.config.parser(oe,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:re,uneditableClass:this.config.uneditableContainerClassname,clearInternals:ae});return"object"==typeof oe&&ee.quirks.redraw(oe),se},_initParser:function(){var oe,ae=this;ee.browser.supportsModenPaste()?this.on("paste:composer",function(re){re.preventDefault(),oe=ee.dom.getPastedHtml(re),oe&&ae._cleanAndPaste(oe)}):this.on("beforepaste:composer",function(re){re.preventDefault(),ee.dom.getPastedHtmlWithDiv(ae.composer,function(se){se&&ae._cleanAndPaste(se)})})},_isPartialUpdate:function(){var oe=!1,ae=!1,re=this.composer.editableArea,se=this.composer.selection.getRange();oe=function(ce,me){for(var ge=ce.startContainer;ge!==me;){if(ge.previousElementSibling)return!1;ge=ge.parentElement}return 0==ce.startOffset}(se,re);ae=function(ce,me){for(var ge=ce.endContainer;ge!==me;){if(ge.nextElementSibling)return!1;ge=ge.parentElement}return ce.endOffset==ce.endContainer.length}(se,re);var de=!(oe&&ae);return de},_cleanAndPaste:function(oe){var ae=this._isPartialUpdate(),re=ee.quirks.cleanPastedHTML(oe,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});ae?(this.composer.selection.deleteContents(),this.composer.selection.insertHTML(re)):this.composer.editableArea.innerHTML=re}})}(wysihtml5),function(ee){var te=ee.dom,ne="wysihtml5-command-dialog-opened",oe="input, select, textarea",ae="[data-wysihtml5-dialog-field]",re="data-wysihtml5-dialog-field";ee.toolbar.Dialog=ee.lang.Dispatcher.extend({constructor:function(se,le){this.link=se,this.container=le},_observe:function(){if(!this._observed){var se=this,le=function(ge){var pe=se._serialize();pe==se.elementToChange?se.fire("edit",pe):se.fire("save",pe),se.hide(),ge.preventDefault(),ge.stopPropagation()};te.observe(se.link,"click",function(){te.hasClass(se.link,ne)&&setTimeout(function(){se.hide()},0)}),te.observe(this.container,"keydown",function(ge){var pe=ge.keyCode;pe===ee.ENTER_KEY&&le(ge),pe===ee.ESCAPE_KEY&&(se.fire("cancel"),se.hide())}),te.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",le),te.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(ge){se.fire("cancel"),se.hide(),ge.preventDefault(),ge.stopPropagation()});for(var ie=this.container.querySelectorAll(oe),de=0,ce=ie.length,me=function(){clearInterval(se.interval)};ce>de;de++)te.observe(ie[de],"change",me);this._observed=!0}},_serialize:function(){for(var se=this.elementToChange||{},le=this.container.querySelectorAll(ae),ie=le.length,de=0;ie>de;de++)se[le[de].getAttribute(re)]=le[de].value;return se},_interpolate:function(se){for(var le,ie,de,ce=document.querySelector(":focus"),me=this.container.querySelectorAll(ae),ge=me.length,pe=0;ge>pe;pe++)le=me[pe],le!==ce&&(se&&"hidden"===le.type||(ie=le.getAttribute(re),de=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(ie)||"":le.defaultValue,le.value=de))},show:function(se){if(!te.hasClass(this.link,ne)){var le=this,ie=this.container.querySelector(oe);if(this.elementToChange=se,this._observe(),this._interpolate(),se&&(this.interval=setInterval(function(){le._interpolate(!0)},500)),te.addClass(this.link,ne),this.container.style.display="",this.fire("show"),ie&&!se)try{ie.focus()}catch(de){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,te.removeClass(this.link,ne),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(ee){var te=ee.dom,ne={position:"relative"},oe={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},ae={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},re={"x-webkit-speech":"",speech:""};ee.toolbar.Speech=function(se,le){var ie=document.createElement("input");if(!ee.browser.supportsSpeechApiOn(ie))return void(le.style.display="none");var de=se.editor.textarea.element.getAttribute("lang");de&&(re.lang=de);var ce=document.createElement("div");ee.lang.object(oe).merge({width:le.offsetWidth+"px",height:le.offsetHeight+"px"}),te.insert(ie).into(ce),te.insert(ce).into(le),te.setStyles(ae).on(ie),te.setAttributes(re).on(ie),te.setStyles(oe).on(ce),te.setStyles(ne).on(le);var me="onwebkitspeechchange"in ie?"webkitspeechchange":"speechchange";te.observe(ie,me,function(){se.execCommand("insertText",ie.value),ie.value=""}),te.observe(ie,"click",function(ge){te.hasClass(le,"wysihtml5-command-disabled")&&ge.preventDefault(),ge.stopPropagation()})}}(wysihtml5),function(ee){var te="wysihtml5-command-disabled",ne="wysihtml5-commands-disabled",oe="wysihtml5-command-active",ae="wysihtml5-action-active",re=ee.dom;ee.toolbar.Toolbar=Base.extend({constructor:function(se,le,ie){this.editor=se,this.container="string"==typeof le?document.getElementById(le):le,this.composer=se.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),ie&&this.show(),null!=se.config.classNameCommandDisabled&&(te=se.config.classNameCommandDisabled),null!=se.config.classNameCommandsDisabled&&(ne=se.config.classNameCommandsDisabled),null!=se.config.classNameCommandActive&&(oe=se.config.classNameCommandActive),null!=se.config.classNameActionActive&&(ae=se.config.classNameActionActive);for(var de=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),ce=de.length,me=0;ce>me;me++)new ee.toolbar.Speech(this,de[me])},_getLinks:function(se){for(var le,ie,de,ce,me,ge=this[se+"Links"]=ee.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+se+"]")).get(),pe=ge.length,ue=0,fe=this[se+"Mapping"]={};pe>ue;ue++)le=ge[ue],de=le.getAttribute("data-wysihtml5-"+se),ce=le.getAttribute("data-wysihtml5-"+se+"-value"),ie=this.container.querySelector("[data-wysihtml5-"+se+"-group='"+de+"']"),me=this._getDialog(le,de),fe[de+":"+ce]={link:le,group:ie,name:de,value:ce,dialog:me,state:!1}},_getDialog:function(se,le){var ie,de,ce=this,me=this.container.querySelector("[data-wysihtml5-dialog='"+le+"']");return me&&(ie=ee.toolbar["Dialog_"+le]?new ee.toolbar["Dialog_"+le](se,me):new ee.toolbar.Dialog(se,me),ie.on("show",function(){de=ce.composer.selection.getBookmark(),ce.editor.fire("show:dialog",{command:le,dialogContainer:me,commandLink:se})}),ie.on("save",function(ge){de&&ce.composer.selection.setBookmark(de),ce._execCommand(le,ge),ce.editor.fire("save:dialog",{command:le,dialogContainer:me,commandLink:se})}),ie.on("cancel",function(){ce.editor.focus(!1),ce.editor.fire("cancel:dialog",{command:le,dialogContainer:me,commandLink:se})})),ie},execCommand:function(se,le){if(!this.commandsDisabled){var ie=this.commandMapping[se+":"+le];ie&&ie.dialog&&!ie.state?ie.dialog.show():this._execCommand(se,le)}},_execCommand:function(se,le){this.editor.focus(!1),this.composer.commands.exec(se,le),this._updateLinkStates()},execAction:function(se){var le=this.editor;"change_view"===se&&le.textarea&&(le.currentView===le.textarea?le.fire("change_view","composer"):le.fire("change_view","textarea")),"showSource"==se&&le.fire("showSource")},_observe:function(){for(var se=this,le=this.editor,ie=this.container,de=this.commandLinks.concat(this.actionLinks),ce=de.length,me=0;ce>me;me++)"A"===de[me].nodeName?re.setAttributes({href:"javascript:;",unselectable:"on"}).on(de[me]):re.setAttributes({unselectable:"on"}).on(de[me]);re.delegate(ie,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(ge){ge.preventDefault()}),re.delegate(ie,"[data-wysihtml5-command]","click",function(ge){var pe=this,ue=pe.getAttribute("data-wysihtml5-command"),fe=pe.getAttribute("data-wysihtml5-command-value");se.execCommand(ue,fe),ge.preventDefault()}),re.delegate(ie,"[data-wysihtml5-action]","click",function(ge){var pe=this.getAttribute("data-wysihtml5-action");se.execAction(pe),ge.preventDefault()}),le.on("interaction:composer",function(){se._updateLinkStates()}),le.on("focus:composer",function(){se.bookmark=null}),this.editor.config.handleTables&&(le.on("tableselect:composer",function(){se.container.querySelectorAll("[data-wysihtml5-hiddentools=\"table\"]")[0].style.display=""}),le.on("tableunselect:composer",function(){se.container.querySelectorAll("[data-wysihtml5-hiddentools=\"table\"]")[0].style.display="none"})),le.on("change_view",function(ge){le.textarea&&setTimeout(function(){se.commandsDisabled="composer"!==ge,se._updateLinkStates(),se.commandsDisabled?re.addClass(ie,ne):re.removeClass(ie,ne)},0)})},_updateLinkStates:function(){var se,le,ie,de,ce=this.commandMapping,me=this.actionMapping;for(se in ce)de=ce[se],this.commandsDisabled?(le=!1,re.removeClass(de.link,oe),de.group&&re.removeClass(de.group,oe),de.dialog&&de.dialog.hide()):(le=this.composer.commands.state(de.name,de.value),re.removeClass(de.link,te),de.group&&re.removeClass(de.group,te)),de.state!==le&&(de.state=le,le?(re.addClass(de.link,oe),de.group&&re.addClass(de.group,oe),de.dialog&&("object"==typeof le||ee.lang.object(le).isArray()?(!de.dialog.multiselect&&ee.lang.object(le).isArray()&&(le=1!==le.length||le[0],de.state=le),de.dialog.show(le)):de.dialog.hide())):(re.removeClass(de.link,oe),de.group&&re.removeClass(de.group,oe),de.dialog&&de.dialog.hide()));for(se in me)ie=me[se],"change_view"===ie.name&&(ie.state=this.editor.currentView===this.editor.textarea,ie.state?re.addClass(ie.link,ae):re.removeClass(ie.link,ae))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(ee){ee.toolbar.Dialog_createTable=ee.toolbar.Dialog.extend({show:function(te){this.base(te)}})}(wysihtml5),function(ee){var te=(ee.dom,"[data-wysihtml5-dialog-field]"),ne="data-wysihtml5-dialog-field";ee.toolbar.Dialog_foreColorStyle=ee.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var oe={},ae=this.container.querySelectorAll(te),re=ae.length,se=0;re>se;se++)oe[ae[se].getAttribute(ne)]=ae[se].value;return oe},_interpolate:function(oe){for(var ae,re=document.querySelector(":focus"),se=this.container.querySelectorAll(te),le=se.length,ie=0,de=this.elementToChange?ee.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,ce=de?de.getAttribute("style"):null,me=ce?ee.quirks.styleParser.parseColor(ce,"color"):null;le>ie;ie++)ae=se[ie],ae!==re&&(oe&&"hidden"===ae.type||"color"===ae.getAttribute(ne)&&(ae.value=me?me[3]&&1!=me[3]?"rgba("+me[0]+","+me[1]+","+me[2]+","+me[3]+");":"rgb("+me[0]+","+me[1]+","+me[2]+");":"rgb(0,0,0);"))}})}(wysihtml5),function(ee){ee.dom,ee.toolbar.Dialog_fontSizeStyle=ee.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector("[data-wysihtml5-dialog-field=\"size\"]").value}},_interpolate:function(){var te=document.querySelector(":focus"),ne=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),oe=this.elementToChange?ee.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,ae=oe?oe.getAttribute("style"):null,re=ae?ee.quirks.styleParser.parseFontSize(ae):null;ne&&ne!==te&&re&&!/^\s*$/.test(re)&&(ne.value=re)}})}(wysihtml5)}